
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head> 
  <meta charset="utf-8">
  <title>ESP8266 Initial Notes - </title>
  <meta name="author" content="">

  
  <meta name="description" content="

  
  
    
      ESP8266 Initial Notes
    
    
      
        










        
      
    
  




Here are a few notes from my experiments w...">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://rwx.io/2015/09/09/esp8266-initial-notes.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <link href="/css/custom.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/js/search.min.js" type="text/javascript" charset="utf-8"></script>
  <link href="" rel="alternate" title="" type="application/atom+xml">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Lato:400,100,100italic,300,300italic,400italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Lora:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Source+Code+Pro:200,300,400,500,600,700,900' rel='stylesheet' type='text/css'>



 
  

  <style>html{background: linear-gradient(180deg, rgba(62, 54, 52,
  0.8) 0%, rgba(89, 79, 76, 0.8)),  url("/images/background.png") repeat;}</style>
</head>

<body   >
  <header role="banner"><hgroup>
</hgroup>

</header>
  <!-- <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav> -->
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">ESP8266 Initial Notes</h1>
    
    
      <p class="meta">
        









<time datetime="2015-09-09T08:05:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


<div class="entry-content"><p><img src="//s3.amazonaws.com/rwx-blog/sparkfun_thing.jpg" style="height: 400px; display: block; margin: auto;" /></p>

<h1 id="here-are-a-few-notes-from-my-experiments-with-the-esp8266">Here are a few notes from my experiments with the ESP8266</h1>
<p>I have started testing  the ESP8266 as an inexpensive WiFi enabled IoT device platform. I will added specific how-to notes later but wanted to capture a few items from my initial experiments.</p>

<p>I started with the <a href="https://www.sparkfun.com/products/13231" target="_blank">Sparkfun Thing</a>, which is a nice ESP8266 dev board that supports integrated LiPo battery management. They have a nice <a href="//learn.sparkfun.com/tutorials/esp8266-thing-hookup-guide" target="_blank">Hookup Guide</a> to get you started.</p>

<p>My use case is a very simple IoT type device that will send data to a cloud service that I have developed. The cloud service will aggregate the data from multiple personal IoT devices for a user. These devices will generally be powered via LiPo battery when in use for interaction and placed in a charging tray when not in interactive use. The devices are always active but have special meaning when in interactive use.</p>

<p>These constraints mean that battery life is a critical factor, but I do not need days, months, or years of battery life. The ESP8266 is a fairly power hungry device, especially when transmitting data, but it does have some power management features, most notably <strong>deep sleep</strong>.</p>

<h2 id="notes-from-my-initial-experiments">Notes from my initial experiments:</h2>

<h3 id="the-kit">The Kit</h3>
<p>I used the <a href="//www.sparkfun.com/products/13231" target="_blank">Sparkfun Thing</a>, <a href="//www.sparkfun.com/products/9873" target="_blank">FTDIBreakout</a> for uploading code, and  <a href="//www.sparkfun.com/products/10718" target="_blank">LiPo battery</a>.</p>

<h3 id="setup">Setup</h3>
<p>An easy way to get code running is to use the <a href="//learn.sparkfun.com/tutorials/esp8266-thing-hookup-guide/installing-the-esp8266-arduino-addon" target="_blank">Arduino Addon</a> that lets you leverage the Arduino libraries in programming the ESP8266. An alternative I will try in the future is the  <a href="//github.com/nodemcu/nodemcu-firmware" target="_blank">Lua based firmware</a></p>

<p>When using the FTDI to program the board take note that GPIO0 is used to set the run mode of the firmware. 3.3V puts it in <em>run mode</em> and 0V puts it in <em>program mode (bootloader)</em>. This is easy to miss in the instructions, so be sure to connect the <em>0</em> pin to ground when you wish to upload the code from the Arduino IDE.</p>

<h2 id="power-management">Power Management</h2>
<p>To use the <em>deep sleep</em> mode on the <em>Sparkfun Thing</em> you must connect <em>XPD</em> to <em>DTR</em>. Sparkfun connected DTR to RST on the <em>Thing</em> so a short negative voltage will reset the device. When in <em>deep sleep</em> most system services are powered off, but the RTC and timer interrupt remains active for the purpose of waking the device from sleep. This is handled by the firmware once these pins are connected, however this means you will have to remove the FTDI programmer to test the deep-sleep mode.</p>

<p>The <em>deepsleep()</em> call looks a lot like a <em>delayMicroseconds()</em> call, simply pass it the number of microseconds before it should wake up again. In deep sleep mode, the ESP8266 hits about 60 ÂµA of power draw, down from its average of around 75mA, and the 200mA used while transmitting.</p>

<p>It should be possible to connect a button or some other independent sensor as an alternative to a timer based wakeup, so the device can be awaken by a button press or some physical world event.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  ESP.deepSleep(1000000);  //sleep for 1 second
</code></pre>
</div>

<h3 id="saving-state">Saving State</h3>
<p>Unlike a call to <em>delay()</em> or <em>delayMicroseconds()</em>, the <em>deepsleep()</em> function actually causes the device to power down everything except the RTC and related services. Wake is essentially a device reboot and previous state is not maintained. This means any state will need to be stored in the ESP8266 EEPROM. For this there is an EEPROM library and EEPROM.get()</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  //some struct for saved object
  struct BackupObj{
    int setting;
    int data;
  };

  //write
  int eeAddress = 0;
  EEPROM.begin(4096);  //set up memory allocation
  EEPROM.put( eeAddress, backupObj );
  EEPROM.commit();
  EEPROM.end();

  //read
  int eeAddress = 0; 
  EEPROM.begin(4096);
  EEPROM.get( eeAddress, backupObj );
  EEPROM.end();
</code></pre>
</div>

<h3 id="adding-components">Adding Components</h3>

<p>The device works well for I2C, in my case I tested with an MPU-6050.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  #include &lt;Wire.h&gt;

  void setup() {
    // ... other setup code
    Wire.begin();
    Wire.beginTransmission(MPU);
    Wire.write(0x6B);  // PWR_MGMT_1 register
    Wire.write(0);     // set to zero (wakes up the MPU-6050)
    Wire.endTransmission(true);
  }

  // using arduino's loop mechanism
  void loop(){
    // ... other loop code
    Wire.beginTransmission(MPU);
    Wire.write(0x3B);  // starting with register 0x3B (ACCEL_XOUT_H)
    Wire.endTransmission(false);
    Wire.requestFrom(MPU,14,true); 
    AcX=Wire.read()&lt;&lt;8|Wire.read();     
    AcY=Wire.read()&lt;&lt;8|Wire.read();  
    AcZ=Wire.read()&lt;&lt;8|Wire.read(); 
    // ... other loop code
  }
</code></pre>
</div>

<p>I tested using GPIO with a piezo used as a speaker. The Speaker is capable of playing simple notes using frequency of note mapped to cycles of sound and delay.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  #define NOTE_C5  523 //middle C
  #define NOTE_D5  587

  const int SPEAKER_PIN = 5;
  
  void playNote(int targetPin, long frequency, long length) {
    long delay = 1000000 / frequency / 2; 
    long cycles = frequency * length / 1000; 
    for (long i = 0; i &lt; cycle; i++) { 
      digitalWrite(targetPin, HIGH); 
      delayMicroseconds(delay); 
      digitalWrite(targetPin, LOW); 
      delayMicroseconds(delay);
    } 
  }

  long noteDuration = 500;
  long frequency = NOTE_C5;

  playNote(SPEAKER_PIN, frequency, noteDuration);
  
</code></pre>
</div>

<p>I  tested  analog sensor input in the form of a second piezo connected to the ADC pin as a knock sensor. ADC is the only analog input pin on this device.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  const int KNOCK_SENSOR = A0;
  const int KNOCK_THRESHOLD = 70;

  sensorReading = analogRead(KNOCK_SENSOR); 
  if (sensorReading &gt;= KNOCK_THRESHOLD) {
    long noteDuration = 500;
    long frequency = NOTE_E5;
    playNode(SPEAKER_PIN, frequency, noteDuration); 
  }
  
</code></pre>
</div>

<p>Finally there were enough pins remaining to hookup an RGB LED breakout. I added this test using the  <a href="//github.com/joushx/Arduino-RGB-Tools" target="_blank">RGB Tools Lib</a>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  #include &lt;RGBTools.h&gt;

  const int RED_PIN = 4; 
  const int GREEN_PIN = 12; 
  const int BLUE_PIN = 13;

  // set the RGB pins - here I used pins 4, 13, and 12
  // use RGBTools rgb(4,13,12, COMMON_CATHODE); if using a cathode RGB
  RGBTools rgb(4,13,12); 

  //set a nice red
  rgb.setColor(174,10,0);
  

</code></pre>
</div>

<p>##Conclusion
This was a quick run through to test some of the feature of the device, but even with a few sensors/actuators and a simple setup there is a nice combination of status and interaction feedback that can be performed with a simple and relatively inexpensive device. The <em>Sparkfun Thing</em> retails for around $15 right now but the <a href="//learn.adafruit.com/adafruit-huzzah-esp8266-breakout/overview" target="_blank">Huzzah</a> is under $10, and others can be found closer to $5.</p>
</div>


  <footer>
    <p class="meta">
      September 09, 2015
      
    </p>
    
      <a href="https://twitter.com/share" class="twitter-share-button" data-count="none" data-url="http://rwx.io/2015/09/09/esp8266-initial-notes.html" data-text="ESP8266 Initial Notes by @fooqri -" data-dnt="true">Twitter</a>
    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2015/08/18/self-updating-edison-app.html" title="Previous Post: Self Updating Edison Apps">&laquo; Self Updating Edison Apps</a>
      
      
        <a class="basic-alignment right" href="/2015/10/06/org-with-babel-node.html" title="Next Post: Org Mode ES2015+ Code Blocks">Org Mode ES2015+ Code Blocks &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><div id="disqus_thread"></div> <script type="text/javascript"> var disqus_shortname = 'goddio'; var disqus_url = 'http://rwx.io/2015/09/09/esp8266-initial-notes.html'; var disqus_identifier = 'http://rwx.io/2015/09/09/esp8266-initial-notes.html'; var disqus_title = 'ESP8266 Initial Notes'; (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//goddio.disqus.com/embed.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div>
  </section>

</div>

<aside class="sidebar">
  
    <section id="titles">
  <a href="http://rwx.io" title=""><img id="logo" src="http://rwx.io/images/profile.jpg" /></a>
  <h1 id="site_title"><a href="http://rwx.io" title=""></a></h1>
  <h3 id="site_subtitle">Design, development, productivity -- notes and explorations.</h3>
</section>

<section id="menu">
  <ul>
    <li><i class="fa fa-home fa-lg"></i><a href="http://rwx.io"> Home </a></li>
    <li><i class="fa fa-calendar fa-lg"></i><a href="http://rwx.io/archives/"> Archives </a></li>
    <li><i class="fa fa-user fa-lg"></i><a href="http://rwx.io/about/"> About </a></li>
    <li><i class="fa fa-rss fa-lg"></i><a href="http://rwx.io/feed/"> Feed </a></li>
  </ul>
</section>

<div id="search">
  <form action="/search" method="get">
    <input type="text" id="search-query" name="q" placeholder="Search" autocomplete="off">
  </form>
</div>

<section id="search-results" style="display: none;">
  <h1 id="search-results-heading">Search Results</h1>
  <div class="entries">
  </div>
</section>


<script id="search-results-template" type="text/mustache">
  <ul>
  {{#entries}}
      <li class="post">
        <a href="{{url}}">{{title}}</a>
      </li>
    </article>
  {{/entries}}
  </ul>
</script>


<script type="text/javascript">
  $(function() {
    $('#search-query').lunrSearch({
      indexUrl: '/js/index.json',   // Url for the .json file containing search index data
      results : '#search-results',  // selector for containing search results element
      entries : '.entries',         // selector for search entries containing element (contained within results above)
      template: '#search-results-template'  // selector for Mustache.js template
    });
  });
</script>

<section id="social">
  

  

  

  

  

  
</section>


<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2016/03/11/Org-Export-Configurations.html">Org Export Configurations</a>
      </li>
    
      <li class="post">
        <a href="/2016/03/10/Deft-and-Emacs-for-Notes.html">Deft + Org for Notes</a>
      </li>
    
      <li class="post">
        <a href="/2016/03/09/org-with-babel-node-updated.html">Org Mode ES2015+ Code Blocks (updated)</a>
      </li>
    
      <li class="post">
        <a href="/2016/01/27/ancs-example-on-blend-nano.html">ANCS Example on BLE Nano</a>
      </li>
    
      <li class="post">
        <a href="/2016/01/23/ancs-message-display.html">ANCS Message Display</a>
      </li>
    
      <li class="post">
        <a href="/2015/10/06/org-with-babel-node.html">Org Mode ES2015+ Code Blocks</a>
      </li>
    
      <li class="post">
        <a href="/2015/09/09/esp8266-initial-notes.html">ESP8266 Initial Notes</a>
      </li>
    
      <li class="post">
        <a href="/2015/08/18/self-updating-edison-app.html">Self Updating Edison Apps</a>
      </li>
    
      <li class="post">
        <a href="/2015/08/17/workbench.html">Workbench Replaces My Desk</a>
      </li>
    
      <li class="post">
        <a href="/2015/08/17/i2c-mpu-6050.html">I2C MPU-6050</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Popular Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2016/03/11/Org-Export-Configurations.html">Org Export Configurations</a>
      </li>
    
      <li class="post">
        <a href="/emacs/productivity/2013/03/04/nvalt-and-emacs.html">nvALT and Emacs</a>
      </li>
    
      <li class="post">
        <a href="/hacks/productivity/2012/01/17/screen-capture-goodness-dot-dot-dot.html">Screen capture goodness...</a>
      </li>
    
      <li class="post">
        <a href="/rubymotion/restkit/2013/03/07/getting-rklogconfigurebyname-working-in-rubymotion.html">Getting RKLogConfigureByName working in RubyMotion</a>
      </li>
    
      <li class="post">
        <a href="/hacks/productivity/2012/12/17/wiki-plus-searchable-notes.html">Wiki + searchable notes.</a>
      </li>
    
      <li class="post">
        <a href="/development/rubymotion/ios/2013/06/01/coredata-dot-sqldebug-for-rubymotion.html">CoreData.SQLDebug for RubyMotion</a>
      </li>
    
      <li class="post">
        <a href="/parsers/2012/12/30/treetop-and-parsing-expression-grammars-pegs.html">Treetop and Parsing Expression Grammars (PEGs)</a>
      </li>
    
      <li class="post">
        <a href="/poggr/google-docs/polymer/2014/10/15/spreadsheet-driven-web-apps.html">Spreadsheet Driven Web Apps</a>
      </li>
    
      <li class="post">
        <a href="/hacks/design/2013/01/01/user-stories-and-activity-diagrams.html">User Stories and Activity Diagrams</a>
      </li>
    
      <li class="post">
        <a href="/poggr/literate-coffee-script/2014/10/15/fun-with-literate-coffeescript.html">Fun with Literate CoffeeScript</a>
      </li>
    
  </ul>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 -  -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  











  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</body>
</html>
