
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head> 
  <meta charset="utf-8">
  <title>ANCS Example on BLE Nano - </title>
  <meta name="author" content="">

  
  <meta name="description" content="

  
  
    
      ANCS Example on BLE Nano
    
    
      
        










        
      
    
  




I decided to try getting Apple Notifica...">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://rwx.io/blog/2016/01/27/ancs-example-on-blend-nano/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <link href="/css/custom.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/js/search.min.js" type="text/javascript" charset="utf-8"></script>
  <link href="" rel="alternate" title="" type="application/atom+xml">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Lato:400,100,100italic,300,300italic,400italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Lora:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Source+Code+Pro:200,300,400,500,600,700,900' rel='stylesheet' type='text/css'>



 
  

  <style>html{background: linear-gradient(180deg, rgba(62, 54, 52,
  0.8) 0%, rgba(89, 79, 76, 0.8)),  url("/images/background.png") repeat;}</style>
</head>

<body   >
  <header role="banner"><hgroup>
</hgroup>

</header>
  <!-- <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav> -->
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">ANCS Example on BLE Nano</h1>
    
    
      <p class="meta">
        









<time datetime="2016-01-27T12:19:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


<div class="entry-content"><p><img src="https://s3.amazonaws.com/rwx-blog/nano.png" /></p>

<p>I decided to try getting <em>Apple Notification Center Service (ANCS)</em> working with the <a href="http://redbearlab.com/blenano/" target="_blank">RedBearLab BLE Nano</a>, and this post describes one way to get the Nordic ANCS demo running on a BLE Nano. This post shows how to get an <em>ARM</em> development environment and toolchain up and running on OS X in order to develop apps for the Nordic BLE SoC’s (e.g. nRF51822 based boards like the BLE Nano).</p>

<p>There are a few options for developing applications for the BLE Nano:</p>

<ol>
  <li>Using the <em>Nordic nRF5 BLE SDK</em> along with the  <em>arm-gcc</em> compiler. This requires setting up a toolchain on your local development machine (Mac OS X in my case).</li>
  <li>Using <a href="http://mbed.org" target="_blank">mbed.org</a> and the <a href="https://developer.mbed.org/teams/Bluetooth-Low-Energy/" target="_blank">mbed Bluetooth Low Energy API</a>. This is the fastest way to get started, but unfortunately at the time of this post the API does not yet support peripherals as GATT Clients, and thus does not support ANCS development.</li>
  <li>Using the Arduino SDK along with the <a href="https://github.com/RedBearLab/nRF51822-Arduino" target="_blank">nRF51822-Arduino add-on</a>. I am not sure whether this add-on would support peripherals as GATT Clients either, and haven’t yet investigated the option.</li>
</ol>

<p>I decided to start with approach 1 since it seemed like the most stable approach to development. Below I describe my steps to getting the environment set up on OS X. For more on approach 2 &amp; 3 see <a href="http://redbearlab.com/getting-started-nrf51822" target="_blank">Getting Started with nRF51822</a></p>

<h2 id="setting-up-the-tool-chain-on-os-x">Setting Up the Tool Chain on OS X</h2>

<p>Install the <em>arm-gcc compiler</em> for OS X so you can compile for ARM devices. Fortunately both <em>HomeBrew</em> and <em>MacPorts</em> have recipes for installing the compiler. Pick the one that works for you. If you don’t have either HomeBrew or MacPorts installed please install one of them before proceeding.</p>

<p>Install the gcc-arm compiler using either <em>brew</em> command (HomeBrew) or <em>port</em> command (MacPorts):</p>

<div class="highlighter-rouge"><pre class="highlight"><code>brew install gcc-arm-none-eabi
</code></pre>
</div>

<p>or</p>

<div class="highlighter-rouge"><pre class="highlight"><code>port install arm-none-eabi-gcc
</code></pre>
</div>

<p><em>Note: If you get a permissions error you may need to prepend the sudo command to provide brew/port with enhanced security privileges.</em></p>

<p>You will need to save the location of the arm-gcc compiler for updating the nRF5 toolchain config files later. In my case it was located in</p>

<div class="highlighter-rouge"><pre class="highlight"><code>/usr/local/gcc_arm/gcc-arm-none-eabi-5_2-2015q4/
</code></pre>
</div>

<p>you will also need the compiler version number, just run the command below and write down the resulting version number</p>

<div class="highlighter-rouge"><pre class="highlight"><code>/usr/local/gcc_arm/gcc-arm-none-eabi-5_2-2015q4/bin/arm-none-eabi-gcc  --version 
</code></pre>
</div>

<p>In my case the <em>/arm-none-eabi-gcc</em> version was <em>5.2.1</em></p>

<h2 id="download-the-nordic-sdk">Download the Nordic SDK</h2>
<p>The next step is to download the <a href="http://developer.nordicsemi.com/nRF5_SDK/" target="_blank">Nordic nRF5 SDK</a> I chose <em>nRF51_SDK_v10.x.x</em>. Unzip into a location that will be your working directory for the project.</p>

<h2 id="download-the-nordic-soft-device-ble-protocol-stack">Download the Nordic Soft Device BLE Protocol Stack</h2>
<p>Nordic uses the term <em>Soft Device</em> to refer to its BLE protocol stack. I chose to use <em>S130-SD</em>, it can be downloaded from the <a href="http://www.nordicsemi.com/eng/Products/Bluetooth-Smart-Bluetooth-low-energy/nRF51822#Downloads" target="_blank">Nordic Download Page</a> under soft devices.</p>

<p>You will need to reference the soft device later, so I suggest saving it in your working directory at the same level you saved the SDK so it is easy to find.</p>

<h2 id="updating-the-sdk-configuration">Updating the SDK configuration</h2>
<p>The next step is to modify the SDK configuration to point to your arm-gcc compiler. In your SDK directory edit <em>components/toolchain/gcc/Makefile.posix</em> to correct the <em>GNU_INSTALL_ROOT</em> and <em>GNU_VERSION</em>.  <strong>GNU_INSTALL_ROOT</strong> should be the location of the arm-gcc compiler directory.  <em>*GNU_VERSIO</em>N* should be the version number of the arm-gcc compiler that I mentioned above. My <em>Makefile.posix</em> file looks like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>GNU_INSTALL_ROOT := /usr/local/gcc_arm/gcc-arm-none-eabi-5_2-2015q4/
GNU_VERSION := 5.2.1 
GNU_PREFIX := arm-none-eabi
</code></pre>
</div>

<h2 id="compile-the-ancs-example">Compile the ANCS example</h2>

<p>The ANCS example is located in the sdk driectory under the <strong>examples</strong> subdirectory. Change to the subdirectory for the ble_app_ancs_c example. For example from the main SDK directory:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>cd examples/ble_peripheral/ble_app_ancs_c
</code></pre>
</div>

<p>Like all the examples the ble_app_ancs_c directory contains <em>board package</em> subdirectories that are set up for the various development boards. For my test I changed to subdirectory:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>pca10028/s130/armgcc/
</code></pre>
</div>

<p>This is essentially choosing the example created for <em>board package</em> <strong>pca10028</strong> and <em>soft device</em> <strong>s130</strong> and finally the <strong>armgcc</strong> build directory.</p>

<p>In this directory your will find a Makefile for compiling this example, so run <strong>make</strong> to compile the example.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>make
</code></pre>
</div>

<p>The compilation process will create a new subdirectory called <strong>_build</strong> that will hold the output of the compile. The key file for our purposes will be the one with a <strong>.hex</strong> extension. In my case is was named <em>nrf51422_xxac_s130.hex</em>. This is the hex code that will be loaded by the bootloader on the BLE Nano’s nRF51822 SoC.</p>

<p>Since the nRF51 device is completely flash based. All the executable code, including Nordic’s “Soft Device” protocol stack and your applications, is programmed in this flash memory. The soft device is always in the lower region of the flash, using up to 128 kB, and the rest of the upper region of flash is available for your application. So before your applications hex code can be loaded on the BLE Nano, it must be merged with the hex code for the soft device, in this case the <em>S130</em> hex code.</p>

<p>To manipulate hex code you will need the <strong>srecord</strong> tool, which can be installed with HomeBrew or MacPorts.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>brew install srecord 
</code></pre>
</div>

<p>or</p>

<div class="highlighter-rouge"><pre class="highlight"><code>port install srecord
</code></pre>
</div>

<h2 id="merging-application-hex-code-with-soft-device-hex-code">Merging application Hex Code with Soft Device Hex Code.</h2>

<p>Assuming the <em>S130 Soft Device</em> code was uncompressed into the same working directory as the sdk and was named <em>s130_nrf51_1.0.0</em> and the example application hex code file was named <em>nrf51422_xxac_s130.hex</em>. Then from inside the <em>_build</em> directory created above we could merge the hex code files with the following command.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>srec_cat &lt;SDK_DIRECTORY&gt;/s130_nrf51_1.0.0/s130_nrf51_1.0.0_softdevice.hex -intel nrf51422_xxac_s130.hex  -intel -o ancs.hex -intel --line-length=44
</code></pre>
</div>

<p>The above command would create a new (combined) hex code file in _build named <strong>ancs.hex</strong></p>

<h2 id="loading-the-code-on-the-ble-nano">Loading the code on the BLE Nano</h2>

<p><img src="https://s3.amazonaws.com/rwx-blog/nano2.png" /></p>

<p>This is the easy part. With the BLE Nano piggy backing on its MK20 USB board and plugged into a USB port, a folder named MBED should appear on your desktop (at least that is what it is named in my case). Just drag the combined hex file we created above <em>(ancs.hex)</em> to the MBED folder associated with the Nano device. The bootloader should load the new code, and the USB device may disappear momentarily from the desktop, then reappear.</p>

<h2 id="test-that-the-ancs-application-was-loaded-correctly">Test that the ANCS application was loaded correctly</h2>
<p>On an iPhone, open the <em>Settings</em> app, and choose <em>Bluetooth</em> and make sure Bluetooth is on. Under Devices you should see ANCS appear, and by tapping ANCS you should be able to successfully pair with the device.</p>

<h2 id="next-steps">Next Steps</h2>
<p>The goal of this process was to get the ARM toolchain and Nordic SDK set up, next steps would be to use the ANCS example as a starting point to develop a custom ANCS app for some device that utilizes the BLE Nano. I hope to post some examples in the future as I work with the Nano more.</p>
</div>


  <footer>
    <p class="meta">
      January 27, 2016
      
    </p>
    
      <a href="https://twitter.com/share" class="twitter-share-button" data-count="none" data-url="http://rwx.io/blog/2016/01/27/ancs-example-on-blend-nano/" data-text="ANCS Example on BLE Nano by @rwxstar -" data-dnt="true">Twitter</a>
    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2016/01/23/ancs-message-display/" title="Previous Post: ANCS Message Display">&laquo; ANCS Message Display</a>
      
      
        <a class="basic-alignment right" href="/blog/2016/03/09/org-with-babel-node-updated/" title="Next Post: Org Mode ES2015+ Code Blocks (updated)">Org Mode ES2015+ Code Blocks (updated) &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><div id="disqus_thread"></div> <script type="text/javascript"> var disqus_shortname = 'goddio'; var disqus_url = 'http://rwx.io/blog/2016/01/27/ancs-example-on-blend-nano/'; var disqus_identifier = 'http://rwx.io/blog/2016/01/27/ancs-example-on-blend-nano/'; var disqus_title = 'ANCS Example on BLE Nano'; (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//goddio.disqus.com/embed.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div>
  </section>

</div>

<aside class="sidebar">
  
    <section id="titles">
  <a href="http://rwx.io" title=""><img id="logo" src="http://rwx.io/images/profile.jpg" /></a>
  <h1 id="site_title"><a href="http://rwx.io" title=""></a></h1>
  <h3 id="site_subtitle">Design, development, productivity -- notes and explorations.</h3>
</section>

<section id="menu">
  <ul>
    <li><i class="fa fa-home fa-lg"></i><a href="http://rwx.io"> Home </a></li>
    <li><i class="fa fa-calendar fa-lg"></i><a href="http://rwx.io/archives/"> Archives </a></li>
    <li><i class="fa fa-user fa-lg"></i><a href="http://rwx.io/about/"> About </a></li>
    <li><i class="fa fa-rss fa-lg"></i><a href="http://rwx.io/feed/"> Feed </a></li>
    <li><i class="fa fa-twitter fa-lg"></i><a href="https://twitter.com/rwxstar"> Twitter</a></li>
    <li><i class="fa fa-linkedin fa-lg"></i><a href="https://www.linkedin.com/in/goddi"> LinkedIn</a></li>
  </ul>
</section>

<div id="search">
  <form action="/search" method="get">
    <input type="text" id="search-query" name="q" placeholder="Search" autocomplete="off">
  </form>
</div>

<section id="search-results" style="display: none;">
  <h1 id="search-results-heading">Search Results</h1>
  <div class="entries">
  </div>
</section>


<script id="search-results-template" type="text/mustache">
  <ul>
  {{#entries}}
      <li class="post">
        <a href="{{url}}">{{title}}</a>
      </li>
    </article>
  {{/entries}}
  </ul>
</script>


<script type="text/javascript">
  $(function() {
    $('#search-query').lunrSearch({
      indexUrl: '/js/index.json',   // Url for the .json file containing search index data
      results : '#search-results',  // selector for containing search results element
      entries : '.entries',         // selector for search entries containing element (contained within results above)
      template: '#search-results-template'  // selector for Mustache.js template
    });
  });
</script>

<section id="social">
  

  

  

  

  

  
</section>


<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/04/08/bp-pyaudioanalysis/">Simple Audio Analysis with pyAudioAnalysis</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/11/Org-Export-Configurations/">Org Export Configurations</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/10/Deft-and-Emacs-for-Notes/">Deft + Org for Notes</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/09/org-with-babel-node-updated/">Org Mode ES2015+ Code Blocks (updated)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/01/27/ancs-example-on-blend-nano/">ANCS Example on BLE Nano</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/01/23/ancs-message-display/">ANCS Message Display</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/10/06/org-with-babel-node/">Org Mode ES2015+ Code Blocks</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/09/esp8266-initial-notes/">ESP8266 Initial Notes</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/18/self-updating-edison-app/">Self Updating Edison Apps</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/17/workbench/">Workbench Replaces My Desk</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Popular Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/04/08/bp-pyaudioanalysis/">Simple Audio Analysis with pyAudioAnalysis</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/03/07/getting-rklogconfigurebyname-working-in-rubymotion/">Getting RKLogConfigureByName working in RubyMotion</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/01/17/screen-capture-goodness-dot-dot-dot/">Screen capture goodness...</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/01/coredata-dot-sqldebug-for-rubymotion/">CoreData.SQLDebug for RubyMotion</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/17/wiki-plus-searchable-notes/">Wiki + searchable notes.</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/15/spreadsheet-driven-web-apps/">Spreadsheet Driven Web Apps</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/30/treetop-and-parsing-expression-grammars-pegs/">Treetop and Parsing Expression Grammars (PEGs)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/15/fun-with-literate-coffeescript/">Fun with Literate CoffeeScript</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/01/user-stories-and-activity-diagrams/">User Stories and Activity Diagrams</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/17/d3-charts-wrapping-nvd3-charts-web-component/">d3 charts - wrapping 'NVD3 Charts' in a web component</a>
      </li>
    
  </ul>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 -  -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  











  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</body>
</html>
