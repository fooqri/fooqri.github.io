
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head> 
  <meta charset="utf-8">
  <title>Simple Audio Analysis with pyAudioAnalysis - </title>
  <meta name="author" content="">

  
  <meta name="description" content="

  
  
    
      Simple Audio Analysis with pyAudioAnalysis
    
    
      
        










        
      
    
  


I had a need to do some...">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://rwx.io/blog/2016/04/08/bp-pyaudioanalysis/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <link href="/css/custom.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/js/search.min.js" type="text/javascript" charset="utf-8"></script>
  <link href="" rel="alternate" title="" type="application/atom+xml">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Lato:400,100,100italic,300,300italic,400italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Lora:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Source+Code+Pro:200,300,400,500,600,700,900' rel='stylesheet' type='text/css'>



 
  

  <style>html{background: linear-gradient(180deg, rgba(62, 54, 52,
  0.8) 0%, rgba(89, 79, 76, 0.8)),  url("/images/background.png") repeat;}</style>
</head>

<body   >
  <header role="banner"><hgroup>
</hgroup>

</header>
  <!-- <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav> -->
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Simple Audio Analysis with pyAudioAnalysis</h1>
    
    
      <p class="meta">
        









<time datetime="2016-04-08T00:00:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>I had a need to do some classification of sets of environmental audio files so started looking for an easy to use Python library that was up for the task. Here are my notes on setting up the <a href="https://github.com/tyiannak/pyAudioAnalysis">pyAudioAnalysis Library</a> for simple audio classification task.</p>

<h1 id="installation">Installation</h1>

<p>This library relies on <strong>Python 2</strong>, so do a quick <em>python â€“version</em> to make sure you are not on <strong>Python 3</strong>. If both are installed on your machine they may be accessible as <em>python</em> and <em>python3</em></p>

<h2 id="dependencies">Dependencies</h2>

<p>You will need to make sure the following modules are installed:</p>

<ul>
  <li>numpy</li>
  <li>matplotlib</li>
  <li>scipy</li>
  <li>gsl</li>
  <li>mlpy</li>
  <li>scikit-learn (v 0.16.1)</li>
  <li>Simplejson</li>
</ul>

<p>Note that the <a href="https://www.continuum.io/downloads">Anaconda</a> Python 2.7 distribution has many of these packages already included, but you need <em>scikit-learn (v 0.16.1)</em> and the latest <em>Anaconda</em> distribution delivers the <em>0.17.1</em> version.  If you get an error message referencing a missing <em>hmm</em> component, you likely have the <em>0.17.*</em> version of scikit-learn, as <em>hmm</em> was deprecated in that version.</p>

<p>When the dependencies are all verified or installed, simply clone the repo into a directory you want to use for development.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>mkdir ~/audioClassification
cd audioClassification
mkdir trainingData
mkdir sampleData
git clone https://github.com/tyiannak/pyAudioAnalysis.git
</code></pre>
</div>

<h1 id="training-data">Training Data</h1>

<p>The simplest way to get started it to create sub directories under <em>trainingData</em> for each sound category you wish to recognize. For this example lets use these</p>

<div class="highlighter-rouge"><pre class="highlight"><code>mkdir trainingData/breaking_glass 
mkdir trainingData/bubbles 
mkdir trainingData/vacuum
</code></pre>
</div>

<p>Next do a Google search looking for free audio files to add to the <em>trainingData</em> directory: e.g. <em>breaking glass audio wav free</em>, then for bubble sounds try <em>bubbles audio wav free</em>, finally for vacuum sounds try <em>vacuum audio wav free</em>. Save a dozen or so examples of each sound into the corresponding sub-directory under <em>trainingData</em>. The <em>pyAudioAnalysis</em> library requires wav files, so make sure any files you save to <em>trainingData</em> are wav files.</p>

<h1 id="sample-data">Sample Data</h1>

<p>Next add some audio samples that can be used to test the training. The search is the same as above, but just choose different sample files, so you can test how well the classification model works. You can save them directly under the <em>sampleData</em> directory for this example. It is also good to choose a few random other sounds to see how they are interpreted by the classification model.</p>

<h1 id="scripts">Scripts</h1>

<p>I wrote two quick scripts to do the classification and test a file against the classification model.</p>

<h2 id="createclassifiermodel-script">createClassifierModel Script</h2>

<p>From inside the <em>audioClassification</em> directory</p>

<div class="highlighter-rouge"><pre class="highlight"><code>touch createClassifierModel
chmod +x createClassifierModel
</code></pre>
</div>

<p>In your favorite editor open <em>createClassifierModel</em> and add the following code:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c">#!/usr/local/bin/python2</span>
<span class="kn">from</span> <span class="nn">pyAudioAnalysis</span> <span class="kn">import</span> <span class="n">audioTrainTest</span> <span class="k">as</span> <span class="n">aT</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>
<span class="n">script</span><span class="p">,</span> <span class="n">dirname</span> <span class="o">=</span> <span class="n">argv</span>

<span class="n">subdirectories</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dirname</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span>
<span class="n">subdirectories</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">subdirectories</span> <span class="o">=</span> <span class="p">[</span><span class="n">dirname</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">subDirName</span> <span class="k">for</span> <span class="n">subDirName</span> <span class="ow">in</span> <span class="n">subdirectories</span><span class="p">]</span>

<span class="k">print</span><span class="p">(</span><span class="n">subdirectories</span><span class="p">)</span>
<span class="n">aT</span><span class="o">.</span><span class="n">featureAndTrain</span><span class="p">(</span><span class="n">subdirectories</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">aT</span><span class="o">.</span><span class="n">shortTermWindow</span><span class="p">,</span> <span class="n">aT</span><span class="o">.</span><span class="n">shortTermStep</span><span class="p">,</span> <span class="s">"svm"</span><span class="p">,</span> <span class="s">"svmModel"</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
</code></pre>
</div>

<h2 id="testclassifiermodel-script">testClassifierModel Script</h2>

<p>From inside the <em>audioClassification</em> directory</p>

<div class="highlighter-rouge"><pre class="highlight"><code>touch testClassifierModel
chmod +x testClassifierModel
</code></pre>
</div>

<p>In your favorite editor open <em>testClassifierModel</em> and add the following code:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c">#!/usr/local/bin/python2</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pyAudioAnalysis</span> <span class="kn">import</span> <span class="n">audioTrainTest</span> <span class="k">as</span> <span class="n">aT</span>
<span class="n">script</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">argv</span>
<span class="n">isSignificant</span> <span class="o">=</span> <span class="mf">0.8</span> <span class="c">#try different values.</span>

<span class="c"># P: list of probabilities</span>
<span class="n">Result</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">classNames</span> <span class="o">=</span> <span class="n">aT</span><span class="o">.</span><span class="n">fileClassification</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">"svmModel"</span><span class="p">,</span> <span class="s">"svm"</span><span class="p">)</span>
<span class="n">winner</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">P</span><span class="p">)</span> <span class="c">#pick the result with the highest probability value.</span>

<span class="c"># is the highest value found above the isSignificant threshhold? </span>
<span class="k">if</span> <span class="n">P</span><span class="p">[</span><span class="n">winner</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">isSignificant</span> <span class="p">:</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"File: "</span> <span class="o">+</span><span class="n">filename</span> <span class="o">+</span> <span class="s">" is in category: "</span> <span class="o">+</span> <span class="n">classNames</span><span class="p">[</span><span class="n">winner</span><span class="p">]</span> <span class="o">+</span> <span class="s">", with probability: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">winner</span><span class="p">]))</span>
<span class="k">else</span> <span class="p">:</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"Can't classify sound: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">P</span><span class="p">))</span>
</code></pre>
</div>

<h1 id="run-the-createclassifiermodel-script">Run the createClassifierModel Script</h1>

<p>To create a classification model simply run the <em>createClassifierMode</em> script and pass in the name of the training directory as an argument to the script.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>createClassifierModel trainingData
</code></pre>
</div>

<p>Below is an example output of the script.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>                breaking_glass                  bubbles                 vacuum          OVERALL
        C       PRE     REC     F1      PRE     REC     F1      PRE     REC     F1      ACC     F1
        0.001   58.1    100.0   73.5    100.0   56.0    71.8    33.3    0.0     0.0     64.0    48.4
        0.010   83.7    100.0   91.1    100.0   95.0    97.4    98.5    65.0    78.3    90.0    89.0     best F1         best Acc
        0.500   80.0    94.0    86.4    100.0   99.0    99.5    81.8    54.0    65.1    85.2    83.7
        1.000   79.8    98.5    88.1    100.0   91.0    95.3    91.9    57.0    70.4    86.2    84.6
        5.000   79.4    94.5    86.3    100.0   93.0    96.4    81.2    56.0    66.3    84.5    83.0
        10.000  77.7    97.5    86.5    100.0   89.0    94.2    90.0    54.0    67.5    84.5    82.7
Confusion Matrix:
        bre     bub     vac
bre     50.0    0.0     0.0
bub     1.0     23.7    0.3
vac     8.8     0.0     16.2
Selected params: 0.01000
</code></pre>
</div>

<h1 id="run-the-testclassifiermodel-script">Run the testClassifierModel Script</h1>

<p>To categorize an audio file simply pass the file name as an argument to the <em>testClassifierModel</em> script. In the example below a sample was named <em>bubbles1.wav</em></p>

<div class="highlighter-rouge"><pre class="highlight"><code>testClassifierModel sampleData/bubbles1.wav
</code></pre>
</div>

<p>Below is an example output of the script.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>File: sampleData/bubbles1.wav is in category: bubbles, with probability: 0.95486693161
</code></pre>
</div>

<h1 id="potential-gotchas">Potential GOTCHAS</h1>

<p>One issue is that not all <em>wav</em> files will be understood by the <em>wavfile.py</em> library. If the classification hangs or aborts then it is possible one of the downloaded wav files is the issue. I found the simple solution was to add a line to <em>wavefile.py</em> that printed the filename currently being worked on so I could see what was happening the first time using a new set of training files.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>for me this is the location
/usr/local/lib/python2.7/site-packages/scipy/io/wavfile.py

datadef read(filename, mmap=False):
    """
    Return the sample rate (in samples/sec) and data from a WAV file

    Parameters
    ----------
    filename : string or open file handle
        Input wav file.
    mmap : bool, optional
        Whether to read data as memory mapped.
        Only to be used on real files (Default: False)

        .. versionadded:: 0.12.0

    Returns
    -------
    rate : int
        Sample rate of wav file
    data : numpy array
        Data read from wav file

    Notes
    -----
    * The file can be an open file or a filename.
    * The returned sample rate is a Python integer.
    * The data is returned as a numpy array with a data-type determined
      from the file.
    * This function cannot read wav files with 24 bit data.

    """
    print("FILENAME: " + filename)
</code></pre>
</div>

<h1 id="conclusion">Conclusion</h1>

<p>This was a basic intro to help you get started with <a href="https://github.com/tyiannak/pyAudioAnalysis">pyAudioAnalysis</a> library, check out the <a href="https://github.com/tyiannak/pyAudioAnalysis/wiki">project wiki page</a> for more use case for the library including other classification model options, as well as feature extraction, segmentation and visualization capabilities.</p>
</div>


  <footer>
    <p class="meta">
      April 08, 2016
      
    </p>
    
      <a href="https://twitter.com/share" class="twitter-share-button" data-count="none" data-url="http://rwx.io/blog/2016/04/08/bp-pyaudioanalysis/" data-text="Simple Audio Analysis with pyAudioAnalysis by @rwxstar -" data-dnt="true">Twitter</a>
    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2016/03/11/Org-Export-Configurations/" title="Previous Post: Org Export Configurations">&laquo; Org Export Configurations</a>
      
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section id="titles">
  <a href="http://rwx.io" title=""><img id="logo" src="http://rwx.io/images/profile.jpg" /></a>
  <h1 id="site_title"><a href="http://rwx.io" title=""></a></h1>
  <h3 id="site_subtitle">Design, development, productivity -- notes and explorations.</h3>
</section>

<section id="menu">
  <ul>
    <li><i class="fa fa-home fa-lg"></i><a href="http://rwx.io"> Home </a></li>
    <li><i class="fa fa-calendar fa-lg"></i><a href="http://rwx.io/archives/"> Archives </a></li>
    <li><i class="fa fa-user fa-lg"></i><a href="http://rwx.io/about/"> About </a></li>
    <li><i class="fa fa-rss fa-lg"></i><a href="http://rwx.io/feed/"> Feed </a></li>
    <li><i class="fa fa-twitter fa-lg"></i><a href="https://twitter.com/fooqri"> Twitter</a></li>
    <li><i class="fa fa-linkedin fa-lg"></i><a href="https://www.linkedin.com/in/goddi"> LinkedIn</a></li>
  </ul>
</section>

<div id="search">
  <form action="/search" method="get">
    <input type="text" id="search-query" name="q" placeholder="Search" autocomplete="off">
  </form>
</div>

<section id="search-results" style="display: none;">
  <h1 id="search-results-heading">Search Results</h1>
  <div class="entries">
  </div>
</section>


<script id="search-results-template" type="text/mustache">
  <ul>
  {{#entries}}
      <li class="post">
        <a href="{{url}}">{{title}}</a>
      </li>
    </article>
  {{/entries}}
  </ul>
</script>


<script type="text/javascript">
  $(function() {
    $('#search-query').lunrSearch({
      indexUrl: '/js/index.json',   // Url for the .json file containing search index data
      results : '#search-results',  // selector for containing search results element
      entries : '.entries',         // selector for search entries containing element (contained within results above)
      template: '#search-results-template'  // selector for Mustache.js template
    });
  });
</script>

<section id="social">
  

  

  

  

  

  
</section>


<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/04/08/bp-pyaudioanalysis/">Simple Audio Analysis with pyAudioAnalysis</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/11/Org-Export-Configurations/">Org Export Configurations</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/10/Deft-and-Emacs-for-Notes/">Deft + Org for Notes</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/09/org-with-babel-node-updated/">Org Mode ES2015+ Code Blocks (updated)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/01/27/ancs-example-on-blend-nano/">ANCS Example on BLE Nano</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/01/23/ancs-message-display/">ANCS Message Display</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/10/06/org-with-babel-node/">Org Mode ES2015+ Code Blocks</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/09/esp8266-initial-notes/">ESP8266 Initial Notes</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/18/self-updating-edison-app/">Self Updating Edison Apps</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/17/workbench/">Workbench Replaces My Desk</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Popular Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/04/08/bp-pyaudioanalysis/">Simple Audio Analysis with pyAudioAnalysis</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/03/07/getting-rklogconfigurebyname-working-in-rubymotion/">Getting RKLogConfigureByName working in RubyMotion</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/01/17/screen-capture-goodness-dot-dot-dot/">Screen capture goodness...</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/01/coredata-dot-sqldebug-for-rubymotion/">CoreData.SQLDebug for RubyMotion</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/17/wiki-plus-searchable-notes/">Wiki + searchable notes.</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/15/spreadsheet-driven-web-apps/">Spreadsheet Driven Web Apps</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/30/treetop-and-parsing-expression-grammars-pegs/">Treetop and Parsing Expression Grammars (PEGs)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/15/fun-with-literate-coffeescript/">Fun with Literate CoffeeScript</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/01/user-stories-and-activity-diagrams/">User Stories and Activity Diagrams</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/17/d3-charts-wrapping-nvd3-charts-web-component/">d3 charts - wrapping 'NVD3 Charts' in a web component</a>
      </li>
    
  </ul>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 -  -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  











  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</body>
</html>
