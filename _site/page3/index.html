
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head> 
  <meta charset="utf-8">
  <title>rwx.io: Design, development, productivity – notes and explorations.  - </title>
  <meta name="author" content="">

  
  <meta name="description" content="
  
  
  
    
      
  
    
      Org Export Configurations
    
    
      
        










        
      
    
  


  Emacs org mode offers...">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://rwx.io/page3/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <link href="/css/custom.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <script src="/js/search.min.js" type="text/javascript" charset="utf-8"></script>
  <link href="" rel="alternate" title="" type="application/atom+xml">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Lato:400,100,100italic,300,300italic,400italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Lora:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Source+Code+Pro:200,300,400,500,600,700,900' rel='stylesheet' type='text/css'>



 
  

  <style>html{background: linear-gradient(180deg, rgba(62, 54, 52,
  0.8) 0%, rgba(89, 79, 76, 0.8)),  url("/images/background.png") repeat;}</style>
</head>

<body   >
  <header role="banner"><hgroup>
</hgroup>

</header>
  <!-- <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav> -->
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2016/03/11/Org-Export-Configurations.html">Org Export Configurations</a></h1>
    
    
      <p class="meta">
        









<time datetime="2016-03-11T00:00:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Emacs <em>org mode</em> offers a variety of export options that make it easy to look at your notes in different formats, or perhaps make them available for others to view. Three I use regularly are <em>markdown</em>, <em>mindmap</em>, and <em>reveal presentation</em>.</p>

<h1 id="my-approach-to-note-taking">My approach to Note Taking</h1>

<p>The best way to learn something is to sumarize the topic in your own words, in your own context, and present it to others with concrete examples. But in many cases notes must also serve to provide details that are easily forgotten like code snippets, checklists, etc. Even with detailed notes it is important to refactor the information into your own context to aid learning the topic. For this reason many of my notes on a topic have a <em>summary</em> section and a <em>details</em> section both organized in an org document.</p>

<p>Another purpose for notes is information logging, such as meeting notes, project team notes, daily journal, etc. Although <em>org</em> does an excellent job of supporting information logging and task management, I will leave that as a topic for a future post.</p>

<p>Ideally the summary of a topic can easily be converted to a presentation, and the details can be converted to a markdown document.   I will describe below how to accomplish this. Further I will describe how to convert the notes to OPML so it can be explored as a mindmap. Also see <a href="http://rwx.io/blog/2016/03/10/Deft-and-Emacs-for-Notes/">Deft + Org for Notes</a> for information on quick search of all notes.</p>

<h1 id="setting-export-directory">Setting Export Directory</h1>

<p>I want to keep everything under the org directory but to keep things tidy create sub directories by export type. The code snippet below when placed in init.el will set the correct export directory based on export type. Thus <em>opml</em> documents will be kept in <code class="highlighter-rouge">~/org/export_opml/</code>, <em>markdown</em> documents in <code class="highlighter-rouge">~/org/export_md/</code>, and <em>html</em> documents in <code class="highlighter-rouge">~/org/export_md/</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code>(defvar org-export-output-directory-prefix "export_" "prefix of directory used for org-mode export")

(defadvice org-export-output-file-name (before org-add-export-dir activate)
  "Modifies org-export to place exported files in a different directory"
  (when (not pub-dir)
      (setq pub-dir (concat org-export-output-directory-prefix (substring extension 1)))
      (when (not (file-directory-p pub-dir))
       (make-directory pub-dir))))
</code></pre>
</div>

<h1 id="exporting-to-markdown">Exporting to Markdown</h1>

<p>The configuration below will export markdown every time an org file is saved. It will also save a copy of the exported file to my Google Drive folder. This way my notes are always available from any web browser. The <a href="https://chrome.google.com/webstore/detail/minimalist-markdown-edito/pghodfjepegmciihfhdipmimghiakcjf?hl=en">Minamalist Markdown Editor</a> is a nice tool for viewing these documents on a Chromebook.</p>

<p>The (C-c m) keyboard sequence will open the markdown version of the current buffer in Marked 2. Because all notes are automatically converted the <em>Marked 2</em> app will also allow you to follow note links to any interlinked notes. <em>Marked 2</em> provides a very nice reading interface for detailed notes so having this option is handy.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(defun export-org-md-command-events ()
  (interactive)
  (let* ((md-original-filename (concat (file-name-directory buffer-file-name) "export_md/" (file-name-sans-extension (file-name-nondirectory buffer-file-name)) ".md"))
         (google-drive-filename (concat  "../Google Drive/notes/" (file-name-sans-extension (file-name-nondirectory buffer-file-name)) ".md"))) 
    (execute-kbd-macro (kbd "C-c C-e m m"))
    (copy-file  md-original-filename google-drive-filename t)
    (message  "Saved to Google Drive: %s" (concat (file-name-sans-extension (file-name-nondirectory buffer-file-name)) ".md")) )
  )

;; Auto-export org files to Markdown when saved
(defun org-mode-export-hook ()
  (when (equal major-mode 'org-mode)
    (add-hook 'after-save-hook 'export-org-md-command-events t t)
  )
)

(defun markdown-preview-file ()
  "run Marked on the current file and revert the buffer"
  (interactive)
  (execute-kbd-macro (kbd "C-c C-e m m"))
  (shell-command
   (format "open -a /Applications/Marked2.app %s" 
       (shell-quote-argument (concat (file-name-directory buffer-file-name) "export_md/" (file-name-sans-extension (file-name-nondirectory buffer-file-name)) ".md"))))
  )

(global-set-key (kbd "C-c m") 'markdown-preview-file)
</code></pre>
</div>

<p>The markdown conversion works well but if you need to you can  embed markdown directly into your org document at any time using a markdown block. This will allow the markdown to pass through during export so it will be handled properly by the markdown rendering app.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>#+BEGIN_SRC js  :results output drawer
  var s = "JavaScript syntax highlighting"; 
  alert(s);
#+END_SRC
</code></pre>
</div>

<h1 id="exporting-to-mindmap">Exporting to Mindmap</h1>

<p>Mindmaps are a visualization of an outline, and since org mode specializes in keeping notes in a hierarchical fashion it is fairly easy to convert notes to mindmaps. OPML is an XML format for outlines that is supported by all mindmapping  apps. You can use <a href="https://www.emacswiki.org/emacs/FreeMind">org-freemind</a> to do mindmaps, but I use <a href="https://github.com/edavis/org-opml">org-opml</a> instead. Follow the <a href="https://github.com/edavis/org-opml">org-opml</a> installation instructions.</p>

<p>I also use a slight customization of the ox-opml.el file delivered with <a href="https://github.com/edavis/org-opml">org-opml</a>, because I use iThoughtsX and think it is cleaner to put paragraph blocks in notes rather than have them forced into a topic bubble.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>;; modify original ox-opml.el to put paragraphs into the notes attribute of a topic
;; instead of displaying paragraph as topic name.  
(defun org-opml-paragraph (paragraph contents info)
  (let* ((parent (org-element-type (org-export-get-parent paragraph)))
         (text (clean-text contents)))
    ;; Only display paragraphs when not in a list item
    (unless (eq parent 'item)
      (format "&lt;outline text='notes' note='%s' structure=\"paragraph\"/&gt;"  text))))

(defun org-opml-item (item contents info)
  (let* ((p (car (org-element-contents item)))
         (elements (org-element-contents p))
         (text (mapconcat
                (lambda (el)
                  (cond ((stringp el) (clean-text el))
                        ((equal (car el) 'link)  
                         (let ((url (org-element-property :raw-link el))
                               (text (org-element-contents el)))
                           (clean-text (format "%s" (car text)))))
                        ((equal (car el) 'italic)
                         (format "/%s/" (car (org-element-contents el))))
                        ((equal (car el) 'bold)
                         (format "*%s*" (car (org-element-contents el))))
                        ((equal (car el) 'verbatim)
                         (format "=%s=" (org-element-property :value el)))))
                elements " ")))
    (format "&lt;outline text='%s' structure='list'&gt;%s&lt;/outline&gt;" text contents)))
</code></pre>
</div>

<p>A second modification I use is to change the key-bindings for export because they conflict with markdown export. Below I changed the <code class="highlighter-rouge">?m</code> in the original <code class="highlighter-rouge">ox-opml.el</code> file to <code class="highlighter-rouge">?g</code> so <code class="highlighter-rouge">Export to OPML</code> will appear in the org export menu under the <code class="highlighter-rouge">g</code> key, and not <code class="highlighter-rouge">m</code> key</p>

<div class="highlighter-rouge"><pre class="highlight"><code>:menu-entry '(?g "Export to OPML"
                 (lambda (a s v b) (org-opml-export-to-opml a s v b)))
</code></pre>
</div>

<p>The Lisp snippet below can be added to init.el and will allow viewing an org buffer as a mindmap using iThoughtsX with the (C-c o) keyboard sequence.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(defun opml-preview-file ()
  "run iThoughtsX on the current file and revert the buffer"
  (interactive)
  (execute-kbd-macro (kbd "C-c C-e g"))
  (shell-command 
   (format "open -a /Applications/iThoughtsX.app %s"  
       (shell-quote-argument (concat (file-name-directory buffer-file-name) "export_opml/" (file-name-sans-extension (file-name-nondirectory buffer-file-name)) ".opml"))))
)

(global-set-key  (kbd "C-c o") 'opml-preview-file)
</code></pre>
</div>

<h1 id="exporting-to-reveal-presentation">Exporting to Reveal Presentation</h1>

<p>Another useful feature is exporting the current org buffer as a <a href="http://lab.hakim.se/reveal-js/">Reveal Presentation</a> and opening it in a browser. To do this you need to install and configure <a href="https://github.com/yjwen/org-reveal">org-reveal</a>. Once installed you can use the Lisp snippet below, the (C-c p) keyboard sequence will open the the current buffer as a <em>Reveal Presentation</em> in Safari (I use Mac).</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(defun 'presentation-preview-file ()
  "run export with ox-reveal on the current file and open browser"
  (interactive)
  (execute-kbd-macro (kbd "C-c C-e R R"))
  (shell-command 
   (format "open -a /Applications/Safari.app %s" 
       (shell-quote-argument (concat (file-name-directory buffer-file-name) "export_html/" (file-name-sans-extension (file-name-nondirectory buffer-file-name)) ".html"))))
)

(global-set-key  (kbd "C-c p") 'presentation-preview-file)
</code></pre>
</div>

<h2 id="hiding-content">Hiding Content</h2>

<p>I mentioned above that I like to organize my notes with both a summary for presentation, and details that would not work well in a presentation. To make it easy to hide content from the various export modules I added the code below to my init.el file.</p>

<div class="highlighter-rouge"><pre class="highlight"><code> (defun set-ignored-headlines-tags (backend)
 "Remove all headlines with tag ignore_heading in the current buffer. 
    BACKEND is the export back-end being used, as a symbol."
 (cond ((org-export-derived-backend-p backend 'md) (setq  org-export-exclude-tags '("noexport" "mdignore")))
       ((org-export-derived-backend-p backend 'reveal) (setq  org-export-exclude-tags '("noexport" "revealignore")))
       ((org-export-derived-backend-p backend 'opml)  (setq  org-export-exclude-tags '("noexport" "opmlignore"))) 
       (t (setq  org-export-exclude-tags '("noexport")))
   ) 
)
</code></pre>
</div>

<p>Now I can hide content from reveal by adding a <em>:revealignore:</em> tag to the heading. The <em>:opmlignore:</em> and <em>:mdignore:</em> work similarly. <em>:noexport:</em> means hide from all exports. The tags support hierarchy so will hide any sub-headings.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>* My Slides :mdignore:opmlignore:
 ** Topic 1
    Slide content
 ** Topic 2
    Slide content
* My Detailed Notes  :revealignore:
 ** Chapter Notes
 ** Code Experiments :opmlignore:
</code></pre>
</div>

<h1 id="conclusion">Conclusion</h1>

<p>With this setup is is easy to keep notes in a fashion that makes them easy to use in a number of formats, including presentations, mindmaps, and markdown documents. Org mode also supports the concept of <a href="http://orgmode.org/manual/Publishing.html">publishing</a> that is useful when sharing specific content, for example exporting specific notes to a web site along with images and attachments used in the notes.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2016/03/10/Deft-and-Emacs-for-Notes.html">Deft + Org for Notes</a></h1>
    
    
      <p class="meta">
        









<time datetime="2016-03-10T00:00:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In the <a href="http://rwx.io/blog/2013/03/04/nvalt-and-emacs/">nvALT and Emacs post</a> I described an integration between <em>nvAlt</em> and <em>Emacs</em> using <a href="http://jblevins.org/projects/deft/">Deft</a> for <em>markdown</em> notes. I the past year I have moved to using <em>Deft</em> for <em>org</em> notes rather than <em>markdown</em> notes. The nice thing about combining Deft with Org is that your notes are indexed and easy to find using Deft, but also retain all of the power of Org to orgainize and present information. For example typing <em>decision boundary</em> into <strong>deft</strong> quickly cuts down hundreds of org text notes to the handful that contain the words <strong>decision</strong> and <strong>boundary</strong> in them.</p>

<p>Deft also supports <em>regular expression</em> search mode to provide more precise searches (use C-c C-t to toggle search modes). Deft makes it easy to create new notes also, simply type a title and hit <em>ctrl-return</em> to create a new note with that title. See the UI in action in the animated gif below (image by <a href="http://jblevins.org/">Jason Blevins</a> via <a href="http://jblevins.org/projects/deft/">Deft</a> ). See the <a href="http://jblevins.org/projects/deft/">Documentation</a> for other handy features.</p>

<p><img src="/images/deft-v0.6.gif" alt="img" /></p>

<p>Below I describe setting up Deft for emacs, and show my current customization’s.  Org also supports export to many different formats. In a future posts I will cover my setup for exporting notes to <em>markdown</em> documents, <em>reveal</em> presentations, and even <em>mindmaps</em>.</p>

<h1 id="installing-deft">Installing Deft</h1>

<p>Follow the instructions at <a href="http://jblevins.org/projects/deft/">Deft</a> to install from source (usually the latest version this way) or use the Emacs package installer as shown below.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>M-x package-install deft
</code></pre>
</div>

<h1 id="configuring-deft">Configuring Deft</h1>

<p>I prefer to use Deft for <em>org</em> files and not others (txt, md, etc), so that is reflected in my configuration below. Using <a href="http://rwx.io/blog/2012/12/30/remapping-my-caps-lock-key/">this technique</a> I converted the tab key into a hyper-key (C-M-S-s), so with the key mapping below Deft can be called up with <strong>tab-d</strong> This technique is nice, because the tab key still works for tabbing, but when held down it acts like an additional modifier key that can be use in emacs key bindings.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(require 'deft)
(setq deft-default-extension "org")
(setq deft-extensions '("org"))
(setq deft-directory "~/org")
(setq deft-recursive t)
(setq deft-use-filename-as-title nil)
(setq deft-use-filter-string-for-filename t)
(setq deft-file-naming-rules '((noslash . "-")
                               (nospace . "-")
                               (case-fn . downcase)))
(setq deft-text-mode 'org-mode)
(global-set-key (kbd "C-M-S-s-d") 'deft)
(global-set-key (kbd "C-x C-g") 'deft-find-file)
</code></pre>
</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2016/03/09/org-with-babel-node-updated.html">Org Mode ES2015+ Code Blocks (updated)</a></h1>
    
    
      <p class="meta">
        









<time datetime="2016-03-09T16:57:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><ul>
  <li><strong>Note:</strong> In this post I have updated the instructions for use with <em>Babel 6x</em>. For <em>Babel 5x</em> see the <a href="/blog/2015/10/06/org-with-babel-node/">original post</a>.</li>
</ul>

<p>Babel 6x is a significant change from Babel 5x, as the <em>cli</em> is now a separate node module called <em>babel-cli</em> and transforms are now also delivered as separate packages.</p>

<p>First make a few changes to the emacs environment so you can use JavaScript in <strong>org mode</strong>, as well as find local <em>node.js</em> modules you have installed. Replace <em>”~/org/node_modules”</em> in the configuration below with the location of any local node modules you want to use. Using this approach you don’t have to pollute the global node_module directory if you don’t want to.</p>

<p>Add the following to your emacs init.el file and evaluate it (or restart emacs). Make sure the $HOME environment variable is set in your environment; or you could just hard code the absolute path to the node_modules directory in the code below.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(setenv "NODE_PATH"
  (concat
   (getenv "HOME") "/org/node_modules"  ":"
   (getenv "NODE_PATH")
  )
)

(org-babel-do-load-languages
 'org-babel-load-languages
 '((js . t)))
</code></pre>
</div>

<p>You can choose to install the Babel modules globally, or you can do it locally. In this example I will install them locally in the org directory (~/org/node_modules).</p>

<p>Next install the <em>babel-cli</em> module, this allows you to call Babel from the command line. You will also want to install the transforms you plan to use, the example below installs the common preset transforms used with <em>Babel 6</em>. Also install any local modules you need to use. I chose to install them from the ~/org directory where my notes are kept, but anywhere works as long as you have the correct path to <em>node_modules</em> set above.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>npm install --save-dev babel-cli
npm install --save-dev babel-preset-es2015
npm install --save-dev babel-preset-stage-0
npm install --save-dev babel-preset-stage-1
npm install --save-dev babel-preset-stage-2
npm install --save-dev babel-preset-stage-3
npm install --save-dev babel-preset-react
npm install --save-dev mongodb
npm install --save-dev bluebird
</code></pre>
</div>

<p>Next you want to set up a symbolic link to the <em>babel-cli</em> script you just installed so it can be found from the command line. I decided to call it <em>org-babel-node</em> so it won’t interfere with a <em>babel-node</em> executable linked to a global module of the same name.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>ln -s ~/org/node_modules/babel-cli/bin/babel-node.js /usr/local/bin/org-babel-node
</code></pre>
</div>

<p>The default org-mode interpreter for JavaScript is <em>Node</em>, so you need to have that installed and its path set. But the cool thing is that you can change the interpreter inline in your code blocks in the cases you want to experiment with upcoming language features. To do this you simply tell <em>org mode</em> to use an alternative interpreter; in this case the <strong>babel-node</strong> transpiler installed earlier and linked as <em>org-babel-node</em>.</p>

<p>Adding  <em>:cmd “org-babel-node”</em>   after the  <em>#+begin_src js</em> tells <em>org mode</em> to use the <em>org-babel-node</em> transpiler instead of the default JavaScript interpreter. Because <em>Babel 6</em> uses external modules for transforms you need to also tell Babel which preset or plugins you wish to use with either the <strong>–presets</strong> or <strong>–plugins</strong> options. The <em>:results output</em> tells <em>org mode</em> that the results will be from an output statement <em>(using console.log() for JavaScript)</em></p>

<div class="highlighter-rouge"><pre class="highlight"><code>   #+name: db.activities.findOne
   #+begin_src js :cmd "org-babel-node --presets stage-1" :results output drawer
      (async function(){
          try {
              let MongoDB = require('mongodb');
              let Promise = require('bluebird');
              Promise.promisifyAll(MongoDB);
              let db = await MongoDB.MongoClient.connectAsync(process.env.MY_DB);
              let activityCol = db.collection('activities')
              let result = await activityCol.findOne();
              db.close();
              console.log(`The first activity name is ${result.name}`);
            }
           catch(err){
             consule.log(err);
             throw err;
           }
         })()
   #+END_SRC
</code></pre>
</div>

<p>Now, simply place the cursor anywhere in the block and execute it using C-c C-c. The results will be placed under the block in second block entitled: <em>#+RESULTS:</em></p>

<p>The block can be executed as often as you like and the results will be refreshed. See the updated example with its results block below.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>   #+name: db.activities.findOne
   #+begin_src js :cmd "org-babel-node --presets stage-1" :results output drawer
      (async function(){
          try {
              let MongoDB = require('mongodb');
              let Promise = require('bluebird');
              Promise.promisifyAll(MongoDB);
              let db = await MongoDB.MongoClient.connectAsync(process.env.MY_DB);
              let activityCol = db.collection('activities')
              let result = await activityCol.findOne();
              db.close();
              console.log(`The first activity name is ${result.name}`);
            }
           catch(err){
             consule.log(err);
             throw err;
           }
         })()
   #+END_SRC

   #+RESULTS: db.activities.findOne
   :RESULTS:
   The first activity name is Shopping
   :END:
</code></pre>
</div>

<p>You can see several new and experimental language features including <em>async functions</em>, the <em>await</em> keyword for performing a non-blocking wait on a promise to complete, and <em>template strings</em>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2016/01/27/ancs-example-on-blend-nano.html">ANCS Example on BLE Nano</a></h1>
    
    
      <p class="meta">
        









<time datetime="2016-01-27T12:19:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="https://s3.amazonaws.com/rwx-blog/nano.png" /></p>

<p>I decided to try getting <em>Apple Notification Center Service (ANCS)</em> working with the <a href="http://redbearlab.com/blenano/" target="_blank">RedBearLab BLE Nano</a>, and this post describes one way to get the Nordic ANCS demo running on a BLE Nano. This post shows how to get an <em>ARM</em> development environment and toolchain up and running on OS X in order to develop apps for the Nordic BLE SoC’s (e.g. nRF51822 based boards like the BLE Nano).</p>

<p>There are a few options for developing applications for the BLE Nano:</p>

<ol>
  <li>Using the <em>Nordic nRF5 BLE SDK</em> along with the  <em>arm-gcc</em> compiler. This requires setting up a toolchain on your local development machine (Mac OS X in my case).</li>
  <li>Using <a href="http://mbed.org" target="_blank">mbed.org</a> and the <a href="https://developer.mbed.org/teams/Bluetooth-Low-Energy/" target="_blank">mbed Bluetooth Low Energy API</a>. This is the fastest way to get started, but unfortunately at the time of this post the API does not yet support peripherals as GATT Clients, and thus does not support ANCS development.</li>
  <li>Using the Arduino SDK along with the <a href="https://github.com/RedBearLab/nRF51822-Arduino" target="_blank">nRF51822-Arduino add-on</a>. I am not sure whether this add-on would support peripherals as GATT Clients either, and haven’t yet investigated the option.</li>
</ol>

<p>I decided to start with approach 1 since it seemed like the most stable approach to development. Below I describe my steps to getting the environment set up on OS X. For more on approach 2 &amp; 3 see <a href="http://redbearlab.com/getting-started-nrf51822" target="_blank">Getting Started with nRF51822</a></p>

<h2 id="setting-up-the-tool-chain-on-os-x">Setting Up the Tool Chain on OS X</h2>

<p>Install the <em>arm-gcc compiler</em> for OS X so you can compile for ARM devices. Fortunately both <em>HomeBrew</em> and <em>MacPorts</em> have recipes for installing the compiler. Pick the one that works for you. If you don’t have either HomeBrew or MacPorts installed please install one of them before proceeding.</p>

<p>Install the gcc-arm compiler using either <em>brew</em> command (HomeBrew) or <em>port</em> command (MacPorts):</p>

<div class="highlighter-rouge"><pre class="highlight"><code>brew install gcc-arm-none-eabi
</code></pre>
</div>

<p>or</p>

<div class="highlighter-rouge"><pre class="highlight"><code>port install arm-none-eabi-gcc
</code></pre>
</div>

<p><em>Note: If you get a permissions error you may need to prepend the sudo command to provide brew/port with enhanced security privileges.</em></p>

<p>You will need to save the location of the arm-gcc compiler for updating the nRF5 toolchain config files later. In my case it was located in</p>

<div class="highlighter-rouge"><pre class="highlight"><code>/usr/local/gcc_arm/gcc-arm-none-eabi-5_2-2015q4/
</code></pre>
</div>

<p>you will also need the compiler version number, just run the command below and write down the resulting version number</p>

<div class="highlighter-rouge"><pre class="highlight"><code>/usr/local/gcc_arm/gcc-arm-none-eabi-5_2-2015q4/bin/arm-none-eabi-gcc  --version 
</code></pre>
</div>

<p>In my case the <em>/arm-none-eabi-gcc</em> version was <em>5.2.1</em></p>

<h2 id="download-the-nordic-sdk">Download the Nordic SDK</h2>
<p>The next step is to download the <a href="http://developer.nordicsemi.com/nRF5_SDK/" target="_blank">Nordic nRF5 SDK</a> I chose <em>nRF51_SDK_v10.x.x</em>. Unzip into a location that will be your working directory for the project.</p>

<h2 id="download-the-nordic-soft-device-ble-protocol-stack">Download the Nordic Soft Device BLE Protocol Stack</h2>
<p>Nordic uses the term <em>Soft Device</em> to refer to its BLE protocol stack. I chose to use <em>S130-SD</em>, it can be downloaded from the <a href="http://www.nordicsemi.com/eng/Products/Bluetooth-Smart-Bluetooth-low-energy/nRF51822#Downloads" target="_blank">Nordic Download Page</a> under soft devices.</p>

<p>You will need to reference the soft device later, so I suggest saving it in your working directory at the same level you saved the SDK so it is easy to find.</p>

<h2 id="updating-the-sdk-configuration">Updating the SDK configuration</h2>
<p>The next step is to modify the SDK configuration to point to your arm-gcc compiler. In your SDK directory edit <em>components/toolchain/gcc/Makefile.posix</em> to correct the <em>GNU_INSTALL_ROOT</em> and <em>GNU_VERSION</em>.  <strong>GNU_INSTALL_ROOT</strong> should be the location of the arm-gcc compiler directory.  <em>*GNU_VERSIO</em>N* should be the version number of the arm-gcc compiler that I mentioned above. My <em>Makefile.posix</em> file looks like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>GNU_INSTALL_ROOT := /usr/local/gcc_arm/gcc-arm-none-eabi-5_2-2015q4/
GNU_VERSION := 5.2.1 
GNU_PREFIX := arm-none-eabi
</code></pre>
</div>

<h2 id="compile-the-ancs-example">Compile the ANCS example</h2>

<p>The ANCS example is located in the sdk driectory under the <strong>examples</strong> subdirectory. Change to the subdirectory for the ble_app_ancs_c example. For example from the main SDK directory:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>cd examples/ble_peripheral/ble_app_ancs_c
</code></pre>
</div>

<p>Like all the examples the ble_app_ancs_c directory contains <em>board package</em> subdirectories that are set up for the various development boards. For my test I changed to subdirectory:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>pca10028/s130/armgcc/
</code></pre>
</div>

<p>This is essentially choosing the example created for <em>board package</em> <strong>pca10028</strong> and <em>soft device</em> <strong>s130</strong> and finally the <strong>armgcc</strong> build directory.</p>

<p>In this directory your will find a Makefile for compiling this example, so run <strong>make</strong> to compile the example.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>make
</code></pre>
</div>

<p>The compilation process will create a new subdirectory called <strong>_build</strong> that will hold the output of the compile. The key file for our purposes will be the one with a <strong>.hex</strong> extension. In my case is was named <em>nrf51422_xxac_s130.hex</em>. This is the hex code that will be loaded by the bootloader on the BLE Nano’s nRF51822 SoC.</p>

<p>Since the nRF51 device is completely flash based. All the executable code, including Nordic’s “Soft Device” protocol stack and your applications, is programmed in this flash memory. The soft device is always in the lower region of the flash, using up to 128 kB, and the rest of the upper region of flash is available for your application. So before your applications hex code can be loaded on the BLE Nano, it must be merged with the hex code for the soft device, in this case the <em>S130</em> hex code.</p>

<p>To manipulate hex code you will need the <strong>srecord</strong> tool, which can be installed with HomeBrew or MacPorts.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>brew install srecord 
</code></pre>
</div>

<p>or</p>

<div class="highlighter-rouge"><pre class="highlight"><code>port install srecord
</code></pre>
</div>

<h2 id="merging-application-hex-code-with-soft-device-hex-code">Merging application Hex Code with Soft Device Hex Code.</h2>

<p>Assuming the <em>S130 Soft Device</em> code was uncompressed into the same working directory as the sdk and was named <em>s130_nrf51_1.0.0</em> and the example application hex code file was named <em>nrf51422_xxac_s130.hex</em>. Then from inside the <em>_build</em> directory created above we could merge the hex code files with the following command.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>srec_cat &lt;SDK_DIRECTORY&gt;/s130_nrf51_1.0.0/s130_nrf51_1.0.0_softdevice.hex -intel nrf51422_xxac_s130.hex  -intel -o ancs.hex -intel --line-length=44
</code></pre>
</div>

<p>The above command would create a new (combined) hex code file in _build named <strong>ancs.hex</strong></p>

<h2 id="loading-the-code-on-the-ble-nano">Loading the code on the BLE Nano</h2>

<p><img src="https://s3.amazonaws.com/rwx-blog/nano2.png" /></p>

<p>This is the easy part. With the BLE Nano piggy backing on its MK20 USB board and plugged into a USB port, a folder named MBED should appear on your desktop (at least that is what it is named in my case). Just drag the combined hex file we created above <em>(ancs.hex)</em> to the MBED folder associated with the Nano device. The bootloader should load the new code, and the USB device may disappear momentarily from the desktop, then reappear.</p>

<h2 id="test-that-the-ancs-application-was-loaded-correctly">Test that the ANCS application was loaded correctly</h2>
<p>On an iPhone, open the <em>Settings</em> app, and choose <em>Bluetooth</em> and make sure Bluetooth is on. Under Devices you should see ANCS appear, and by tapping ANCS you should be able to successfully pair with the device.</p>

<h2 id="next-steps">Next Steps</h2>
<p>The goal of this process was to get the ARM toolchain and Nordic SDK set up, next steps would be to use the ANCS example as a starting point to develop a custom ANCS app for some device that utilizes the BLE Nano. I hope to post some examples in the future as I work with the Nano more.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2016/01/23/ancs-message-display.html">ANCS Message Display</a></h1>
    
    
      <p class="meta">
        









<time datetime="2016-01-23T11:12:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2 id="overview">Overview</h2>
<p>Ever want to see that last iPhone message without checking your phone. It is actually fairly easy to create a secondary message display using an Arduino, BLE, and an LCD display to conect to the <em>Apple Notification Center Service</em> on your iPhone.
<img src="https://s3.amazonaws.com/rwx-blog/IMG_6097.JPG" /></p>

<p>For this project I used the <a href="http://redbearlab.com/blendmicro/" target="_blank">Blend Micro</a> from  RedBearLab, combined with an <a href="https://www.adafruit.com/product/358" target="_blank">AdaFruit ST7735R TFT LCD display</a>  The <em>Blend Micro</em> combines an Atmel ATmega32U4 micro-controller with a Nordic nRF8001 BLE chip. Simply hook up the LCD using SPI and you are in business. For this project I added a <a href="https://www.adafruit.com/products/160">piezo buzzer</a> for sound effects and a button to wake up the display if it has timed out.</p>

<p><img src="//s3.amazonaws.com/rwx-blog/IMG_6098.JPG" /></p>

<p>The basic idea is to have the iPhone pass along alerts to the device using BLE/ANCS and to have the device play a tone and display the alert information. There is a timeout to power down the backlight on the display after a minute, and a button that can be pressed to turn the display’s backlight on, so the last message can be viewed after the one minute timeout.  This power savings mode could allow the device to be powered by a battery.</p>

<p>I created a demo project on <a herf="https://codebender.cc/sketch:222511" target="_blank">codebender</a> to make it easy to replicate. You will need to import a few libraries into your personal libraries on codebender to get the project to work. It would be easy to enhance the project to save the last several messages and use a <a href="https://www.adafruit.com/product/444">2-Axis Analog Thumb Joystick</a> to control a simple interface that scans through messages.</p>

<p>Unfortunately the <em>Blend Micro</em> does not have an on-board LIPO charging circuit, so if you want to enable a combined USB/Battery solution a charging circuit would have to be added. RedBear warns that connecting a battery to VIN and USB simultaneously could damage the board.</p>

<p>I printed up a simple enclosure on the 3D printer and here is the enclosed LCD panel.</p>

<p><img src="https://s3.amazonaws.com/rwx-blog/IMG_6111.JPG" /></p>

<h2 id="pinouts">Pinouts</h2>
<div class="highlighter-rouge"><pre class="highlight"><code>  VIN &amp; GND -&gt; to LIPO battery (DO NOT use USB power when battery connected)
  PIN 2     -&gt; ST7735R LITE
  PIN 8     -&gt; ST7735R D/C
  PIN 9     -&gt; ST7735R Reset
  PIN 10    -&gt; ST7735R TFT_CS
  PIN 11    -&gt; ST7735R MOSI
  PIN 13    -&gt; ST7735R SCK
  PIN V33   -&gt; ST7735R VCC
  PIN GND   -&gt; ST7735R GND

  Button -&gt; PIN 5, GND
  Buzzer -&gt; PIN 3, GND

</code></pre>
</div>

<h2 id="detailed-instructions">Detailed Instructions</h2>

<p>Follow the instructions for using <a href="http://redbearlab.com/quick-start-codebender" target="_blank">Blend Micro on codebender</a>. You should be able to get the LED Blink example working before continuing.</p>

<h3 id="add-key-libraries">Add key libraries</h3>
<p>To compile the code in the project above you will need to add several libraries to your personal libraries on codebender. Go to  <a href="https://codebender.cc" target="_blank">codebender.cc</a> and you will see the <em>*Upload Libraries</em> button on the upper right side of the page. There are four libraries you need to add.</p>

<ul>
  <li><a href="https://github.com/NordicSemiconductor/ble-sdk-arduino" target="_blank">Nordic Bluetooth low energy SDK for Arduino beta version 0.9.0</a></li>
  <li><a href="https://github.com/RedBearLab/nRF8001/" target="_blank">RedBearLab nRF8001 Library version 20140701</a></li>
  <li><a href="https://github.com/RedBearLab/nRF8001/" target="_blank">RedBearLab Blend Add-On version 20140701</a></li>
  <li><a href="https://github.com/robotastic/ANCS-Library" target="_blank">Robotastic/ANCS-Library</a></li>
</ul>

<p>Just download each of these as a zip file from github, and upload them to your <em>codebender personal library</em>. I created a fork of the <em>ANCS-Library</em> to thin it down a bit as memory was tight on the <em>Blend Micro</em> for another version of the project I am working on. It is on a branch called <strong>code-diet</strong> available on github  <a href="//github.com/fooqri/ANCS-Library/archive/code-diet.zip">ANCS-Library on a code-diet zip</a></p>

<p>Finally, clone my <a herf="https://codebender.cc/sketch:222511" target="_blank">codebender ANCS_Display_ST7735 project</a> and verify the code compiles with the libraries you uploaded, and run the project on Arduino.</p>

<p>Open the iPhone  <em>Settings</em> app and select <em>Bluetooth</em>. If everything is working correctly you should see <strong>ANCS_RUSK</strong> listed under <em>MyDevices</em>. Select it and choose pair.
<img src="https://s3.amazonaws.com/rwx-blog/IMG_6095.PNG" />
<img src="https://s3.amazonaws.com/rwx-blog/IMG_6094.PNG" /></p>

<p>Once paired you should hear a tone on the device, and the display will change from <strong>Status: Not Connected</strong> to <strong>Status: Connected</strong>.  If you receive any alerts on your iPhone you should now hear a tone on the device and the screen should display a message.</p>

<p>You can update the code to support custom tones and messages for different alert types, or add other interesting features.</p>

<h2 id="additional-notes">Additional Notes</h2>
<ul>
  <li>The <a href="http://redbearlab.com/blenano/">Blend Nano</a> from ReadBearLab is a tiny alternative to the Blend Micro but it is based on the ARM Cortex-M0 SoC and uses the newer Nordic nRF51822 BLE chipset. The <em>ANCS-Library</em> is only compatible with the Nordic nRF8001 BLE chipset, so some work would be needed to port the library to the new platform.</li>
  <li>Adafruit has just announced a few similar Arduino+BLE boards. The <a href="https://www.adafruit.com/products/2829">Feather 32u4 Bluefruit LE</a> using the ATmega32u4, and the <a href="https://www.adafruit.com/products/2995">Feather M0 Bluefruit LE</a> using the ATSAMD21G18 ARM Cortex. Both these boards provide a built in 100mA lipoly charger, so either would be a better choice for a mobile device. Both these boards use the  nRF51822 BLE chipset so like the Blend Nano would require porting the <em>ANCS-Library</em> before the code above could be used.</li>
  <li>I have a <a href="https://www.adafruit.com/products/1393">SHARP Memory Display Breakout</a> from adafruit, which is a really nice eInk type display, but was unable to get it working with this demo on first try. This <a href="https://codebender.cc/sketch:220214">codebender sketch</a> was my first attempt. It seems that there is a conflict between the <em>Adafruit_SharpMem</em> library and the <em>ANCS Library</em>, because instantiating the Adafruit_SharpMem display object causes calls to notif.setup() to hang. I may look at it a bit more if I get a chance, but this was to be a quick experiment. There were some memory size issues initially, but I believe the hang may be an SPI issue, but I haven’t yet had time to investigate further.</li>
  <li>I also started to play with a headless version that instead uses neoPixels. I will post when I finish it. I like the idea of a fun neoPixel and sound only display connected with an iOS app that allows the user to customize what notifications the display responds to and how it responds. This would allow cheap simple peripheral displays to be created that respond to different notifications in different ways.</li>
  <li>The <a href="http://makezine.com/2015/12/09/meet-esp32-new-big-brother-to-iot-board-esp8266/">ESP32</a> should make for an interesting platform for these types of displays because they could allow BLE for notifications, and use WiFi for connection to the home network. This could allow control a wide range of WiFi enabled home devices based on iOS app notifications. That sounds fun.</li>
</ul>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2015/10/06/org-with-babel-node.html">Org Mode ES2015+ Code Blocks</a></h1>
    
    
      <p class="meta">
        









<time datetime="2015-10-06T16:57:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><ul>
  <li><strong>Updated:</strong> I have <a href="/blog/2016/03/09/org-with-babel-node-updated/">updated instructions</a> for installing and using the recently released <em>Babel 6</em> with <em>org mode</em>.</li>
</ul>

<p>I use <strong>emacs org mode</strong> to keep notes including code nodes that support inline execution.  It is convenient for keeping useful code snippets, as well as experimenting while taking notes.  Because of features like <a href="http://rwx.io/blog/2013/03/04/nvalt-and-emacs/">Org + Deft</a> it is really easy to find the sweet spot between keeping coding notes organized but also easily searched.</p>

<p>As I have started to explore more ES6 and even ES7 features I wanted a way to transpile on the fly in my coding notes. It turns out it is very easy.</p>

<p>First make a few changes to the emacs environment so you can use JavaScript in <strong>org mode</strong>, as well as find local <em>node.js</em> modules you have installed. Replace <em>”~/org/node_modules”</em> in the config below with the location of any local node modules you want to pick up. Using this approach you don’t have to pollute the global node_module directory if you don’t want to.</p>

<p>Add the following to your emacs init.el file and evaluate it (or restart emacs).</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(setenv "NODE_PATH"
  (concat
   "~/org/node_modules" ":"
   (getenv "NODE_PATH")
  )
)

(org-babel-do-load-languages
 'org-babel-load-languages
 '((js . t)))
</code></pre>
</div>
<p>Next install the babel npm module globally, this allows you to call babel from the command line also. Then install any local modules you need to use. I chose to install them from the ~/org directory where my notes are kept, but anywhere works as long as you have the correct path set above.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>npm install -g babel
npm install mongodb
npm install bluebird
</code></pre>
</div>

<p>The default  org-mode interpreter for js is node, so you need to have that installed and its path set. But the cool thing is that you can change the interpreter inline in your code blocks in the cases you want to experiment with upcoming language features. To do this you simply tell <em>org mode</em> to use an alternative interpreter; in this case <strong>babel-node</strong>, which also transpiles.</p>

<p>Adding  <em>:cmd “babel-node”</em>   after the  <em>#+begin_src js</em> tells <em>org mode</em> to use the babel_node command instead of the default JavaScript interpreter. The <em>:results output</em> tells <em>org mode</em> that the results will be from an output statement <em>(using console.log() for JavaScript)</em></p>

<div class="highlighter-rouge"><pre class="highlight"><code>   #+name: db.activities.findOne
   #+begin_src js :cmd "babel-node" :results output drawer
      (async function(){
          try {
              let MongoDB = require('mongodb');
              let Promise = require('bluebird');
              Promise.promisifyAll(MongoDB);
              let db = await MongoDB.MongoClient.connectAsync(process.env.MY_DB);
              let activityCol = db.collection('activities')
              let result = await activityCol.findOne();
              db.close();
              console.log(`The first activity name is ${result.name}`);
            }
           catch(err){
             consule.log(err);
             throw err;
           }
         })()
   #+END_SRC
</code></pre>
</div>

<p>Now, simply place the cursor anywhere in the block and execute it using C-c C-c. The results will be placed under the block in second block entitled: <em>#+RESULTS:</em></p>

<p>The block can be executed as often as you like and the results will be refreshed. See the updated example with its results block below.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>   #+name: db.activities.findOne
   #+begin_src js :cmd "babel-node" :results output drawer
      (async function(){
          try {
              let MongoDB = require('mongodb');
              let Promise = require('bluebird');
              Promise.promisifyAll(MongoDB);
              let db = await MongoDB.MongoClient.connectAsync(process.env.MY_DB);
              let activityCol = db.collection('activities')
              let result = await activityCol.findOne();
              db.close();
              console.log(`The first activity name is ${result.name}`);
            }
           catch(err){
             consule.log(err);
             throw err;
           }
         })()
   #+END_SRC

   #+RESULTS: db.activities.findOne
   :RESULTS:
   The first activity name is Shopping
   :END:
</code></pre>
</div>

<p>You can see several new and experimental language features including <em>async functions</em>, the <em>await</em> keyword for performing a non-blocking wait on a promise to complete, and <em>template strings</em>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2015/09/09/esp8266-initial-notes.html">ESP8266 Initial Notes</a></h1>
    
    
      <p class="meta">
        









<time datetime="2015-09-09T08:05:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="//s3.amazonaws.com/rwx-blog/sparkfun_thing.jpg" style="height: 400px; display: block; margin: auto;" /></p>

<h1 id="here-are-a-few-notes-from-my-experiments-with-the-esp8266">Here are a few notes from my experiments with the ESP8266</h1>
<p>I have started testing  the ESP8266 as an inexpensive WiFi enabled IoT device platform. I will added specific how-to notes later but wanted to capture a few items from my initial experiments.</p>

<p>I started with the <a href="https://www.sparkfun.com/products/13231" target="_blank">Sparkfun Thing</a>, which is a nice ESP8266 dev board that supports integrated LiPo battery management. They have a nice <a href="//learn.sparkfun.com/tutorials/esp8266-thing-hookup-guide" target="_blank">Hookup Guide</a> to get you started.</p>

<p>My use case is a very simple IoT type device that will send data to a cloud service that I have developed. The cloud service will aggregate the data from multiple personal IoT devices for a user. These devices will generally be powered via LiPo battery when in use for interaction and placed in a charging tray when not in interactive use. The devices are always active but have special meaning when in interactive use.</p>

<p>These constraints mean that battery life is a critical factor, but I do not need days, months, or years of battery life. The ESP8266 is a fairly power hungry device, especially when transmitting data, but it does have some power management features, most notably <strong>deep sleep</strong>.</p>

<h2 id="notes-from-my-initial-experiments">Notes from my initial experiments:</h2>

<h3 id="the-kit">The Kit</h3>
<p>I used the <a href="//www.sparkfun.com/products/13231" target="_blank">Sparkfun Thing</a>, <a href="//www.sparkfun.com/products/9873" target="_blank">FTDIBreakout</a> for uploading code, and  <a href="//www.sparkfun.com/products/10718" target="_blank">LiPo battery</a>.</p>

<h3 id="setup">Setup</h3>
<p>An easy way to get code running is to use the <a href="//learn.sparkfun.com/tutorials/esp8266-thing-hookup-guide/installing-the-esp8266-arduino-addon" target="_blank">Arduino Addon</a> that lets you leverage the Arduino libraries in programming the ESP8266. An alternative I will try in the future is the  <a href="//github.com/nodemcu/nodemcu-firmware" target="_blank">Lua based firmware</a></p>

<p>When using the FTDI to program the board take note that GPIO0 is used to set the run mode of the firmware. 3.3V puts it in <em>run mode</em> and 0V puts it in <em>program mode (bootloader)</em>. This is easy to miss in the instructions, so be sure to connect the <em>0</em> pin to ground when you wish to upload the code from the Arduino IDE.</p>

<h2 id="power-management">Power Management</h2>
<p>To use the <em>deep sleep</em> mode on the <em>Sparkfun Thing</em> you must connect <em>XPD</em> to <em>DTR</em>. Sparkfun connected DTR to RST on the <em>Thing</em> so a short negative voltage will reset the device. When in <em>deep sleep</em> most system services are powered off, but the RTC and timer interrupt remains active for the purpose of waking the device from sleep. This is handled by the firmware once these pins are connected, however this means you will have to remove the FTDI programmer to test the deep-sleep mode.</p>

<p>The <em>deepsleep()</em> call looks a lot like a <em>delayMicroseconds()</em> call, simply pass it the number of microseconds before it should wake up again. In deep sleep mode, the ESP8266 hits about 60 µA of power draw, down from its average of around 75mA, and the 200mA used while transmitting.</p>

<p>It should be possible to connect a button or some other independent sensor as an alternative to a timer based wakeup, so the device can be awaken by a button press or some physical world event.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  ESP.deepSleep(1000000);  //sleep for 1 second
</code></pre>
</div>

<h3 id="saving-state">Saving State</h3>
<p>Unlike a call to <em>delay()</em> or <em>delayMicroseconds()</em>, the <em>deepsleep()</em> function actually causes the device to power down everything except the RTC and related services. Wake is essentially a device reboot and previous state is not maintained. This means any state will need to be stored in the ESP8266 EEPROM. For this there is an EEPROM library and EEPROM.get()</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  //some struct for saved object
  struct BackupObj{
    int setting;
    int data;
  };

  //write
  int eeAddress = 0;
  EEPROM.begin(4096);  //set up memory allocation
  EEPROM.put( eeAddress, backupObj );
  EEPROM.commit();
  EEPROM.end();

  //read
  int eeAddress = 0; 
  EEPROM.begin(4096);
  EEPROM.get( eeAddress, backupObj );
  EEPROM.end();
</code></pre>
</div>

<h3 id="adding-components">Adding Components</h3>

<p>The device works well for I2C, in my case I tested with an MPU-6050.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  #include &lt;Wire.h&gt;

  void setup() {
    // ... other setup code
    Wire.begin();
    Wire.beginTransmission(MPU);
    Wire.write(0x6B);  // PWR_MGMT_1 register
    Wire.write(0);     // set to zero (wakes up the MPU-6050)
    Wire.endTransmission(true);
  }

  // using arduino's loop mechanism
  void loop(){
    // ... other loop code
    Wire.beginTransmission(MPU);
    Wire.write(0x3B);  // starting with register 0x3B (ACCEL_XOUT_H)
    Wire.endTransmission(false);
    Wire.requestFrom(MPU,14,true); 
    AcX=Wire.read()&lt;&lt;8|Wire.read();     
    AcY=Wire.read()&lt;&lt;8|Wire.read();  
    AcZ=Wire.read()&lt;&lt;8|Wire.read(); 
    // ... other loop code
  }
</code></pre>
</div>

<p>I tested using GPIO with a piezo used as a speaker. The Speaker is capable of playing simple notes using frequency of note mapped to cycles of sound and delay.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  #define NOTE_C5  523 //middle C
  #define NOTE_D5  587

  const int SPEAKER_PIN = 5;
  
  void playNote(int targetPin, long frequency, long length) {
    long delay = 1000000 / frequency / 2; 
    long cycles = frequency * length / 1000; 
    for (long i = 0; i &lt; cycle; i++) { 
      digitalWrite(targetPin, HIGH); 
      delayMicroseconds(delay); 
      digitalWrite(targetPin, LOW); 
      delayMicroseconds(delay);
    } 
  }

  long noteDuration = 500;
  long frequency = NOTE_C5;

  playNote(SPEAKER_PIN, frequency, noteDuration);
  
</code></pre>
</div>

<p>I  tested  analog sensor input in the form of a second piezo connected to the ADC pin as a knock sensor. ADC is the only analog input pin on this device.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  const int KNOCK_SENSOR = A0;
  const int KNOCK_THRESHOLD = 70;

  sensorReading = analogRead(KNOCK_SENSOR); 
  if (sensorReading &gt;= KNOCK_THRESHOLD) {
    long noteDuration = 500;
    long frequency = NOTE_E5;
    playNode(SPEAKER_PIN, frequency, noteDuration); 
  }
  
</code></pre>
</div>

<p>Finally there were enough pins remaining to hookup an RGB LED breakout. I added this test using the  <a href="//github.com/joushx/Arduino-RGB-Tools" target="_blank">RGB Tools Lib</a>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  #include &lt;RGBTools.h&gt;

  const int RED_PIN = 4; 
  const int GREEN_PIN = 12; 
  const int BLUE_PIN = 13;

  // set the RGB pins - here I used pins 4, 13, and 12
  // use RGBTools rgb(4,13,12, COMMON_CATHODE); if using a cathode RGB
  RGBTools rgb(4,13,12); 

  //set a nice red
  rgb.setColor(174,10,0);
  

</code></pre>
</div>

<p>##Conclusion
This was a quick run through to test some of the feature of the device, but even with a few sensors/actuators and a simple setup there is a nice combination of status and interaction feedback that can be performed with a simple and relatively inexpensive device. The <em>Sparkfun Thing</em> retails for around $15 right now but the <a href="//learn.adafruit.com/adafruit-huzzah-esp8266-breakout/overview" target="_blank">Huzzah</a> is under $10, and others can be found closer to $5.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2015/08/18/self-updating-edison-app.html">Self Updating Edison Apps</a></h1>
    
    
      <p class="meta">
        









<time datetime="2015-08-18T10:49:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>One of the challenges I have had in handing out prototype devices is keeping the software up to date. Solutions like &lt;a href-“www.resin.io” target=”_blank”&gt;resin.io&lt;/a&gt; do a nice job of deploying <a href="http://bundler.io/" target="_blank">bundler images</a> onto devices like the Edison. The primary issue I had was the overhead of pushing bundler images around when the only thing that was changing was the node app. It seemed easier to just use git and npm to handle the updates. I may go the resin.io route later, but this early in dev and testing the git route seems simpler.</p>

<h2 id="overview-of-what-i-did">Overview of What I Did</h2>
<p>The product I am prototyping has two parts, an Edison device (with additional sensors and actuators) running a node app, and a node web service for managing device configuration and data running in the cloud.</p>

<ol>
  <li>The device’s node app is published in a private github repository.</li>
  <li>I installed and configured git on each of the Edison devices.</li>
  <li>I cloned the github repository onto each of the Edison devices.</li>
  <li>I installed the forever module on each of the devices to keep the app up and allow easy restarting of the app.</li>
  <li>I created a startup script that starts the app using forever.</li>
  <li>I created and enabled a linux service that runs the startup script on boot.</li>
  <li>I added code to the app to periodically ask the web service what the latest version of the app should be.</li>
  <li>If a new version is available the app will do a pull and use forever to do a restart using the new version.</li>
</ol>

<h2 id="the-details">The Details</h2>

<h3 id="initial-cleanup">Initial Cleanup</h3>

<ul>
  <li>Remove any app from the default Edison node_app_slot directory so you don’t accidentally start the app using the default Edison process.</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>mv /node_app_slot /node_app_slotbk
mv  ~/.node_app_slot/ ~/.node_app_slotbk
</code></pre>
</div>

<h3 id="install-git">Install Git</h3>
<p>#### Update /etc/opkg/base-feeds.conf with these 3 lines
<code class="highlighter-rouge">
src all     http://iotdk.intel.com/repos/1.1/iotdk/all
src x86 http://iotdk.intel.com/repos/1.1/iotdk/x86
src i586    http://iotdk.intel.com/repos/1.1/iotdk/i586
</code>
#### Update opkg and install git
<code class="highlighter-rouge">
opkg update
opkg install git
</code></p>

<h3 id="option-1-modify-edisons-default-port">Option 1: Modify Edison’s default port</h3>
<p>I wanted to use port 80 for the node app so I moved the default Edison config service to port 8080</p>

<h4 id="change-default-port-in-edison-cofig-server">Change default port in edison-cofig-server</h4>

<p>Edit <em>/usr/lib/edison_config_tools/edison-config-server.js</em>
and change the last line to use a port other than 80.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>http.createServer(requestHandler).listen(8080);
</code></pre>
</div>

<h4 id="option-2-disable-the-edison-config-web-service">Option 2: Disable the Edison config web service</h4>

<div class="highlighter-rouge"><pre class="highlight"><code>systemctl disable edison_config
systemctl stop    edison_config
</code></pre>
</div>

<h3 id="setup-to-use-github">Setup to use github</h3>

<h4 id="generate-a-key-for-use-with-github">Generate a key for use with github</h4>
<ul>
  <li>ssh-keygen -t rsa -b 4096 -C “me@my.email”</li>
</ul>

<p>Follow the directions, easiest is just to hit return at the prompts. I chose to not do a passphrase for my small pilot.</p>

<h4 id="generate-a-deployment-key-for-the-github-repository">Generate a deployment key for the github repository</h4>
<ul>
  <li>Go to your app’s github repository, choose <em>settings</em>, choose <em>deployment keys</em></li>
  <li>Click the <em>Add Deployment Key</em> button</li>
  <li>Give it a title (the host name for the device works)</li>
  <li>Back on the Edison run cat /home/root/.ssh/id_rsa.pub to get the text for the public key</li>
  <li>copy the text for the public key to the <em>Key</em> input box back on github.</li>
</ul>

<h3 id="clone-your-repo">Clone your repo</h3>
<p>Back on the Edison</p>

<div class="highlighter-rouge"><pre class="highlight"><code>cd /
git clone &lt;your repo&gt; AppDirName
cd /AppDirName
</code></pre>
</div>

<h3 id="pull-latest-code">Pull Latest code</h3>
<p>Now any time you update code on master a simple <em>git pull</em> will update the latest code.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>git pull
</code></pre>
</div>

<h3 id="install-forever-module-using-npm">Install forever module using npm</h3>
<p>Forever will automatically restart a node app if it crashes. It also has some handy restart features.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>npm install -g forever
</code></pre>
</div>

<h3 id="create-a-startup-script--service">Create a startup script &amp; service</h3>
<p>Creating a startup service will allow your app to start automatically using forever.</p>

<h4 id="create-startupsh-to-start-node-app-serverjs-in-this-case">Create startup.sh to start node app (server.js in this case)</h4>
<div class="highlighter-rouge"><pre class="highlight"><code><span class="c">#!/bin/sh</span>
<span class="nb">cd</span> /AppDirName 
forever start server.js
</code></pre>
</div>

<h4 id="make-startupsh-executable">Make startup.sh executable</h4>

<div class="highlighter-rouge"><pre class="highlight"><code>chmod +x startup.sh
</code></pre>
</div>

<h4 id="create-a-startup-service-file-at-libsystemdsystemstartupservice">Create a startup service file at /lib/systemd/system/startup.service</h4>

<div class="highlighter-rouge"><pre class="highlight"><code>[Unit]
 Description=STARTUP
 [Service]                           
 Type=idle                           
 RemainAfterExit=true
 ExecStart=/AppDirName/startup.sh
 Environment="HOME=/home/root"    
 WorkingDirectory=/AppDirName/   
 [Install]                     
 WantedBy=multi-user.target 
</code></pre>
</div>

<h4 id="enable-startup-service">Enable startup service</h4>

<div class="highlighter-rouge"><pre class="highlight"><code>systemctl enable /lib/systemd/system/startup.service
</code></pre>
</div>

<h3 id="enable-your-node-app-to-update-itself">Enable your node app to update itself</h3>

<p>By using a simple update function you can get your app to update itself and restart.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>var spawn = require('child_process').exec;
var semver = require('semver');
var bunyan = require('bunyan');
var log = bunyan.createLogger({
    name: 'app',
    streams: [{
        type: 'rotating-file',
        path: '/var/log/app.log',
        period: '1d',
        count: 7        
    }]
});
var pjson = require('./package.json');

var checkVersion = function(){
  var currentVersion = pjson.version;
  var options = {  hostname: 'www.myhost.com',
                             port: 80,
                   path: 'http://www.myhost.com/device_version/',
                   method: 'GET',
                   headers: {'Content-Type': 'application/json'}
                };
  var callback = function(response) {
    var dataStr = '';
    response.on('data', function (chunk) {
      dataStr += chunk;
    });

    response.on('end', function () {
      var versionInfo = JSON.parse(dataStr);
      var latestVersion = versionInfo.client_version || "0.0.0"; //don't update if missing version info
      log.info("current version: ", currentVersion);
      log.info("latest version: ", latestVersion);
      if (semver.gt(latestVersion, currentVersion)){
        log.info("pulling newer versions");
        spawn('git pull', function(error, stdout, stderr) {
          if (error){
            log.error("ERROR pulling latest: ", error);
          }
          else{
            log.info("updating packages");
            spawn('npm update', function(error, stdout, stderr){
              if (error){
                log.error("ERROR updating packages: ", error);
              }
              else {
                log.info("restarting node");
                spawn('forever restartall', function(error, stdout, stderr){
                  if (error){
                    log.error("ERROR restarting: ", error);
                  }
                  else {
                     log.info("restarted");
                  }
                });
              }           
            });
          }
        }); 
      }
    });
  };

//check for updates at app startup
checkVersion();

//then check for updates every hour;
setInterval(function() {
    checkVersion();                                                       
  }, 3600000);
  
</code></pre>
</div>

<h3 id="on-the-server">On the server</h3>
<p>You will need to add a route on your server to provide the version info. In this example the route was a GET request to the  <em>/device_version</em> route. For simplicity I just use an env_var on the service. I simply update the env_var when a new version is available. Then in the logic for the <em>/device_version</em> route I pass back the version found in the env_var.</p>

<p>The logic for comparing versions is very basic and flawed, but will work in this simple case.</p>

<h3 id="improvements">Improvements</h3>
<p>Ideally instead of a straight <em>git pull</em> you can instead download a tagged version, and keep the current and next version info for each device in the web service db. This would allow rolling out upgrades to specific devices, etc. Another approach would be to pass back version info to the device so updates could roll out immediately if the device is in use. Finally more logic on the device to schedule an update when not active would be ideal. In that case maybe adding more than <em>versionNumber</em> of the latest version to the server response, maybe a priority value also.</p>

<p>This was a quick experiment it getting updates to percolate out to devices prototype devices, and so far it seems to be working well.</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2015/08/17/workbench.html">Workbench Replaces My Desk</a></h1>
    
    
      <p class="meta">
        









<time datetime="2015-08-17T08:15:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="//s3.amazonaws.com/rwx-blog/workbench.JPG" target="_blank"><img src="//s3.amazonaws.com/rwx-blog/workbench.JPG" style="height: 400px; display: block; margin: auto;" /></a></p>

<p>I changed my desk out for a workbench and am very pleased with the results. I made the switch for two reasons:</p>

<ol>
  <li>I spend a lot of time at my desk and wanted to mix in sitting and standing throughout the day.</li>
  <li>I started to work more frequently on small hardware projects and found that being able to stand and move about the bench was more comfortable.</li>
</ol>

<p>A few additional changes I made:</p>

<ul>
  <li>I found that I needed more tools at hand when I was working on hardware projects, so I brought in a small tool cabinet from the garage.</li>
  <li>I wanted to have access to a large number of “Maker” materials in my office vs. the garage, so I also added an <a href="http://www.ikea.com/us/en/catalog/products/40196241/" target="_blank">IKEA Alex</a> cabinet. These can often be found in their discount section for around $60 if you don’t mind a few minor marks. This cabinet holds larger hardware components (like Arduino boards) as well as design/art supplies like paper, ink, paint, cutting/carving tools, etc.</li>
  <li>I wanted to have some smaller supplies at hand on top of the desk so I added a few <a href="http://www.amazon.com/gp/product/B000AIDBGC" target="_blank">Art Supply Drawers</a> for the top of the bench. The one to the left of the monitor holds small electronic components. The one to the right holds drawing pencils, pens, markers, etc that I use frequently.</li>
  <li>I added a <a href="//www.amazon.com/gp/product/B00ANZRT4M" target="_blank">digital soldering station</a> and <a href="http://www.amazon.com/Weller-WSA350-Bench-Smoke-Absorber/dp/B000EM74SK" target="_blank">exhaust fan</a>. I still have a soldering station in the garage, but having one at hand is very convenient.</li>
  <li>Another handy addition is the <a href="http://www.amazon.com/gp/product/B00XNYXQHE" target="_blank">USB Microscope</a>, as some solder joints just require very careful inspection. This is especially true with soldering of small components and SMD components.</li>
  <li>I also had to add a <a href="http://www.amazon.com/gp/product/B001PMJXD2" target="_blank">bench height chair</a>.</li>
  <li>The workbench is a <a href="http://www.amazon.com/Gladiator-GAWB08HWEG-Adjustable-Hardwood-Workbench/dp/B00ZTH82CW" target="_blank">Gladiator 8 ft. maple workbench</a> I had in the garage for a long time. The new ones allow height adjustment, and there are also less expensive bamboo top options.</li>
</ul>

<p>I am very pleased with the setup. One nice feature is the workbench depth is less than a traditional desk, so I gained some space back in the office. The main benefit is just better productivity, I find certain tasks are just easier to accomplish when standing. The final benefit? With two greyhounds in the house, having a tall desk means fewer expensive pens and markers go missing.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2015/08/17/i2c-mpu-6050.html">I2C MPU-6050</a></h1>
    
    
      <p class="meta">
        









<time datetime="2015-08-17T05:50:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="//s3.amazonaws.com/rwx-blog/mpu6050.jpg" style="height: 400px; display: block; margin: auto;" /></p>

<p>I am using an accelerometer in my most recent device to capture gesture and orientation information, as the device itself has no traditional user interface. Since the device is running a node.js app to capture data and push it to a cloud service the first prototype required a quick solution to getting data from an MPU.</p>

<p>To capture data I am using a  few node modules. In particular the <a href="https://github.com/hybridgroup/cylon" target="_blank">cylon.js</a> module, along with the <a href="https://github.com/hybridgroup/cylon-i2c" target="_blank">cylon-i2c</a> module.  This allows accelerometer data to be easily used by the following code block</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Cylon                                                                          
  .robot()                                                                    
  .connection("edison", { adaptor: "intel-iot", i2cPort: 1})                  
  .device("accel", { driver: "mpu6050" })                                     
  .on("ready", function(bot) {                                      
    setInterval(function() {                                        
      bot.accel.getAcceleration(function(err, data) {
        //use data
      });
    });
  });
</code></pre>
</div>

<h2 id="the-mpus">The MPUs</h2>
<p>The first prototype of this device is using a SparkFun Edison stack with the SparkFun I2C block connected to an MPU-6050, rather than the SparkFun Accelerometer block. At the time of this writing the cylon-i2c implementation of the lsm9ds0 driver is not working correctly with the SparkFun Accelerometer block, so I went the I2C route. The second an perhaps more important reason I went the I2C route is that MPU-6050 boards can be had for as low as $4, which is appealing for a low cost prototype.</p>

<p>I have a handful of MPUs I have tried and here is some info on them.</p>

<h3 id="a-hrefhttpswwwsparkfuncomproducts11028-targetblanksparkfun-mpu-6050-breakouta"><a href="https://www.sparkfun.com/products/11028" target="_blank">SparkFun MPU-6050 Breakout</a></h3>
<p>This is great accelerometer breakout that works well with the Edison and Cylon module, but much less expensive options exist.</p>

<h3 id="a-hrefhttpwwwamazoncomgpproductb00h1oye4q-targetblankriorand-triple-axis-mpu-6050-breakouta"><a href="http://www.amazon.com/gp/product/B00H1OYE4Q" target="_blank">RioRand Triple Axis MPU-6050 Breakout</a></h3>
<p>This is currently my go to accelerometer. It is relatively low priced at $11 and arrives in 2 days via Amazon Prime. These work well with both the Edison 3.3V boards, and the cylon i2c module. Unfortunately the default I2C address for this board is 0x69, instead of the more common  0x68 (used by the cylon mpu6050 driver) so you will need to solder the AD0 jumper plate on the top of the board.</p>

<h3 id="a-hrefhttpwwwamazoncomkootek-mpu-6050-mpu6050-sensors-accelerometerdpb008bopn40-targetblankkootek-gy-521-mpu-6050-mpu6050-modulea"><a href="http://www.amazon.com/Kootek-MPU-6050-MPU6050-sensors-Accelerometer/dp/B008BOPN40/" target="_blank">Kootek GY-521 MPU-6050 MPU6050 Module</a></h3>
<p>At $4 with free shipping these look like a great option. They are reported to work well with 3.3V VCC. The down side is very slow delivery via the slow boat. I have a handful on order, I will provide an update when they arrive.</p>

<h3 id="a-hrefhttpwwwamazoncomgpproductb009m19l4y-targetblankgy-521-6dof-mpu6050-modulea"><a href="http://www.amazon.com/gp/product/B009M19L4Y" target="_blank">GY-521 6DOF MPU6050 Module</a></h3>
<p>At a little over $5 with free shipping this seems like a great option, unfortunately the onboard voltage regulator in the GY-521 is designed for the Arduino 5V VCC and when used with a 3.3V VCC of the Edison blocks results in too low power on the I2C SDA/SCL pins to register as proper high and low voltage values. It is possible to give the board a separate 5V VCC supply, but that just seems overly complicated for the prototype device. Another feature of this board is the breakout of AD0 into a pin, allowing easy switching between I2C 0x68 and 0x69 addresses using either a ground or VCC connection.</p>

<h2 id="connecting-the-mpu">Connecting the MPU</h2>
<p>For the first prototype I am using  SparkFun Edison blocks, as I have a a few sets of these interchangeable blocks that are quick to assemble into a prototype. In this case I am using the <a href="https://www.sparkfun.com/products/13034" target="_blank">SparkFun I2C</a> block with an Edison. This block allows the Edison to be snapped onto the block, and the MPU-6050 board to be connected with 4 jumpers (VCC, GND, SDA, SCL).</p>

<h2 id="checking-i2c-address">Checking I2C Address</h2>
<p>Most MPU-6050 boards will have an I2C address of 0x68, but if you choose a different MPU and it isn’t working with Cylon, the first thing to check will be whether the address is 0x68. The error message from Cylon will be a <em>“RangeError: Trying to access beyond buffer length”</em> for most errors where the MPU is not connected properly. To check the address use the following command when the MPU is connected via I2C.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>i2cdetect -y -r 1
</code></pre>
</div>

<p>The result will look something like:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f
00:          -- -- -- -- -- -- -- -- -- -- -- -- -- 
10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
60: -- -- -- -- -- -- -- -- 68 -- -- -- -- -- -- -- 
70: -- -- -- -- -- -- -- --
</code></pre>
</div>

<p>You will see either a 68 or a 69 if the MPU-6050 is connected properly. If the address displayed is 69, you will need to change the address to 68 using the technique recommended for your board (AD0 jumper). You may see other numbers in the results if you have other I2C components included in your assembled device, but if you are using an MPU-6050 and it is connected correctly either a 68 or a 69 should appear in the i2cdetect results.</p>

<p>I won’t get into calibration or gesture recognition in this post, but will try to post more on MPU calibration, gesture recognition, etc in future posts. Given not all MPU-6050 breakouts work with the Edison because of their compatibility with 5V Arduino boards I wanted to post the notes of my experience with a few of them.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2015/08/16/esp8266.html">ESP8266</a></h1>
    
    
      <p class="meta">
        









<time datetime="2015-08-16T15:41:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="//s3.amazonaws.com/rwx-blog/ESP8266.jpg" style="height: 400px; display: block; margin: auto;" /></p>

<p>I have been building a few prototype devices with the following parts:</p>

<ul>
  <li><a href="https://www.sparkfun.com/products/13024" target="_blank">Intel Edison</a></li>
  <li><a href="https://www.sparkfun.com/products/13037" target="_blank">Sparkfun Battery Block</a></li>
  <li><a href="https://www.sparkfun.com/products/13034" target="_blank">Sparkfun I2C Block</a></li>
  <li><a href="http://www.amazon.com/gp/product/B00H1OYE4Q" target="_blank">MPU-6050</a></li>
</ul>

<p>The device runs a node.js app that handles configuration and also posting data to a web service running in the cloud. Each user has an account and can have 1 or more devices. I won’t get into the purpose of the device here (or a few more components it has) but the device is working for its intended early prototyping purpose.</p>

<p>I have a drawer full of SparkFun Edison blocks, and often use them with an Edison for the first prototype of a device because it is such a powerful prototyping platform if you know Linux well. They Sparkfun boards are rather expensive, but so quick to use for rapid prototyping that I tend to always start with them. They also integrate well with various node libs including <a href="https://www.npmjs.com/package/cylon" target="_blank">cylon</a> and <a href="https://github.com/node-red/node-red" target="_blank">nodered</a>.</p>

<p>But when it is time to build more than a few prototype units, cost does start to matter.  Replacing the Sparkfun boards with a PCB approach is the next obvious step to lowering cost and customizing the device, but in this latest device the Edison platform itself is too expensive to create the devices at the price point I am targeting. It is the perfect physical size, but the price is too high.</p>

<p>After some analysis I have decided to try to reproduce the behavior of the current device using an ESP8266 instead of the Edison. I ordered some very inexpensive ESP8266 that are coming via the slow boat, but in the mean time my <a href="https://goo.gl/yCnruP" target="_blank">Sparkfun ESP8266 Thing</a> arrived. It is a breakout board featuring the ESP8266.</p>

<p>I hope to get time over the next week to dive into coding the ESP8266, but if anyone has previously hooked up an MPU-6050 to an 8266 I would love to hear about your experiences and any issues, etc.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2015/08/16/edison-wifi-config.html">Edison Wi-Fi Configuration</a></h1>
    
    
      <p class="meta">
        









<time datetime="2015-08-16T13:55:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="//s3.amazonaws.com/rwx-blog/IMG_4161.JPG" style="height: 400px; display: block; margin: auto;" /></p>

<p>I built a handful of prototype devices using Intel Edison boards to hand out to testers, but one challenge is each tester will bring the devices to their own Wi-Fi environment (home, work, etc). The default method for configuring an Edison is to use a console and the command line configuration tool to add a Wi-Fi access point.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>configure_edison --wifi
</code></pre>
</div>

<p>The <em>configure_edison</em> app will scan for Wi-Fi networks and provide a list of networks for the user to pick from, and then prompt the user for the access point password. Since my headless IoT device has no traditional interface, let alone terminal interface this posed a problem. I needed a way for users to configure the device for new Wi-Fi networks as they were encountered, and make it accessible using a web page presented by the Edison. I will post the code once I have it completed and tested with users but for a quick hint the trick is to allow the running node.js app to switch the device between access point mode and client mode so if no network is available the device becomes an access point allowing the user to use any Wi-Fi enabled device to connect with it. Once connected the user can use a standard web browser to update the configuration to include the new Wi-Fi network they are intending to use.</p>

<h3 id="wpasupplicant">wpa_supplicant</h3>

<p>The Edison uses the wpa_supplicant service to manage the client-mode Wi-Fi. The wpa_supplicant configuration file is located at: <strong>/etc/wpa_supplicant/wpa_supplicant.conf</strong></p>

<p>Wi-Fi networks are added and removed by updating this configuration file. Se an example configuration below.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>ctrl_interface=/var/run/wpa_supplicant
ctrl_interface_group=0
config_methods=virtual_push_button virtual_display push_button keypad
update_config=1
fast_reauth=1
device_name=Edison
manufacturer=Intel
model_name=Edison

network={
  ssid="guest"
  key_mgmt=WPA-PSK
  pairwise=CCMP TKIP
  group=CCMP TKIP WEP104 WEP40
  eap=TTLS PEAP TLS
  psk="guest_pw"
  id_str="guest"
  priority=4
}

network={
  ssid="MyPhone"
  key_mgmt=WPA-PSK
  pairwise=CCMP TKIP
  group=CCMP TKIP WEP104 WEP40
  eap=TTLS PEAP TLS
  psk="hotspot_pw"
  id_str="iphone_hotspot"
  priority=2
}
</code></pre>
</div>
<p>As you can see I have added two networks to the configuration, and given the network associated with my phone (in personal hotspot mode) a lower priority so it will be a fallback only. <em>Note: you can change the name of your iPhone (and thus its personal hotspot) using itunes, and you can find the hotspot password in the hotspot settings on the iphone.</em></p>

<p>You can also add support for connecting to any open network (at your own risk) with an empty network statement</p>

<div class="highlighter-rouge"><pre class="highlight"><code>network={
  id_str="open"
  priority=0
}
</code></pre>
</div>

<p>If the network you are connecting to has a hidden ssid then you need to add <em>scan_ssid=1</em> to the configuration description. Because <em>scan_ssid=0</em> is the default setting and is used for a broadcast ssid it can be omitted from the configuration of networks using a broadcast ssid.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>network={
  scan_ssid=1
  ssid="MyHiddenSSID"
  key_mgmt=WPA-PSK
  pairwise=CCMP TKIP
  group=CCMP TKIP WEP104 WEP40
  eap=TTLS PEAP TLS
  psk="hidden_hotspot_pw"
  id_str="hidden_hotspot"
  priority=2
}
</code></pre>
</div>

<h3 id="switching-to-ap-mode-and-back">Switching to AP mode and back</h3>

<p>The Edison comes pre-configured for AP mode but if you are curious about changing the settings the configuration file can be found at <em>/etc/hostapd/hostapd.conf</em>.  The other key networking file that should require no changes for this configuration is <em>/etc/network/interfaces</em>.</p>

<p>In the case when no configured network is available it is possible to connect a gesture (my device has an mpu-6050) to force the device into AP mode so it can get information from the user about how to connect to a new local network. The gesture observer thread can inform the node app when the preconditions of an AP mode switch should occur, the node app can then switch the Wi-Fi network temporarily to AP mode.</p>

<p>This is accomplished by stoping the wpa_supplicant service and starting the APN services using these two system commands that can be executed in  exec() or spawn() calls.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>systemctl stop wpa_supplicant
systemctl start hostapd
</code></pre>
</div>

<h3 id="adding-a-network">Adding a network</h3>
<p>Now the device is in AP mode and the user can connect to the device by selecting it from the list of available networks, and go to the device confguration page for information about available networks and choose one to connect to. I won’t get into the scanning now but you can look <a href="https://goo.gl/xDxM5R" target="_blank">here</a> for more info on using _wpa_cli scan__ and <strong>wpa scan_results</strong> for getting info on available networks.</p>

<p>Once the user chooses a network and provides a password you can configure the device to use the network. My preference is to add the network and a config entry in the wpa_supplicant.conf file so the network can be used again in the future, but you can also use the wpa_cli to configure the network directly. Just use the format shown above to append your entry to the file.</p>

<h3 id="switch-back-to-wi-fi-client-mode-to-connect-to-the-newly-added-network">Switch back to Wi-Fi client mode to connect to the newly added network.</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>wpa_cli reconfigure
systemctl stop hostapd
systemctl start wpa_supplicant
</code></pre>
</div>

<p>I will add my code for the entire process to a public gist when I have fully tested it out, and update this post.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2015/08/16/the-post-title.html">Popup Workbench</a></h1>
    
    
      <p class="meta">
        









<time datetime="2015-08-16T13:00:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="//s3.amazonaws.com/rwx-blog/popup_workbench1.JPG" style="height: 400px; display: block; margin: auto;" /></p>

<p>We are down to one car, as we can walk/bike to about anything we could possibly need including caltrain and light rail. So the garage is now empty of cars, and filled with toys. While playing ping pong one day I decided a beverage table would be nice in the garage, but something that could also serve as a work surface in a pinch. Something to put some tools on, etc. I wanted it to be something that could be folded out of the way when not needed, and something that didn’t cost a lot since I wasn’t sure if it would really prove useful. Sort of a prototype 1 of a collapsable work surface concept.</p>

<p>I had some left over bamboo flooring from an old home improvement project that I thought would make a great table top, and I always have a few sheets of plywood around. All I was missing was the folding legs. After some searching I found some <a href="http://www.amazon.com/gp/product/B00LGBZC4G" target="_blank">Folding Shelf Bench Brackets</a>. I ordered 2 and installed them into a couple of wall studs in the garage and mounted a plywood top. I then cut and glued the strand bamboo flooring to the top to make a nice hard surface.</p>

<p><img src="//s3.amazonaws.com/rwx-blog/popup_workbench2.JPG" style="height: 400px; display: block; margin: auto;" /></p>

<p>For a true folding workbench something like <a href="http://goo.gl/lXKgtQ" target="_blank">this</a> looks very cool. If I decide I need something larger and more heavy duty I may go that route, but I have other benches already. I was looking for something that could add another table/work surface in a pinch in that particular location in the garage.</p>

<p>Now I also have a nice place to put cold drinks during ping pong matches.</p>

<p><img src="//s3.amazonaws.com/rwx-blog/popup_workbench3.JPG" style="height: 400px; display: block; margin: auto;" /></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2015/06/09/revisiting-buyers-agent-app-using-react-dot-js.html">Revisiting Buyer's Agent app using React.js</a></h1>
    
    
      <p class="meta">
        









<time datetime="2015-06-09T11:45:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In a past post I showed a <a href="http://rwx.io/blog/2014/10/22/mobile-real-estate-app-version-1/">Mobile Real Estate App</a> that was built with Polymer. This time around I will revisit the app but instead use <a href="https://facebook.github.io/react/" target="_blank">react.js</a>. The <strong>Mobile Buyer’s Agent</strong> is a simple web based application used to demonstrate a basic React.js mobile web app.The goal is to allows a real estate buyer’s agent to deliver a personalized mobile app experience to their clients by adding data to a Google spreadsheet. The agent updates a Google spreadsheet, and the web app loads its data from the spreadsheet.</p>

<p><a href="http://www.poggr.com/p-kz3NoHhgl:dZkIM34sBnlx?sheetid=1kv5haqhS8bUY_6IoJ6KBY5j42pN2WsY_wscDZSHb_m9" target="_blank"><img src="https://s3.amazonaws.com/fooqri-poggs/p-kz3NoHhgl/buyers_agent_1.png" /></a></p>

<p>This is a demonstration of using a shared <em>Google Spreadsheet</em>  as the data source for a simple web based application. By using poggr.com and <a href="http://facebook.github.io/react/" target="_blank">React.js</a> it is extremely easy to create a web application like the <strong><em><a href="http://www.poggr.com/p-kz3NoHhgl:dZkIM34sBnlx?sheetid=1kv5haqhS8bUY_6IoJ6KBY5j42pN2WsY_wscDZSHb_m9" target="_blank">Mobile Buyer’s Agent</a></em></strong>.</p>

<p>The <em>Real Estate Shopper List</em> Google spreadsheet contains properties the agent wishes to present in the app. The neighborhood column is associated with the dropdown box, and allows a simple grouping/categorization of properties. The agent also provides other features and details associated with the properties.</p>

<p><a href="//docs.google.com/spreadsheets/d/1kv5haqhS8bUY_6IoJ6KBY5j42pN2WsY_wscDZSHb_m8/pubhtml" target="_blank"><img class="spreadsheet-screen" src="//s3.amazonaws.com/fooqri-poggs/p-kz3NoHhgl/buyers_agent2.png" /></a></p>

<p><strong>Note:</strong> if you duplicate the example spreadsheet you must remember to publish it so it can be accessed by the <em>Mobile Buyer’s Agent</em> app. If you get an error it is likely you forgotto publish the spreadsheet. To publish a spreadsheet while viewing it, use the file menu on Google Docs and choose <em>“publish to the web”</em>, and follow the instructions.</p>

<h3 id="trying-your-own-spreadsheet">Trying your own spreadsheet</h3>

<p>If you publish your own copy of the spreadsheet you can easily substitute it in the app with a simple url parameter called <strong>sheetid</strong>.</p>

<p>For example if the link your are given when you plublish your spreadsheet is</p>

<div class="highlighter-rouge"><pre class="highlight"><code>https://docs.google.com/spreadsheets/d/1kv5haqhS8bUY_6IoJ6KBY5j42pN2WsY_wscDZSHb_m8/pubhtml
</code></pre>
</div>

<p>Then your sheetid is <strong>1kv5haqhS8bUY_6IoJ6KBY5j42pN2WsY_wscDZSHb_m8</strong>, and you can use it in this app by using a url with sheetid parameter as shown below:</p>

<p><code style="white-space: nowrap;">po.gg/p-kz3NoHhgl:dZkIM34sBnlx?sheetid=1kv5haqhS8bUY_6IoJ6KBY5j42pN2WsY_wscDZSHb_m8</code></p>

<p>This will substitue your spreadsheet for the default spreadsheet used in the app.</p>

<p>For info on the code take a look at the <a href="http://www.poggr.com/p-kz3NoHhgl:dbJMG3EjSneg" target="_blank">README</a> document.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/edison/iot/2015/02/18/seting-up-an-edison.html">Setting Up a New Intel Edison</a></h1>
    
    
      <p class="meta">
        









<time datetime="2015-02-18T12:42:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="//s3.amazonaws.com/rwx-blog/IMG_4161.JPG" style="height: 400px; display: block; margin: auto;" /></p>

<p>The Edison is a tiny and amazing computer, and ideal prototyping tool for wearable and IoT experiments. Here are the steps I am currently following to set up the Edison.</p>

<h2 id="flashing-the-edison">Flashing the Edison</h2>
<p>Like many developers I have Mac, Windows, and Linux laptops but I find that Linux is the best environment for flashing the Edison, even though I do most development on my Mac. I came to this conclusion after trying to recover an Edison with a lost password, the only platform that worked was Linux.</p>

<p>The first step is flashing the Edison. Follow <a href="https://communities.intel.com/docs/DOC-23200">Flashing Edison Linux</a>. You can also try <a href="https://communities.intel.com/docs/DOC-23193">Flashing Edison Mac</a>.</p>

<p>The only change I would recommend is to create a folder that contains the Edison images, and then unzip the downloaded folder into a sub directory named after the build number. Over time you may find yourself flashing to older or newer images based on the project needs.</p>

<h2 id="setting-up-wifi">Setting up WiFi</h2>
<p>Sparkfun offers a great guide for <a href="https://learn.sparkfun.com/tutorials/edison-getting-started-guide#connecting-to-WiFi">Setting up WiFi</a> on the Edison. This takes only a few minutes and even if you don’t plan to use WiFi in your projects it makes working with the Edison easier because you can use SCP and SSH to connect with the Edison over the network.</p>

<h2 id="connect-to-edison">Connect to Edison</h2>
<p>For OSX or Linux the best way to connect to the Edison is via SSH. On OSX you can use the name you gave the Edison in the step above. For example <em>ssh root@edison2.local</em> where <em>edison2</em> is the name you gave your Edison. On Linux you will use the Edison’s IP address, for example <em>ssh root@10.0.1.12</em>.</p>

<h2 id="using-emacs">Using Emacs</h2>
<p>If you are an Emacs user then once WiFi is setup you can use <a href="http://www.emacswiki.org/emacs/TrampMode">Emacs Tramp</a> to work with files on the Edison. Just use <em>C-x C-f</em> as usual, but instead of a directory use <em>root@edison2.local</em> or use the ip address for Linux.</p>

<p>Emacs will present a directory of files on the Edison that you can open, or just keep typing the name for auto suggest feature. For example <em>root@edison2.local/home/root/notes.md</em>.</p>

<h2 id="setup-bluetooth">Setup Bluetooth</h2>
<p>Bluetooth is available in the Edison, but in the default configuration is not enabled at boot. If you are using Bluetooth you will likely want to enable it on every reboot or power cycle.</p>

<h3 id="enable-bluetooth-at-boot">Enable Bluetooth at Boot</h3>
<p>Use the <strong>systemctl</strong> command to cause Bluetooth to start automatically</p>

<div class="highlighter-rouge"><pre class="highlight"><code> systemctl enable bluetooth
</code></pre>
</div>

<h3 id="create-a-bt-startup-script">Create a BT startup script</h3>
<p>Create a script file with the following five lines (<em>/home/root/btup.sh</em>).</p>

<div class="highlighter-rouge"><pre class="highlight"><code> <span class="c">#!/bin/sh</span>
 /usr/sbin/rfkill unblock bluetooth
 /usr/bin/hciconfig hci0 up
 /usr/bin/hciconfig hci0 piscan
 /usr/bin/hciconfig hic0 sspmode 0
</code></pre>
</div>

<h3 id="make-the-script-executable">Make the script executable</h3>

<div class="highlighter-rouge"><pre class="highlight"><code> chmod +x /home/root/btup.sh
</code></pre>
</div>

<h3 id="create-a-new-service-file-libsystemdsystembtupservice">Create a new service file (<em>/lib/systemd/system/btup.service</em>).</h3>

<div class="highlighter-rouge"><pre class="highlight"><code> [Unit]
 Description=BTUP
 After=bluetooth.target
 Before=systemd-user-sessions.service
 [Service]
 Type=simple
 RemainAfterExit=true
 ExecStart=/home/root/btup.sh
 Environment="HOME=/home/root"
 WorkingDirectory=/home/root/
 [Install]
 WantedBy=multi-user.target
</code></pre>
</div>

<h3 id="enable-the-service">Enable the service</h3>

<div class="highlighter-rouge"><pre class="highlight"><code> systemctl enable /lib/systemd/system/btup.service
</code></pre>
</div>

<h3 id="reboot-the-edison">Reboot the Edison</h3>

<div class="highlighter-rouge"><pre class="highlight"><code> reboot
</code></pre>
</div>

<h2 id="create-a-backup">Create a Backup</h2>
<p>Now is a good time to create a backup of the Edison that can be recovered if you need to return to a clean install. For example you may want to update nodejs, or install node modules, or even other drivers that may cause an issue you want to start over from.</p>

<p>Place a MicroSD card with at least 4GB of available space into the MicroSD slot on the dev kit board where the Edison is installed. Backup the Edison to an image file on the MicroSD. In the example below it is named <em>edison2_backup.img</em>. Make sure the file name has a <em>.img</em> extension. If you have a large MicroSD card you can store multiple backup images from multiple Edisons, making it quick and easy to recover each of them. It is wise to consider a consistent naming system.</p>

<div class="highlighter-rouge"><pre class="highlight"><code> dd if=/dev/mmcblk0 of=/media/sdcard/edison2_bk.img
</code></pre>
</div>

<h2 id="restoring-an-edison-from-backup">Restoring an Edison from Backup</h2>
<p>If you need to restore the Edison from backup just reverse the process</p>

<div class="highlighter-rouge"><pre class="highlight"><code> dd if=/media/sdcard/edison2_bk.img of=/dev/mmcblk0
</code></pre>
</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2014/10/23/photo-caption-challenge-using-s3-and-dynamodb-in-browser-app.html">Photo Caption Challenge - using Facebook Login, S3, and DynamoDb in browser app</a></h1>
    
    
      <p class="meta">
        









<time datetime="2014-10-23T13:18:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>One of the challenges of building small mobile web apps without a traditional back-end server is storing global state in a secure way. In my exploration of ways to store state I decided to build a very simple multi-player social app that allows players to participate in a simple photo challenge game. The game author specifies a <em>photo caption</em> and then invites friends to add photo responses that <em>most creatively</em> match the caption. The second feature is to allow people to vote on their favorite photo responses.</p>

<p><a href="//fooqri.poggr.com/peJE7qM0YUl" target="_blank"><img src="//s3.amazonaws.com/fooqri-poggs/peJE7qM0YUl/static/images/peJE7qM0YUl_screen.png" style="height: 400px; display: block; margin: auto;" /></a></p>

<p>Such a game would typically require a server to support a few key behaviors:</p>

<ul>
  <li><strong>player login</strong>: is needed to connect players with their uploaded photos, and also to limit their votes so as to keep voting fair.</li>
  <li><strong>photo storage</strong>: photo upload and storage is needed to store the photos so they can be displayed when the page is loaded. In addition a back-end service is typically used to re-size uploaded images before storing them to reduce storage costs.</li>
  <li><strong>global state</strong>: is generally provided by a database that stores information such as: which players have uploaded photos, and where the corresponding photos are located.</li>
</ul>

<p>There are many challenges to running a back-end server to support an app, including configuration, maintenance, and security. In the ideal case one could build all sorts of small fun apps without having to manage any such servers. With the <strong>Photo Caption Challenge</strong> app I explored using the following services instead of running an app server.</p>

<ul>
  <li><strong>player login</strong>: I  used Facebook for player login as a way to differentiate players, and connect ids to votes and photos.</li>
  <li><strong>photo storage</strong>: I used Amazon S3 for storing photos uploaded by players, and  used <em>canvas</em> and <em>canvas.toBlob()</em> (using <a href="https://github.com/blueimp/javascript-canvas-to-blob">JavaScript Canvas to Blob</a> polyfill) to re-size images and store them in a blob for upload to S3. Thus all image re-sizing is done in the client.</li>
  <li><strong>global state</strong>: I used Amazon DynamoDB to provide state via a table that stores information about photo entries and votes.</li>
</ul>

<p>I  also used the Amazon IAM is the way to limit privileges from the client app to the data services (S3 and DynamoDB). For example you want the user to have write/delete access to only their information in the data services, but client API calls to the server can be manipulated, thus authentication information is critical to limiting privileges in accessing the data services.</p>

<p>IAM policies can specify an <em>identity provider</em> like Facebook to make sure to limit access based on current session identity information, and not the API request data. For example you can configure an IAM policy for S3 that secures S3 bucket privileges so that sub-folder privileges are connected to user identity. In the case of “Photo Challenge” the policy states any logged in Facebook user running the Photo Challenges app will be able to view photos in any sub-folder, but only upload, modify, or delete items that are in a folder that matches their identity provider’s assigned userid. It also states that any user can create a folder in the bucket as long as the folder name matches their identity provider’s assigned userid.</p>

<p>The Amazon IAM policy for DynamoDB works similarly. Any logged in Facebook user running the Photo Challenges app will be able to query the DB index for the current list of photo entries, but can only add/delete records that have a userId value that matches their identity provider’s assigned userid. Thus a user can’t spoof who added the record, it is connected to their userId or it is rejected by the IAM policy assigned to the DynamoDB table. For more information see <a href="http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/FGAC_DDB.html">Fine-Grained Access Control for DynamoDB</a>.</p>

<h2 id="conclusion">Conclusion</h2>
<p>In <a href="http://octopress.dev/blog/2014/10/22/mobile-real-estate-app-version-1/">Mobile Real Estate App</a> and <a href="http://octopress.dev/blog/2014/10/15/spreadsheet-driven-web-apps/">Spreadsheet Driven Web Apps</a> I  described a technique for using a Google Spreadsheet to provide web application data, but this works best when the application data is read only. For an app that requires both read, write, and query transactions, a database like DynamoDB is a great solution.</p>

<p>Like many examples on this blog, I built this app using <em><a href="http://www.poggr.com">poggr.com</a></em> because poggs are incredibly flexible and require zero configuration.  Use this app at <a href="http://fooqri.poggr.com/peJE7qM0YUl:dxJ4NmcMAK8x">fooqri.po.gg/peJE7qM0YUl</a> or if you have a poggr account you can clone <a href="http://www.poggr.com/#/projects/project/peJE7qM0YUl">this pogg</a> and use its configuration tool to set up Facebook, S3, IAM, and DynamoDB and have your version of the game running in less than 5 minutes. If you don’t have an account you can still check out the pogg’s <a href="http://fooqri.poggr.com/peJE7qM0YUl:dxkgN7qMCtLg">README</a> to learn more about how it was build and view the source documents.</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2014/10/22/mobile-real-estate-app-version-1.html">Mobile Real Estate App - Version 1</a></h1>
    
    
      <p class="meta">
        









<time datetime="2014-10-22T19:46:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I promised a few examples of spreadsheet driven apps. You may remember the <a href="http://rwx.io/blog/2014/10/15/spreadsheet-driven-web-apps/">Hipster List</a> was the first example. These are simple web apps that are initialized using data from a Google Spreadsheet once the user loads them in a browser. Using spreadsheets to keep app information current is easy for anyone. There is even a way for users to point the app at their own Google Spreadsheet if the app developer wants to turn feature that on.</p>

<p>The next example of a spreadsheet driven app (<em>below</em>) is the <strong><em>Mobile Buyer’s Agent</em></strong> app. This may take a little time to load because it is an experiment, and thus not using a vulcanized Polymer library, so it is importing lots of individual library documents. Be patient and once cached in your browser it will be fast.</p>

<p><a href="//fooqri.poggr.com/pe16vKTbVLg::16" target="_blank"><img src="//s3.amazonaws.com/goddip-poggs/pe16vKTbVLg/screen1.png" style="height: 400px; display: block; margin: auto;" /></a></p>

<p>The idea is to create a mobile web app that can be used by buyers as they shop for a home. Once again the data is maintained in a Google spreadsheet, this time by the buyer’s agent. The agent can add houses, home information, and notes to the spreadsheet and the buyer can use the app to view the information as they shop. This is an easy way for an agent to personalize their client experience.</p>

<p>Take a look at the <a href="https://docs.google.com/spreadsheet/ccc?key=0Ahy9ODkMXc1GdEhuM1gxY1g0ckwwWl9RSzNGTGQwemc&amp;usp=sharing#gid=4">spreadsheet</a> to see how information is organized. It allows the agent to add personalized title and notes to each house.</p>

<p><a href="//docs.google.com/spreadsheet/ccc?key=0Ahy9ODkMXc1GdEhuM1gxY1g0ckwwWl9RSzNGTGQwemc&amp;usp=sharing#gid=4"><img class="spreadsheet-screen" src="//s3.amazonaws.com/goddip-poggs/pe16vKTbVLg/spreadsheet.png" /></a></p>

<p>The <a href="https://fooqri.poggr.com/pe16vKTbVLg:dgkE6vtp-4Ll::16">README</a> document provides  more details on how the app was built. Or <a href="https://fooqri.poggr.com/pe16vKTbVLg::16">try the app here</a>. I will likely provide a few updates to this app in the near future to make it a bit more interesting, but I though the first version showed a few nice features, and how to build them.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/polymer/nvd3/d3/charts/2014/10/17/d3-charts-wrapping-nvd3-charts-web-component.html">d3 charts - wrapping 'NVD3 Charts' in a web component</a></h1>
    
    
      <p class="meta">
        









<time datetime="2014-10-17T06:39:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In my continued experiments with <a href="https://www.polymer-project.org/" target="_blank">Polymer</a>, I created a web component that wraps  <a href="http://nvd3.org/" target="_blank">NVD3</a> - a reusable chart library for  <a href="http://d3js.org/" target="_blank">d3.js</a>.
As part of the activity I ported all of the  <a href="http://nvd3.org/examples/index.html" target="_blank">NVD3 example charts</a> to a web component I am calling _<goddip-charts>_. The component is contained in a <a href="http://www.poggr.com/pekqyTpXDEe:deJoY70GdVx" target="_blank">pogg</a> on <a href="http://www.poggr.com/home/" target="_blank">poggr.com</a>, as this is where I do my experimenting and it allows me to code and serve the project documents in the one place.</goddip-charts></p>

<iframe width="680px" height="380px" src="http://www.poggr.com/pg1GXbi9MBx:dlym9bhp4Lx::53"></iframe>

<p>The above chart is an iframe to <a href="http://www.poggr.com/pg1GXbi9MBx:dlym9bhp4Lx::53" target="_blank">this document</a> The actual element tag used is as follows:</p>

<div class="highlighter-rouge"><pre class="highlight"><code> &lt;goddip-charts  
   class="small-chart-styles"
   chartType="bar"
   context="/pg1GXbi9MBx:deyDCclAEUg::53" 
   css="/pg1GXbi9MBx:dxkNM7ZicfBe::53" &gt;
 &lt;/goddip-charts &gt;
</code></pre>
</div>

<p>To view the uncompiled and unminified source see (<a href="http://source.poggr.com/pg1GXbi9MBx:dlym9bhp4Lx::49" target="_blank">html document source</a>, <a href="http://source.poggr.com/pg1GXbi9MBx:deyDCclAEUg::49" target="_blank">data document source</a>, and <a href="http://source.poggr.com/pg1GXbi9MBx:dxkNM7ZicfBe::49" target="_blank">style document source</a>).</p>

<p>The best way to learn about the _<goddip-charts>_ component is to take a look at its <a href="http://www.poggr.com/pg1GXbi9MBx:dgJXG7boqzSe" target="_blank">README document</a>. This describes how to use each of the charts, reference data, add styling, etc. You can always view the component <a href="http://source.poggr.com/pg1GXbi9MBx:dlJkI7k9tBe" target="_blank">source</a>. If you have a _poggr.com_ account you can view, clone, and edit _goddip-charts_ using the <a href="http://project.poggr.com/pg1GXbi9MBx" target="_blank">poggr project UI</a>.</goddip-charts></p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/poggr/literate-coffee-script/2014/10/15/fun-with-literate-coffeescript.html">Fun with Literate CoffeeScript</a></h1>
    
    
      <p class="meta">
        









<time datetime="2014-10-15T16:53:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>As an emacs/<a href="http://orgmode.org/" target="_blank">org-mode</a>/<a href="http://orgmode.org/worg/org-contrib/babel/" target="_blank">babel</a> user I have always been fascinated with the potential of <a href="http://en.wikipedia.org/wiki/Literate_programming" target="_blank">literate programming</a> and combining inline code in my notes. I have many org-mode documents that interactively execute code for various tasks and procedures. These tasks includes certain maintenance activities, or destructive operations I don’t want to get wrong. I have an entire org document devoted to db maintenance, filled with Ruby code to execute complicated db queries and operations.  It is nice to see the example code inline in my notes, and be able to modify the code and execute it directly in my notes. This works especially well for checklist where calculations or actions are called for. You might even say org-mode was one inspiration for building <em><a href="http://www.poggr.com/home" target="_blank">poggr.com</a></em>; creating a browser based tool that is simple, flexible, and powerful for creating interactive and compelling documents that work in any web browser.</p>

<p>The potential of browser-based literate programming is why I find the idea of <em>Literate CoffeeScript</em> facinating. It is not just the idea of documenting code or even the idea of describing code in a blog post. It is the idea of creating flexible and effective browser based <em>task</em> and <em>tool</em> documents. The power in these types of documents is you see the code you are executing, which is extremely useful for programmer’s notes. It seems literate CoffeeScript might have something to say about how to create browser-based interactive notes that include inline code, like emacs/org-mode/babel has done for emacs users.</p>

<p>Since <em><a href="http://www.poggr.com/home" target="_blank">poggr.com</a></em> supports compiling CoffeeScript into JavaScript  I decided to turn on literate CoffeeScript and give it a go to see if this is a legitimate way to combine code and blogging in a single pogg document.</p>

<h3 id="poggr-coffeescript-compilation">Poggr CoffeeScript Compilation</h3>
<p>The way poggr works is that when you save a <em>CoffeeScript</em> document <em>poggr</em> keeps both source code and compiled <em>JavaScript</em> code. Just like when you save a <em>markdown</em> document poggr saves both the source markdown and the compiled html. When a document is requested using a <em>poggid</em> in an http request, poggr will deliver the compiled code unless a query parameter is used to request source. This works out quite well in most cases, since the compiled version is what browsers are expecting (html, css, JavaScript). This model allows poggr to support other markup and languages like <em>less</em>, <em>scss</em>, <em>yaml</em>, etc to work similarly.</p>

<p><em>LitCoffeeScript</em> is unique in that compilation produces two documents (markdown -&gt; html) and (CoffeeScript -&gt; JavaScript). Thus, one challenge is knowing whether a document request is for the  html or JavaScript version. I felt compelled enough to experiment that I added a test case where adding a <strong>.js</strong> extention to a <em>poggid</em> will return the JavaScript, otherwise it will return the compiled html version of the document.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>...
&lt;script src="//www.poggr.com/peJo73gk0Nx:dxkfEl2RANx.js"&gt;
...
</code></pre>
</div>

<p>I wanted to pick something fun to experiment with so I chose a game originally created by <em><a href="https://gist.github.com/macournoyer">Marc-André Cournoyer</a></em>.
in his <em><a href="https://gist.github.com/macournoyer/7357908" target="_blank">game.litcoffee</a></em> gist.</p>

<p>You can see my version of the  literate CoffeeScript post in action <a href="http://goddip.poggr.com/peJo73gk0Nx:dxkfEl2RANx" target="_blank">here</a>. What you will notice it the game is running as part of the post, and all the code is also embedded in the post. This may look like a normal code example post, but if you look at the  <a href="//source.poggr.com/peJo73gk0Nx:dxkfEl2RANx" target="_blank">source code</a> you will see at the end of the source document that the post actually loads the js version of itself. So by saving a literate CoffeeScript document you automatically get a blog post; in addition all of the fenced  CoffeeScript code is compiled into a JavaScript document.  Any changed inline code is re-compiled into an updated JavaScript document with each save. <strong><em>Mind Blown right!</em></strong></p>

<p>I can’t see it replacing my emacs/org/babel workflow yet, but it certainly opens some possibilities for having a set of private online notes, experiments, and tools I can call up in any browser to edit and execute. One down-side is while emacs is mode-less in that editing and execution happen together, the browser model is built for view-only. Poggr is built on browser-based document editing, but viewing the rendered results is still a separate action. Although it is not exactly the same emacs/org-mode, there are cases where it is actually better. Emacs does not excel where rich visualization and rendering are beneficial, this is what the browser does best.</p>

<p>When I get a chance I will port a few of my org-mode notes over to literate CoffeeScript documents on poggr and make a note here when they are up.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/poggr/google-docs/polymer/2014/10/15/spreadsheet-driven-web-apps.html">Spreadsheet Driven Web Apps</a></h1>
    
    
      <p class="meta">
        









<time datetime="2014-10-15T14:45:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="//fooqri.poggr.com/pgyUYTfcMUe:dgyFhkQ9M8e"><img src="//s3.amazonaws.com/goddip-poggs/pgyUYTfcMUe/example_screen.png" /></a></p>

<p>Using Google spreadsheets is a great way for a team to collaborate on a data set but it leaves a bit to be desired on presentation of the data. To that end I will be creating a series of fun examples showing how to build small interactive apps that utilize <em>Google Docs</em> and <em>Polymer</em> web components to quickly bring data to life. In this series I will be using a Google spreadsheet as the data source, but other data sources are possible, and I will get to those as well in future posts.</p>

<p>The first example is  <strong><em><a href="http://fooqri.poggr.com/pgyUYTfcMUe:dgyFhkQ9M8e">Hipster List</a></em></strong>, an app that shows cool places to visit in various cities. Check out the <strong><em><a href="//fooqri.poggr.com/pgyUYTfcMUe:dxJgUYaGcGUl">README</a></em></strong> document for details on how this app is put together.</p>

<p><a href="//docs.google.com/spreadsheet/ccc?key=0Ahy9ODkMXc1GdHRaTlI3Y2EydllTa2NsRjlxRVhMRlE&amp;usp=sharing#gid=0"><img class="spreadsheet-screen" src="//s3.amazonaws.com/goddip-poggs/pgyUYTfcMUe/spreadsheet_screen.png" /></a></p>

<p>A little convention is used to make it work. Namely, I use a <a href="https://docs.google.com/spreadsheet/ccc?key=0Ahy9ODkMXc1GdHRaTlI3Y2EydllTa2NsRjlxRVhMRlE&amp;usp=sharing">Hipster Hot Spots</a> Google spreadsheet, where each city’s data is represented by a tab in the spreadsheet. There is also a <em>key</em> tab that provides a list of all the cities in the spreadsheet and the tab id (<em>gid</em>) for each city’s data. The app will load its data from the spreadsheet and populate the city drop-down list of <em>hot spots</em>, and display a map with markers for each <em>hot spot</em>. This was a fun first example, remember to checkout the <a href="//fooqri.poggr.com/pgyUYTfcMUe:dxJgUYaGcGUl">readme document</a> for code and explanation.</p>

<p><strong>Note</strong>: I enabled url fragment parameters so you can easily point the app at your own copy of the spreadsheet for testing. See the <a href="//fooqri.poggr.com/pgyUYTfcMUe:dxJgUYaGcGUl">readme document</a> for the how-to instructions. Feel free to copy the spreadsheet and try out the app with your own list of cities and <em>hot spots</em>.</p>

<p>Separating code and data is always beneficial, but there is something cool about connecting an app to a Google spreadsheet. There are many spreadsheet users who would like to have an app to visualize their data, but may not be up to the coding challenge yet. I think many small useful apps could be built this way;  I will pick a few to build in the next few weeks and discuss them here. I am using the <em><a href="//www.poggr.com/home">poggr.com</a></em> service for the example, which is a service I built just for these types of small quick apps that can rely on an external data service. It is basically working to merge interactive content creation and blogging into a single service.</p>

<p>Leave me a comment if you have an small spreadsheet driven app you would like me to build. If it seems reasonable I may add it to the list.</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/development/rubymotion/ios/2013/06/01/coredata-dot-sqldebug-for-rubymotion.html">CoreData.SQLDebug for RubyMotion</a></h1>
    
    
      <p class="meta">
        









<time datetime="2013-06-01T12:23:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>It is sometimes handy to turn on CoreData.SQLDebug in the simulator when debugging a Core Data issue. I have found the output to be very useful in finding the hard to find little bugs that pop-up between restkit and core data. It can also help find performance issues with the database.  Unfortunately there isn’t any documentation for how to do this in RubyMotion. I found one solution that works to a degree. It requires installing the ios_sim app and forcing the simulator into CoreData.SQLDebug mode after the rubymotion build.</p>

<p>You will need to install ios_sim</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ brew install ios-sim
</code></pre>
</div>

<p>Then add the following two line as the last lines in your RubyMotion rakefile</p>

<div class="highlighter-rouge"><pre class="highlight"><code># Be sure to substitute your app name and make sure you are using
# the correct path to the app based on simulator version.
ios_sim = `which ios-sim`.strip
sh "#{ios_sim} launch build/iPhoneSimulator-6.1-Development/appname.app --args -com.apple.CoreData.SQLDebug 1"
</code></pre>
</div>

<p>This will open the simulator in CoreData.SQLDebug mode, and log debug information to the terminal.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/rubymotion/restkit/2013/03/07/getting-rklogconfigurebyname-working-in-rubymotion.html">Getting RKLogConfigureByName working in RubyMotion</a></h1>
    
    
      <p class="meta">
        









<time datetime="2013-03-07T15:21:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Just a quick note, I was getting an undefined constant error for
RKLogConfigureByName, the standard way of setting up logging in
RestKit. It seems that the #define statements in the
<em>/vendor/Pods/RestKit/Code/Support/RKLog.h</em> file are not getting
picked up. I am using the pod and loading with RubyMotion pod support,
so Iåm not sure what the issue is. I will need to investigate further
but this quick workaround works, just call the lower-level method
mapped via the #define. For example instead of RKLogConfigureByName
use RKlcl_configure_by_name.  I also list all the RKlcl_v constants to
use instead of the RKLogLevel constants. I also included an example of
how they are used, in this case I have put the setup in a method, and
it gets called from the the standard didFinishLaunchingWithOption
application block.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">app_delegate.rb</span><a class="code-highlight-caption-link" href="https://gist.github.com/4733618">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">def</span> <span class="nf">init_restkit_logging</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="c1">#define RKLogLevelOff       -&gt; RKlcl_vOff</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="c1">#define RKLogLevelCritical  -&gt; RKlcl_vCritical</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="c1">#define RKLogLevelError     -&gt; RKlcl_vError</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="c1">#define RKLogLevelWarning   -&gt; RKlcl_vWarning</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="c1">#define RKLogLevelInfo      -&gt; RKlcl_vInfo</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="c1">#define RKLogLevelDebug     -&gt; RKlcl_vDebug</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="c1">#define RKLogLevelTrace     -&gt; RKlcl_vTrace</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="c1"># "restkit"                           "RestKit" </span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="c1"># "restkit.network"                   "RestKit/Network" </span>
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="c1"># "restkit.network.cache"             "RestKit/Network/Cache" </span>
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="c1"># "restkit.network.queue"             "RestKit/Network/Queue" </span>
</div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="c1"># "restkit.network.reachability"      "RestKit/Network/Reachability" </span>
</div></div><div data-line="15" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="c1"># "restkit.object_mapping"            "RestKit/ObjectMapping" </span>
</div></div><div data-line="16" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="c1"># "restkit.core_data"                 "RestKit/CoreData" </span>
</div></div><div data-line="17" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="c1"># "restkit.core_data.cache"           "RestKit/CoreData/Cache" </span>
</div></div><div data-line="18" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="c1"># "restkit.core_data.search_engine"   "RestKit/CoreData/SearchEngine" </span>
</div></div><div data-line="19" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="c1"># "restkit.support"                   "RestKit/Support" </span>
</div></div><div data-line="20" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="c1"># "restkit.support.parsers"           "RestKit/Support/Parsers" </span>
</div></div><div data-line="21" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="c1"># "restkit.three20"                   "RestKit/Three20" </span>
</div></div><div data-line="22" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="c1"># "restkit.ui"                        "RestKit/UI" </span>
</div></div><div data-line="23" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="c1"># "restkit.testing"                   "RestKit/Testing" </span>
</div></div><div data-line="24" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="c1"># "app"                               "App"</span>
</div></div><div data-line="25" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="26" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="no">RKlcl_configure_by_name</span><span class="p">(</span><span class="s2">"Restkit"</span><span class="p">,</span> <span class="no">RKlcl_vDebug</span><span class="p">)</span>
</div></div><div data-line="27" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="no">RKlcl_configure_by_name</span><span class="p">(</span><span class="s2">"App"</span><span class="p">,</span> <span class="no">RKlcl_vDebug</span><span class="p">)</span>
</div></div><div data-line="28" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="no">RKlcl_configure_by_name</span><span class="p">(</span><span class="s2">"RestKit/Network*"</span><span class="p">,</span> <span class="no">RKlcl_vTrace</span><span class="p">)</span>
</div></div><div data-line="29" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="no">RKlcl_configure_by_name</span><span class="p">(</span><span class="s2">"RestKit/ObjectMapping"</span><span class="p">,</span> <span class="no">RKlcl_vTrace</span><span class="p">)</span>
</div></div><div data-line="30" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">end</span></div></div></pre></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/emacs/productivity/2013/03/04/nvalt-and-emacs.html">nvALT and Emacs</a></h1>
    
    
      <p class="meta">
        









<time datetime="2013-03-04T11:19:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In a previous post <a href="/blog/2012/12/17/wiki-plus-searchable-notes/">wiki-searchable-notes</a> I mentioned that I was using nvALT for note taking. nvALT is a very simple way to create and search notes and store them in flat files that can be used by other tools. One use is publishing to a github wiki, today I will discuss another.</p>

<p>I am an Emacs user and often found myself dropping out of emacs to find a note I needed in nvALT. I went looking for the best way to index and access my nvALT notes inside Emacs, and found the very cool emacs script called <a href="http://jblevins.org/projects/deft/">Deft</a> that works with <a href="http://jblevins.org/projects/markdown-mode/">EMacs Markdown Mode</a> to create the equivalent of nvALT inside of emacs. It can be configured to work with the nvALT repository so they work well together.</p>

<p>A few pointers…</p>

<ul>
  <li>If you use markdown in nvALT as I do, follow the instructions to install <a href="http://jblevins.org/projects/markdown-mode/">markdown-mode</a> via git clone.</li>
  <li>Follow the instructions to install  <a href="http://jblevins.org/projects/deft/">Deft</a> via git clone. It is an active repository, so clone makes keeping up-to-date easy. Also update init.el to require the deft.el script.</li>
  <li>For markdown and nvALT using the flat file config (see  <a href="http://www.pragmaux.com/post/38158334752/wiki-searchable-notes">wiki-searchable-notes</a> for flat file config) you need to add a few additional expressions in init.el. Add these four lines as discussed on the deft documentation.
<code class="highlighter-rouge">
(setq deft-extension "md")
(setq deft-directory "~/Development/wikis/Notes.wiki/")
(setq deft-text-mode 'markdown-mode)
(setq deft-use-filename-as-title t)
</code></li>
  <li>Follow the instructions to map a keyboard shortcut to open deft. I use H-d (see my <a href="http://www.pragmaux.com/post/41867238595/emacs-experimental-hyper-key-mappings">emacs hyper-key post</a> ) but a simple function key mapping would be.
<code class="highlighter-rouge">
(global-set-key [f8] 'deft)
</code></li>
  <li>Create a symlink from ~/.deft to your nvALT notes directory, this is shown in the nvALT preferences under the notes tab. See example below.
<code class="highlighter-rouge">
ln -s ~/Documents/notes/ .deft
</code>
When you eval init.el or restart emacs you should be set. Fire up Deft and the UI will operate just like nvALT, only it works in an Emacs buffer!!</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/emacs/hacks/2013/01/30/emacs-experimental-hyper-key-mappings.html">Emacs Experimental Hyper-Key Mappings</a></h1>
    
    
      <p class="meta">
        









<time datetime="2013-01-30T10:19:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In a previous post <a href="http://www.pragmaux.com/post/39243391147/remapping-my-caps-lock-key">Remapping My Caps Lock Key</a> I mentioned that I remapped my caps-lock key to escape, but also created a “hyper-key” (ctrl-shift-cmd-opt) when the caps-lock key is held down. This opens up a keyboard worth of new shortcuts for emacs. Here are a few I have been playing with for the past few days. An alternative key mapping would be to map the hyper key to holding down the tab key, if you already have the caps lock key mapped to control, and thus muscle memory might preclude this mapping from working for you.</p>

<p>H is the remapped caps-lock HyperKey from my earlier post, which translates as C-M-S-s in the emacs init.el key-mappings. I include an init.el excerpt at the end of the post for all of these mappings.</p>

<ul>
  <li>(H-l) This will mark the entire current line, from any position on the line. Using the arrow keys will extent the selection one line at a time either up or down.</li>
  <li>(H-f) This invokes text expansion for code completion, I do this a lot so I wanted it to be very comfortable.</li>
  <li>(H-3) This invokes the comment/uncomment function on a region, ruby comment is the # so I thought I would try this binding.</li>
  <li>(H-Right Arrow) This opens a new window to the right of the current window, I do this often enough I wanted it to be quick</li>
  <li>(H-Left Arrow) This closes the current window, sort of the opposite of Right arrow.</li>
  <li>(H-Down Arrow) This opens a new window below the current window</li>
  <li>(H-p) In the current window switch to the previous buffer</li>
  <li>(H-n) In the current window switch to the next buffer</li>
  <li>(H-delete) Kill this buffer</li>
  <li>(H-w) Quick copy line, pressing multiple times adds more lines to the copy</li>
  <li>(H-k) Quick cut line, pressing multiple times adds more lines to the cut</li>
  <li>(H-c) Copy region into register (prompts for register number)</li>
  <li>(H-v) Paste from register (prompts for register number)</li>
  <li>(H-spacebar) Open a popup shell in directory of current buffer.</li>
  <li>(H-e) Eval buffer, mostly used to eval init.el after tweaks</li>
</ul>

<p>I will likely be tweaking more in the upcoming weeks as I experiment with key mappings, I will post an update after I get a chance to work with the hyper-key for a while, and settle on a favorite set of key-mappings. See the excerpt from my init.el below.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">gistfile1.txt</span><a class="code-highlight-caption-link" href="https://gist.github.com/5691402">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line">(defun quick-copy-line ()
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">      "Copy the whole line that point is on and move to the beginning of the next line.
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">    Consecutive calls to this command append each line to the
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">    kill-ring."
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">      (interactive)
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">      (let ((beg (line-beginning-position 1))
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">            (end (line-beginning-position 2)))
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">        (if (eq last-command 'quick-copy-line)
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">            (kill-append (buffer-substring beg end) (&lt; end beg))
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">          (kill-new (buffer-substring beg end))))
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">      (beginning-of-line 2))
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line">(defun quick-cut-line ()
</div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line">  "Cut the whole line that point is on.  Consecutive calls to this command append each line to the kill-ring."
</div></div><div data-line="15" class="code-highlight-row numbered"><div class="code-highlight-line">  (interactive)
</div></div><div data-line="16" class="code-highlight-row numbered"><div class="code-highlight-line">  (let ((beg (line-beginning-position 1))
</div></div><div data-line="17" class="code-highlight-row numbered"><div class="code-highlight-line">  (end (line-beginning-position 2)))
</div></div><div data-line="18" class="code-highlight-row numbered"><div class="code-highlight-line">    (if (eq last-command 'quick-cut-line)
</div></div><div data-line="19" class="code-highlight-row numbered"><div class="code-highlight-line">	(kill-append (buffer-substring beg end) (&lt; end beg))
</div></div><div data-line="20" class="code-highlight-row numbered"><div class="code-highlight-line">      (kill-new (buffer-substring beg end)))
</div></div><div data-line="21" class="code-highlight-row numbered"><div class="code-highlight-line">    (delete-region beg end))
</div></div><div data-line="22" class="code-highlight-row numbered"><div class="code-highlight-line">  (beginning-of-line 1)
</div></div><div data-line="23" class="code-highlight-row numbered"><div class="code-highlight-line">  (setq this-command 'quick-cut-line))
</div></div><div data-line="24" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="25" class="code-highlight-row numbered"><div class="code-highlight-line">(transient-mark-mode 1)
</div></div><div data-line="26" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="27" class="code-highlight-row numbered"><div class="code-highlight-line">(defun select-current-line ()
</div></div><div data-line="28" class="code-highlight-row numbered"><div class="code-highlight-line">  "Select the current line"
</div></div><div data-line="29" class="code-highlight-row numbered"><div class="code-highlight-line">  (interactive)
</div></div><div data-line="30" class="code-highlight-row numbered"><div class="code-highlight-line">  (end-of-line) ; move to end of line
</div></div><div data-line="31" class="code-highlight-row numbered"><div class="code-highlight-line">  (set-mark (line-beginning-position)))
</div></div><div data-line="32" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="33" class="code-highlight-row numbered"><div class="code-highlight-line">(define-key help-map "d" 'docsetutil-search) ; C-h d
</div></div><div data-line="34" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="35" class="code-highlight-row numbered"><div class="code-highlight-line">(defvar th-shell-popup-buffer nil)
</div></div><div data-line="36" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="37" class="code-highlight-row numbered"><div class="code-highlight-line">(defun th-shell-popup ()
</div></div><div data-line="38" class="code-highlight-row numbered"><div class="code-highlight-line">  "Toggle a shell popup buffer with the current file's directory as cwd."
</div></div><div data-line="39" class="code-highlight-row numbered"><div class="code-highlight-line">  (interactive)
</div></div><div data-line="40" class="code-highlight-row numbered"><div class="code-highlight-line">  (unless (buffer-live-p th-shell-popup-buffer)
</div></div><div data-line="41" class="code-highlight-row numbered"><div class="code-highlight-line">    (save-window-excursion (shell "*Popup Shell*"))
</div></div><div data-line="42" class="code-highlight-row numbered"><div class="code-highlight-line">    (setq th-shell-popup-buffer (get-buffer "*Popup Shell*")))
</div></div><div data-line="43" class="code-highlight-row numbered"><div class="code-highlight-line">  (let ((win (get-buffer-window th-shell-popup-buffer))
</div></div><div data-line="44" class="code-highlight-row numbered"><div class="code-highlight-line">	(dir (file-name-directory (or (buffer-file-name)
</div></div><div data-line="45" class="code-highlight-row numbered"><div class="code-highlight-line">				      ;; dired
</div></div><div data-line="46" class="code-highlight-row numbered"><div class="code-highlight-line">				      dired-directory
</div></div><div data-line="47" class="code-highlight-row numbered"><div class="code-highlight-line">				      ;; use HOME
</div></div><div data-line="48" class="code-highlight-row numbered"><div class="code-highlight-line">				      "~/"))))
</div></div><div data-line="49" class="code-highlight-row numbered"><div class="code-highlight-line">    (if win
</div></div><div data-line="50" class="code-highlight-row numbered"><div class="code-highlight-line">	(quit-window nil win)
</div></div><div data-line="51" class="code-highlight-row numbered"><div class="code-highlight-line">      (pop-to-buffer th-shell-popup-buffer nil t)
</div></div><div data-line="52" class="code-highlight-row numbered"><div class="code-highlight-line">      (comint-send-string nil (concat "cd " dir "\n")))))
</div></div><div data-line="53" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="54" class="code-highlight-row numbered"><div class="code-highlight-line">(global-set-key (kbd "C-M-S-s-l")  'select-current-line)
</div></div><div data-line="55" class="code-highlight-row numbered"><div class="code-highlight-line">(global-set-key (kbd "C-M-S-s-f") 'hippie-expand)
</div></div><div data-line="56" class="code-highlight-row numbered"><div class="code-highlight-line">(global-set-key (kbd "C-M-s-#") 'comment-or-uncomment-region)
</div></div><div data-line="57" class="code-highlight-row numbered"><div class="code-highlight-line">(global-set-key (kbd "C-M-S-s-&lt;left&gt;") 'delete-window)
</div></div><div data-line="58" class="code-highlight-row numbered"><div class="code-highlight-line">(global-set-key (kbd "C-M-S-s-&lt;SPC&gt;") 'th-shell-popup)
</div></div><div data-line="59" class="code-highlight-row numbered"><div class="code-highlight-line">(global-set-key (kbd "C-M-S-s-p") 'switch-to-prev-buffer)
</div></div><div data-line="60" class="code-highlight-row numbered"><div class="code-highlight-line">(global-set-key (kbd "C-M-S-s-n") 'switch-to-next-buffer)
</div></div><div data-line="61" class="code-highlight-row numbered"><div class="code-highlight-line">(global-set-key (kbd "C-M-S-s-v") 'insert-register)
</div></div><div data-line="62" class="code-highlight-row numbered"><div class="code-highlight-line">(global-set-key (kbd "C-M-S-s-c") 'copy-to-register)
</div></div><div data-line="63" class="code-highlight-row numbered"><div class="code-highlight-line">(global-set-key (kbd "C-M-S-s-e") 'eval-buffer)
</div></div><div data-line="64" class="code-highlight-row numbered"><div class="code-highlight-line">(global-set-key (kbd "C-M-S-s-&lt;right&gt;") 'split-window-right)
</div></div><div data-line="65" class="code-highlight-row numbered"><div class="code-highlight-line">(global-set-key (kbd "C-M-S-s-&lt;down&gt;") 'split-window-below)
</div></div><div data-line="66" class="code-highlight-row numbered"><div class="code-highlight-line">(global-set-key (kbd "C-M-S-s-&lt;backspace&gt;") 'kill-this-buffer)
</div></div><div data-line="67" class="code-highlight-row numbered"><div class="code-highlight-line">(global-set-key (kbd "C-M-S-s-w") 'quick-copy-line)
</div></div><div data-line="68" class="code-highlight-row numbered"><div class="code-highlight-line">(global-set-key (kbd "C-M-S-s-k") 'quick-cut-line)</div></div></pre></div></figure>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/rubymotion/pixate/ios/development/2013/01/23/trying-out-pixate-css-for-ios-app-development.html">Trying out Pixate - CSS for iOS app Development</a></h1>
    
    
      <p class="meta">
        









<time datetime="2013-01-23T22:09:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Recently I have been using RubyMotion for iOS development; I really  appreciate developing in Ruby, and prefer Emacs to Xcode. Compared to using interface builder, styling apps can be a challenge. It is possible to use RubyMotion with XIB files created in Xcode’s Interface Builder, but I have been trying to avoid this. I am striving for a more web-app like design and development workflow.</p>

<p>I have been using <a href="https://github.com/rubymotion/teacup">teacup</a>, which takes a declarative approach to styling and uses a CSS-like DSL. Although I liked teacup, I had been anxiously awaiting the arrival of <a href="http://www.pixate.com/">Pixate</a> because of its support for CSS-based styling. Pixate became generally available this month, and I purchased a license. The license is $199, and although expensive, a small price compared to time saved if it works. Since I already do a lot of CSS work on the web side it seems like a nice way to leverage my CSS skills and experience. The Pixate team along with the RubyMotion team created a <a href="https://github.com/Pixate/RubyMotion-Pixate">RubyMotion-Pixate gem</a> that makes it easy to get Pixate working with RubyMotion.</p>

<p>After 2 days of coding I have my basic controllers in place as well as several TableViewControllers. I have used Pixate to style many of the elements. With Pixate you can style with four types of selectors:</p>

<ul>
  <li>element type selector - Select a control by element name</li>
  <li>universal selector - Select any control</li>
  <li>class selector - Select a control by class name</li>
  <li>id selector - Select a control by ID</li>
</ul>

<!--more-->

<p>It also supports attribute selectors and pseudo classes. See the <a href="http://cdn.pixate.com/docs/engine/ios/1.0/Pixate%20Engine%20for%20iOS%20Styling%20Reference.html">complete list</a> for more information on selectors and styling.</p>

<p>One really nice feature is the ability to set up Pixate to dynamically change your app in the simulator when you update the CSS. This is an awesome feature. To set it up add these two  <em>PXStylesheet</em> lines to your app_delegate.rb file near the end of the <em>application</em> method:</p>

<div class="highlighter-rouge"><pre class="highlight"><code> def application(application, didFinishLaunchingWithOptions:launchOptions)
    ...
    PXStylesheet.styleSheetFromFilePath('path-to/default.css', withOrigin:0)
    PXStylesheet.currentApplicationStylesheet.monitorChanges = true  
    true
 end
</code></pre>
</div>

<p>I was only able to get it to work by providing the absolute path to the css file, so add your absolute path in place of <em>path-to</em> in the above method call. I will post if I figure out how to do a relative path, I hate putting in absolute paths.</p>

<p><strong>Warning</strong>: I found that Pixate 1.0.2 does not work properly on the device if these two statements are left in the app delegate when compiling for the device. If your styles are not being picked up on the device this may be the reason. To get around this during development I put in a test for simulator using the <em>Device.simulator?</em> method in <a href="https://github.com/rubymotion/BubbleWrap">Bubblewrap</a>,</p>

<div class="highlighter-rouge"><pre class="highlight"><code> def setup_pixate_monitor 
   PXStylesheet.styleSheetFromFilePath('path-to/default.css', withOrigin:0)
   PXStylesheet.currentApplicationStylesheet.monitorChanges = true
 end
</code></pre>
</div>

<p>Then include this conditional call:</p>

<div class="highlighter-rouge"><pre class="highlight"><code> setup_pixate_monitor if Device.simulator?
</code></pre>
</div>

<p>So far Pixate has mostly worked as expected, but there was one odd issue. I had expected that I could create zero-sized frames and allow CSS to style them to the correct size. For example creating a new label object might look like this.</p>

<div class="highlighter-rouge"><pre class="highlight"><code> @name_label = UILabel.alloc.initWithFrame(CGRectZero)
 @name_label.styleId = 'name_label'
</code></pre>
</div>

<p>CGRectZero, a CGRect constant, will set the frame to size [0,0][0,0]. Then the CSS style definition below should set the frame size correctly.</p>

<div class="highlighter-rouge"><pre class="highlight"><code> #name_label { 
   position:fixed;
   top              :20px;
   left             :5px;
 	   width            :300px;
   height           :30px;  
   font-size        :16px;
   font-align       :center;  
 } 
</code></pre>
</div>

<p>I would expect the frame to be set to [5,20][300, 30] when the application is run. Instead the frame remains set to [0,0][0,0], so the text in the label is not displayed in the interface. This [0,0][0,0] frame size is confirmed with REPL using the tree command that comes with the <a href="https://github.com/rubymotion/sugarcube">sugarcube gem</a>.</p>

<p>When I set the frame to a non-zero size when creating the UI object, then the CSS style is picked up and the frame size is set correctly by Pixate. Very odd, I am assuming this to be a bug, but maybe there was a reason to leave zero-sized frames unaltered by CSS. Typically CGRectZero frames are used to hide UI elements until they are ready to be used, or until the dimensions are known based on content.  If a CSS selector matched zero-sized frames I suppose this could lead to some unexpected behavior for iOS developers accustom to zero-sized frames not being displayed until the specifically resize them in code.</p>

<p>In the end I created a new global constant</p>

<div class="highlighter-rouge"><pre class="highlight"><code> CSSRect = [0, 0], [1, 0] 
</code></pre>
</div>

<p>and this allows the CSS to do its job. So</p>

<div class="highlighter-rouge"><pre class="highlight"><code> @name_label = UILabel.alloc.initWithFrame(CSSRect)
 @name_label.styleId = 'name_label'
</code></pre>
</div>

<p>allows me to create frames that are then altered to the correct size via CSS. I also found that using CGRectInfinite works as well. Basically it sets a huge rectangle but the CSS resizes it as expected.</p>

<p>The  <a href="https://github.com/Pixate/RubyMotion-Pixate">RubyMotion-Pixate gem</a> also adds REPL support for changing the style via REPL. This is handy, but I find the dynamic updating via the CSS file to be easier to use.</p>

<p>The Pixate Engine consists of two core technologies: a 2D graphics engine and a CSS styling engine. So far my focus has been using the CSS styling engine.  By using a styling rendering engine, design execution can be pushed to run-time. One of the benefits of this approach is the ability to dynamically modify the look of an app, which can be useful in user testing, including A/B testing. For this, Pixate allows CSS to be loaded via a URL, much like a web browser. I am sure there will be performance implications of this dynamic rendering approach, so this will also have to be explored as a cost versus the benefit of dynamic styling.</p>

<p>I really liked Colin Gray’s ideas around teacup, and the rubyesque way it integrated with rubymotion.</p>

<div class="highlighter-rouge"><pre class="highlight"><code> @search = subview(UITextField, :search)
</code></pre>
</div>

<p>It would be interesting if this syntax could be used with Pixate versus the less elegant:</p>

<div class="highlighter-rouge"><pre class="highlight"><code> @search = UITextField.alloc.initWithFrame(CSSRect)
 @search.styleId = 'search'
</code></pre>
</div>

<p>I have only just begun to use Pixate, there may be possibilities for making the calls a bit more elegant without writing too many helpers.</p>

<p>I will add more posts as I learn more.</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/opinion/project-management/2013/01/21/the-three-cs.html">The three c's</a></h1>
    
    
      <p class="meta">
        









<time datetime="2013-01-21T10:26:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I really enjoyed <a href="http://www.networkworld.com/community/blog/tony-fadell-unique-nature-apples-design-process">this interview</a> with Tony Fadell on the unique nature of Apple’s design process. The discussion about project abandonment percentages is incredibly important, and often overlooked in large companies. In many cases abandonment is a financial decision related to either real or opportunity costs associated with launching a product. People who have never worked for a large consumer products company likely have no idea how many products are cancelled just before launch because of the incredible cost in launching a product into the market.</p>

<p>Tony makes an amazing point about the toll such high cancellation rates have on employees at a company, and on the quality of the products the company ships. The inverse is that high commitment to ship products that pass key milestones leads to better employee commitment.</p>

<blockquote>
  <p>“When you’re in a culture that has a point of view, and drives to launch everything it does, you know you’re on the hook and you better bring your best game every time,” Fadell explained.</p>
</blockquote>

<p>Tony contrasts his experience at Apple with his experience at Philips:</p>

<blockquote>
  <p>Fadell explained that a key and yet often overlooked difference between Apple and other tech companies is that Apple ships 99% of the products that pass certain internal milestones. By way of contrast, during Fadell’s tenure at Philips - where he was charged with overseeing the company’s audio strategy - the iPod guru noted that Philips would axe 9 projects out of 10, even if a particular product was about to ship.</p>
</blockquote>

<p>I don’t think large companies have a metric for tracking the number and impact of cancelled projects. In my experience executive teams wanted to forget cancellations as quickly as possible and move on. They considered the cost to be in the past, and by having cancelled the project they had cut any ongoing cost.  But as Tony points out, there are ongoing costs, just not costs that have their own column on a balance sheet or scorecard. In my experience it was clear … the impact of cancellations were cumulative and devastating.</p>

<p>The importance of commitment is actually one of the 3 c’s I use when evaluating a project: <em>Clarity</em>, <em>Competency</em>, and <em>Commitment</em>. Over the years I have found these to be the key pieces of early stage information that will best predict the success of a project. Tony’s pont about commitment is that it isn’t only about commitment to a project, it is about the culture of commitment in an organization. I like this point, and I imagine there is a corollary for organizational clarity and competency. Below are a few notes related to project level evaluation of the 3 c’s</p>

<!--more-->

<p><strong>Clarity</strong></p>

<p>Clarity is an evaluation of how clear the goals are for the product, and how well understood the product is.</p>

<p>For example:</p>

<ul>
  <li>A project to enhance a successful existing product with incremental features likely has very high clarity.</li>
  <li>A project to move a successful product through a major transition will likely have medium clarity, but in some cases will have low clarity if the product manager and the team have different ideas about product direction.</li>
  <li>A project to improve an unsuccessful product is usually medium to low clarity. If you are lucky you understand what went wrong, but lack of clarity is often the reason it failed in the first place.</li>
  <li>A new product is usually low clarity, but if you have a great product manager it may be medium clarity to high clarity.</li>
  <li>A new product in a new market is often low clarity and may even be disguised as medium to high clarity because the teams reviewing the product have little experience in the market. By this I mean the product brief will use language that sounds high clarity, but market experts would easily identify the brief as too vague. This is where competency and clarity overlap early in a project.</li>
</ul>

<p>My first task was always to make sure there was a plan in place to address any clarity issues immediately. From my experience without such a plan and milestones for high clarity, teams often started to build the wrong product, or multiple wrong products. If the team cannot agree on what the product really is, it will certainly fail. New products could achieve medium to high clarity. The key step is to identify clarity as an issue and put a plan in place to provide good clarity early in the project. I have seen many product requirements documents that were very detailed, but no two team members would describe the same product when asked what the product was. Providing detail  is not the same as providing clarity.</p>

<p><strong>Competency</strong></p>

<p>One of the other key issues in the success of a project is competency. In a large company design, and engineering <em>resources</em> tend to be plugged in to a project primarily based on their availability. There is an idea of a performance band with some people regularly performing better than others, but rarely a deep understanding of the individual competencies of  team members. Having directed both engineering and design teams, and worked closely with product management for many years I have come to see that individual competencies play a key role in project success; a role that is rarely reflected in evaluations or performance rankings. Evaluations rarely measure competency. For an interesting take on the fallacy of skills in success see <a href="http://www.amazon.com/The-Success-Equation-Untangling-Investing/dp/1422184234">The Success Equation: Untangling Skill and Luck in Business, Sports, and Investing</a></p>

<p>Here I look for a match in competency for the product needs, but also for how well the team works in the particular product context. How much experience does this team have defining and launching a new product? Has the lead engineer designed anything at this scale before? Many projects fail because a key competency is lacking on the product team.</p>

<p><strong>Commitment</strong></p>

<p>This is what Tony is referring to in his interview, how much commitment is there for this product? This refers to team commitment as well as executive commitment. In my experience, commitment issues fall into a few categories.</p>

<p><em>Market Issues</em></p>

<p>It is sometimes the case, especially in technology, where the market is moving so fast projects become obsolete before they are completed. This leads to high cancellation rates. These cases are about risk management, and understanding that the market evolution rate is a key issue. For example having a 24 month product cycle in a rapid innovation market may be taking on a lot of risk. If you can’t move faster, maybe find a market that better matches your organizational delivery capabilities.</p>

<p><em>Structural Commitment Issues</em></p>

<p>In some cases a company is trying to do too many things, and commitment is a structural issue. I suspect Tony’s characterization of Philips false into the structural definition. In these cases it is important to force prioritization and work with executives to understand that doing fewer things better will actually result in shipping not only better products, but more products. It can seem counter-intuitive, but I think Tony’s description above shows how this has been proven at Apple. Less SKU’s more volume.</p>

<p><em>Project Commitment Issues</em></p>

<p>I often found that when project comitment was low, it was low in very specific ways. Here are a few examples:</p>

<ul>
  <li>
    <p>Low hanging fruit - Many projects came across my desk as the so-called low-hanging fruit project. These are projects that are so low cost and high value that they seem obviously high-commitment on the surface; they often originate in an executive review meeting. The main issue here is that no one questions them, so their clarity is usually quite low, and their commitment falsely high. Usually as clarity rises even a small amount, commitment collapses because the actual project could never deliver on the low hanging fruit mirage that came out of a thirty minute executive discussion.</p>
  </li>
  <li>
    <p>The magic mirror - Another class of projects with commitment issues were the magic mirror projects. These are projects where whomever is looking at the projects sees what they want to see, and ignores everything else. These types of projects are the most dangerous because they are usually multi-headed beasts that are trying to simultaneously serve many masters.  Their commitment is based in company politics and thus commitment can shift or disintegrate very quickly.</p>
  </li>
</ul>

<p>Given my team’s success was based solely on shipping successful products my most important task was usually at the early phase of projects, and mostly making sure that projects scored high on their combined CCC levels.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/ruby/parsers/2013/01/19/parsing-a-simple-markdown-style-list-in-ragel.html">Parsing a simple markdown style list in Ragel</a></h1>
    
    
      <p class="meta">
        









<time datetime="2013-01-19T13:04:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In an earlier post <a href="http://www.pragmaux.com/post/40689737812/simple-state-machine-example">Simple state machine example</a>, I provided an example of using the Ruby <em>state_machine</em> gem to create a state machine for handling a simple list of tasks. In this post I will provide a similar but not exactly compatible description of building a parser to read lists from a text file. In this example I use the markdown syntax for lists, where items can be placed hierarchically, thus removing the need for a separate “list” object.</p>

<p>I found the <a href="http://www.complang.org/ragel/ragel-guide-6.7.pdf">Ragel documentation</a> to be excellent. The only issue is a lack of practical examples. Given the dearth of examples available, I though I would add my +1 example to help the cause. If you are serious about using Ragel I recommend reading the documentation start to finish quickly, then a second go through taking notes on key items like default machines, syntax, priorities, actions, etc before building a parser. Having a strong base will help tremendously when using examples.</p>

<p>There are three files involved in this solution to the list problem:</p>

<ul>
  <li>lists.txt: a data file that contains two lists for the parser to parse.</li>
  <li>mdlist.rb: a ruby class that will call the parser and output the list returned from the parser.</li>
  <li>mdlist_parser.rl: A file that will be used by Ragel to create a parser class definition (mdlist_parse.rb).</li>
</ul>

<p>I added all three files to one gist, which is shown below. Below the lists.txt data file uses a markdown like syntax where hierarchy is expressed through indentation (4 spaces or a tab).</p>

<!--more-->

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">lists.txt</span><a class="code-highlight-caption-link" href="https://gist.github.com/4573704">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line">## Tasks
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">- Go to Whole Foods
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">    - Go to produce section   
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">        - get oranges
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">          maybe Mandarine and Valencia
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">        - get avocados
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">        - get squash
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">          maybe buttercup if they have it
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">    - Go to bakery section
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">        - get bagels
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">        - get 12 cupcakes 
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line">    - Go to Dairy
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line">    - get milk
</div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line">     	  should be organic 2% if they have it
</div></div><div data-line="15" class="code-highlight-row numbered"><div class="code-highlight-line">- Pay for items 
</div></div><div data-line="16" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="17" class="code-highlight-row numbered"><div class="code-highlight-line">## Tasks
</div></div><div data-line="18" class="code-highlight-row numbered"><div class="code-highlight-line">- Write up a Ragel example for blog
</div></div><div data-line="19" class="code-highlight-row numbered"><div class="code-highlight-line">    - Create simple example for parsing lists   
</div></div><div data-line="20" class="code-highlight-row numbered"><div class="code-highlight-line">        - Ragel code for a parser
</div></div><div data-line="21" class="code-highlight-row numbered"><div class="code-highlight-line">          Should provide support for parsing multiple task lists.
</div></div><div data-line="22" class="code-highlight-row numbered"><div class="code-highlight-line">          It should also support hierarchical task lists
</div></div><div data-line="23" class="code-highlight-row numbered"><div class="code-highlight-line">    - Create a simple ruby class that uses the parser 
</div></div><div data-line="24" class="code-highlight-row numbered"><div class="code-highlight-line">    - post code as gists
</div></div><div data-line="25" class="code-highlight-row numbered"><div class="code-highlight-line">    - Write up a blog post describing the use of ragel in the example
</div></div><div data-line="26" class="code-highlight-row numbered"><div class="code-highlight-line">- Post to blog</div></div></pre></div></figure>
<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">mdlist.rb</span><a class="code-highlight-caption-link" href="https://gist.github.com/4573704">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nb">require</span> <span class="s1">'rubygems'</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nb">require</span> <span class="s1">'./mdlist_parser.rb'</span> 
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">class</span> <span class="nc">MDList</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> 
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="n">contents</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="p">&#x7b;</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="n">f</span><span class="p">.</span><span class="nf">read</span> <span class="p">&#x7d;</span>   
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="n">lexer_lists</span> <span class="o">=</span> <span class="no">MDListParser</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">contents</span><span class="p">.</span><span class="nf">to_str</span><span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="s1">'\n'</span><span class="p">,</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">))</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="nb">puts</span> <span class="n">lexer_lists</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="n">lexer_lists</span><span class="p">.</span><span class="nf">lists</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">list</span><span class="o">|</span> 
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">        	<span class="nb">puts</span> <span class="s2">"Tasks:"</span>
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line">      		<span class="n">list</span><span class="p">[</span><span class="ss">:items</span><span class="p">].</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span>
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line">      		  <span class="nb">puts</span>  <span class="s2">"-"</span><span class="p">.</span><span class="nf">rjust</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">item</span><span class="p">[</span><span class="ss">:level</span><span class="p">])</span> <span class="o">+</span> <span class="n">item</span><span class="p">[</span><span class="ss">:title</span><span class="p">]</span> <span class="o">+</span> <span class="s2">" : ("</span> <span class="o">+</span> <span class="n">item</span><span class="p">[</span><span class="ss">:level</span><span class="p">].</span><span class="nf">to_s</span> <span class="o">+</span> <span class="s2">")"</span>
</div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line">      		  <span class="n">item</span><span class="p">[</span><span class="ss">:description</span><span class="p">].</span><span class="nf">split</span><span class="p">(</span><span class="sr">/\r?\n/</span><span class="p">).</span><span class="nf">each</span>  <span class="k">do</span> <span class="o">|</span><span class="n">l</span><span class="o">|</span> 
</div></div><div data-line="15" class="code-highlight-row numbered"><div class="code-highlight-line">      		     <span class="nb">puts</span> <span class="s2">" "</span><span class="p">.</span><span class="nf">rjust</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">item</span><span class="p">[</span><span class="ss">:level</span><span class="p">])</span> <span class="o">+</span> <span class="n">l</span><span class="p">.</span><span class="nf">strip</span> 
</div></div><div data-line="16" class="code-highlight-row numbered"><div class="code-highlight-line">      		  <span class="k">end</span>  
</div></div><div data-line="17" class="code-highlight-row numbered"><div class="code-highlight-line">      		<span class="k">end</span> 
</div></div><div data-line="18" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">end</span>
</div></div><div data-line="19" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="20" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="k">end</span> 
</div></div><div data-line="21" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="22" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">end</span>
</div></div><div data-line="23" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div></pre></div></figure>
<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">mdlist_parser.rl</span><a class="code-highlight-caption-link" href="https://gist.github.com/4573704">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line">class MDListParser  
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">  attr_accessor :lists
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">	%%&#x7b;
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">	  machine test_lexer;
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">	  action MarkTaskStart &#x7b; 
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">	    task_start = fpc  
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">	    lists_index += 1 
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line">	    @lists[lists_index] = &#x7b;:items =&gt; []&#x7d;
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line">	    item_index=-1    
</div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line">	  &#x7d;
</div></div><div data-line="15" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="16" class="code-highlight-row numbered"><div class="code-highlight-line">	  action MarkTaskTitleStart &#x7b; 
</div></div><div data-line="17" class="code-highlight-row numbered"><div class="code-highlight-line">	    task_start = fpc  
</div></div><div data-line="18" class="code-highlight-row numbered"><div class="code-highlight-line">	  &#x7d;
</div></div><div data-line="19" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="20" class="code-highlight-row numbered"><div class="code-highlight-line">	  action MarkTaskDescriptionStart &#x7b; 
</div></div><div data-line="21" class="code-highlight-row numbered"><div class="code-highlight-line">	    task_start = fpc
</div></div><div data-line="22" class="code-highlight-row numbered"><div class="code-highlight-line">	    item_index=-1    
</div></div><div data-line="23" class="code-highlight-row numbered"><div class="code-highlight-line">	  &#x7d;
</div></div><div data-line="24" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="25" class="code-highlight-row numbered"><div class="code-highlight-line">	  action IncrementTaskLevel &#x7b; 
</div></div><div data-line="26" class="code-highlight-row numbered"><div class="code-highlight-line">	    task_level += 1  
</div></div><div data-line="27" class="code-highlight-row numbered"><div class="code-highlight-line">	  &#x7d;
</div></div><div data-line="28" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="29" class="code-highlight-row numbered"><div class="code-highlight-line">	  action TaskText &#x7b;     
</div></div><div data-line="30" class="code-highlight-row numbered"><div class="code-highlight-line">		if data[p]          
</div></div><div data-line="31" class="code-highlight-row numbered"><div class="code-highlight-line">		    item_index += 1
</div></div><div data-line="32" class="code-highlight-row numbered"><div class="code-highlight-line">			@lists[lists_index][:items] &lt;&lt;  &#x7b; :type =&gt; task_item_type, :level =&gt; task_level, :title =&gt; data[task_start...p].pack('c*').strip, :description =&gt; ""&#x7d;         
</div></div><div data-line="33" class="code-highlight-row numbered"><div class="code-highlight-line">			task_level = 1
</div></div><div data-line="34" class="code-highlight-row numbered"><div class="code-highlight-line">		end
</div></div><div data-line="35" class="code-highlight-row numbered"><div class="code-highlight-line">	  &#x7d; 
</div></div><div data-line="36" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="37" class="code-highlight-row numbered"><div class="code-highlight-line">	  action TaskDescriptionText &#x7b;     
</div></div><div data-line="38" class="code-highlight-row numbered"><div class="code-highlight-line">		if data[p]          
</div></div><div data-line="39" class="code-highlight-row numbered"><div class="code-highlight-line">			@lists[lists_index][:items][item_index][:description] = data[task_start...p].pack('c*').strip           
</div></div><div data-line="40" class="code-highlight-row numbered"><div class="code-highlight-line">			task_level = 1
</div></div><div data-line="41" class="code-highlight-row numbered"><div class="code-highlight-line">		end
</div></div><div data-line="42" class="code-highlight-row numbered"><div class="code-highlight-line">	  &#x7d;     
</div></div><div data-line="43" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="44" class="code-highlight-row numbered"><div class="code-highlight-line">	  space_or_tab = " " | [\t];
</div></div><div data-line="45" class="code-highlight-row numbered"><div class="code-highlight-line">	  indent_or_tab = "    " | [\t];  
</div></div><div data-line="46" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="47" class="code-highlight-row numbered"><div class="code-highlight-line">	  task_header = "##" space_or_tab* "Tasks" space_or_tab* [\n];               
</div></div><div data-line="48" class="code-highlight-row numbered"><div class="code-highlight-line">	  task_char = (digit+ '.' &gt;&#x7b;task_item_type = :ordered&#x7d;) | ('-' &gt;&#x7b;task_item_type = :unordered&#x7d;); 
</div></div><div data-line="49" class="code-highlight-row numbered"><div class="code-highlight-line">	  task_title =  [^\n]+ [\n]; 
</div></div><div data-line="50" class="code-highlight-row numbered"><div class="code-highlight-line">	  task_starter = indent_or_tab* @IncrementTaskLevel task_char;  
</div></div><div data-line="51" class="code-highlight-row numbered"><div class="code-highlight-line">	  task_description_line =  ([^\n]+ - ^[##]) [\n]; 
</div></div><div data-line="52" class="code-highlight-row numbered"><div class="code-highlight-line">	  task_description =  (task_description_line - task_header)+; 
</div></div><div data-line="53" class="code-highlight-row numbered"><div class="code-highlight-line">	  #task_description =  (task_description_line)+; 
</div></div><div data-line="54" class="code-highlight-row numbered"><div class="code-highlight-line">	  task_item =  task_starter space_or_tab* (task_title &gt;MarkTaskTitleStart  %TaskText) (task_description*  &gt;MarkTaskDescriptionStart %TaskDescriptionText);
</div></div><div data-line="55" class="code-highlight-row numbered"><div class="code-highlight-line">	  task = (task_header &gt;MarkTaskStart) . task_item*;      
</div></div><div data-line="56" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="57" class="code-highlight-row numbered"><div class="code-highlight-line">	  main := |*          
</div></div><div data-line="58" class="code-highlight-row numbered"><div class="code-highlight-line">	    task+; 
</div></div><div data-line="59" class="code-highlight-row numbered"><div class="code-highlight-line">	   *|;              
</div></div><div data-line="60" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="61" class="code-highlight-row numbered"><div class="code-highlight-line">	&#x7d;%%  
</div></div><div data-line="62" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="63" class="code-highlight-row numbered"><div class="code-highlight-line">	def initialize(data) 
</div></div><div data-line="64" class="code-highlight-row numbered"><div class="code-highlight-line">	  %% write data;  
</div></div><div data-line="65" class="code-highlight-row numbered"><div class="code-highlight-line">	  data = data.unpack("c*") if(data.is_a?(String))
</div></div><div data-line="66" class="code-highlight-row numbered"><div class="code-highlight-line">	  eof = data.length
</div></div><div data-line="67" class="code-highlight-row numbered"><div class="code-highlight-line">	  @lists = []  
</div></div><div data-line="68" class="code-highlight-row numbered"><div class="code-highlight-line">	  token_array = [] 
</div></div><div data-line="69" class="code-highlight-row numbered"><div class="code-highlight-line">	  task_item_type = "" 
</div></div><div data-line="70" class="code-highlight-row numbered"><div class="code-highlight-line">	  lists_index=-1 
</div></div><div data-line="71" class="code-highlight-row numbered"><div class="code-highlight-line">	  task_level = 1
</div></div><div data-line="72" class="code-highlight-row numbered"><div class="code-highlight-line">	  fpc = 0
</div></div><div data-line="73" class="code-highlight-row numbered"><div class="code-highlight-line">	  fc = ""
</div></div><div data-line="74" class="code-highlight-row numbered"><div class="code-highlight-line">	  %% write init;  
</div></div><div data-line="75" class="code-highlight-row numbered"><div class="code-highlight-line">	  %% write exec;
</div></div><div data-line="76" class="code-highlight-row numbered"><div class="code-highlight-line">	end     
</div></div><div data-line="77" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="78" class="code-highlight-row numbered"><div class="code-highlight-line">end
</div></div><div data-line="79" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="80" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="81" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="82" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div></pre></div></figure>

<p>To create an app that supported operating on these lists you would need to parse the list and create objects that could be operated on. Perhaps adding checkboxes in a UI, or strike-through font when the item is marked complete.</p>

<p>In this example I am using Ragel, which uses a set of state machine definitions to generate a state machine. In this case I am using Ragel to generate a parser to parse lists similar to the ones shown in lists.txt. In Ragel you specify a Ruby class that uses a series of preprocessors (%%) that are processed by the Ragel library.  Ragel will replace these blocks and preprocessor commands with ruby parser code and a parse table; resulting in a state machine for parsing the file.  The documentation will describe all of the required preprocessor commands for Ruby. Ragel supports many languages and the preprocessor commands differ slightly for different languages. Check the documentation for meaning.</p>

<p>The bulk of the instructions for creating a parser are inside the <em>%%{ }%%</em> block. The block is made up of machine definitions and actions. Ragel state machines recognize byte sequences as regular expression machines do, but can also execute code at arbitrary points in the recognition of a regular language (actions).  Here regular expressions are used to define a regular grammar, see type-3 in the <a href="http://en.wikipedia.org/wiki/Chomsky_hierarchy">Chomsky hierarchy</a>.</p>

<p>Thus when you see the statement:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>task_title =  [^\n]+ [\n]
</code></pre>
</div>

<p>this is defining a machine (<em>[^\n]+ [\n]</em>) and assigning it a name <em>task_title</em>. The Ragel documentation refers to the right side of the expression as a <em>regular expression machine</em> or <em>machine</em>, this is roughy equivalent to production rules in tradition grammar design. Using named expressions this way allows grammar rules to be built up recursively, much like non-terminals are used in traditional grammar definitions.</p>

<p>Thus an expression like:</p>

<p>task = (task_header &gt;MarkTaskStart) . task_item*;</p>

<p>uses the rules <em>task_header</em><strong>** and <em>task_item</em></strong>** in the definition of the expression. Ragel expressions look unusual at first because they are both defining a grammar and embedding behavior (code). For example the above expression includes a reference to of a block of code <strong><em>MarkTaskStart</em></strong> that should be executed when the <strong><em>task_header</em></strong> machine is matched. These code blocks are called <em>actions</em> in Ragel. It can be useful to use a convention like all lowercase for rules, and CamelCase for actions to make the expressions easier to read.</p>

<p>Ragel defines a syntax for specifying when an action is to be called relative to state transitions between machines. For example before a transition, after a transition, or at the end of file, etc. The documentation is very good, though it is terse.</p>

<table border="1">
<col style="padding-right: 30px;" />
<col style="padding-right: 30px;" />
<col />
  <tr>
    <th>Name</th>
    <th>Syntax</th>
  </tr>
  <tr>
    <td style="width: 200px;">entering action</td>
    <td style="width: 200px;">expr &gt;action</td>
  </tr>
  <tr>
    <td style="width: 200px;">finishing action</td>
    <td style="width: 200px;">expr @ action </td>
  </tr>
    <tr>
    <td style="width: 200px;">all transitions action</td>
    <td style="width: 200px;">expr $ action</td>
  </tr>
  <tr>
    <td style="width: 200px;">leaving actions</td>
    <td style="width: 200px;">expr % action</td>
  </tr>
</table>
<p><br />
Ragel also allows you to embed error handling behavior using a similar mechanism.</p>

<p>Finally, one of the challenges of regular grammars is the requirement that they are <a href="http://en.wikipedia.org/wiki/Deterministic_finite_automaton">DFA’s</a> and thus need to be deterministic. Ragel provides a mechanism for including priorities in the case where multiple next states are possible; you can define which state will be taken. For more see the Ragel documentation on priorities and guarded expressions. The reason I suggested reading through the documentation prior to reading example grammars is that Ragel expressions can begin to look very confusing if you are not versed in the difference between the syntax associated with machines, actions, priorities and guards, since they all appear intermingled in a Ragel expression.</p>

<p>To create a parser for the <em>mdlist_parser.rl</em> file shown above use this command:</p>

<div class="highlighter-rouge"><pre class="highlight"><code> ragel -R mdlist_parser.rl
</code></pre>
</div>

<p>This will create a parser written in ruby called <em>mdlist_parser.rb</em> that can be included into your Ruby program.</p>

<p>Now we need a simple Ruby program to use the parser, I am including this because I didn’t see a lot of examples for how to do this so wanted to add one here.</p>

<p>The simple ruby class defined in <em>mdlist.rb</em> will open the data file and read it in to a string, and pass the string to the parser. The parser will return a Ruby object that has a <em>lists</em> method that returns the list in a data structure. The above class will then output the list formatted to show the hierarchy. The list could easily be used to create a list object that includes the state machine from my earlier <a href="http://www.pragmaux.com/post/40689737812/simple-state-machine-example">state machine</a> post.</p>

<p>I will assume you have Ragel, installed, if not get it <a href="http://www.complang.org/ragel/">here</a>. To see the parser in action you need all three files (mdlist_parser.rl, mdlist.rb, lists.txt) in the same directory and then take these steps:</p>

<ol>
  <li><strong>run the ragel parser:</strong>   ragel -R mdlist_parser.rl</li>
  <li>
    <p><strong>run irb</strong> and enter the following into irb:</p>

    <ul>
      <li>load “mdlist.rb”</li>
      <li>list = MDList.new(“lists.txt”)</li>
    </ul>
  </li>
</ol>

<p>You should see the output of the puts statements displaying the lists data structure with information about the hierarchy of the list. It would be easy to replace the puts with a call to a method like add_item() from my state_machine example referenced earlier.</p>

<p>That’s it. Defining grammars and using parser generators can seem challenging at first, but once you get through a few examples and build a simple grammer it will become very simple, since the rules are really very simple. The language of grammar definition can be challenging at first,  but just try to understand the concepts and don’t get too bogged down in the terminology. Ragel is a very powerful tool for any developer to have in their tool belt, especially if you are interested in building high performance APIs, it combines a powerful parser generator with an expressive syntax for generating powerful state machines. To fully understand this and other examples check out the Ragel documentation and tutorials listed below.</p>

<ul>
  <li><a href="http://www.complang.org/ragel/">Ragel Home</a></li>
  <li><a href="http://thingsaaronmade.com/blog/a-simple-intro-to-writing-a-lexer-with-ragel.html">A simple intro to writing a lexer with Ragel.</a></li>
  <li><a href="http://www.devchix.com/2008/01/13/a-hello-world-for-ruby-on-ragel-60/">A Hello World for Ruby on Ragel 6.0</a></li>
  <li><a href="http://www.zedshaw.com/essays/ragel_state_charts.html">Ragel State Charts</a></li>
  <li><a href="http://tech.blog.cueup.com/regular-expressions-will-stab-you-in-the-back">Regular Expressions Will Stab You in the Back</a></li>
</ul>

<p>Also see this great <a href="http://www.confreaks.com/videos/491-rubyconf2010-consuming-gherkin-one-byte-at-a-time"> Consuming Gherkin: One Byte at a Time video</a> intro of Mike Sassak &amp; Greg Hnatiuk discussing their experience using Ragel for the Cucumber parser.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/opinion/creativity/brain-hacks/2013/01/18/pattern-problems-vs-logic-problems.html">Pattern problems vs logic problems</a></h1>
    
    
      <p class="meta">
        









<time datetime="2013-01-18T11:48:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote>
  <p>Suppose three men can paint three fences in three hours. How long would it take one man to paint one fence?</p>
</blockquote>

<p>I ran across this interesting problem in <a href="http://www.amazon.com/The-Joy-Guided-Infinity-ebook/dp/B006R8PL7G/ref=tmm_kin_title_0">“The Joy of x: A Guided Tour of Math, from One to Infinity,”</a> a very accessible and interesting tour of mathematics.</p>

<p>It turns out most people quickly answer “one hour.”  As Strogatz opines,</p>

<blockquote>
  <p>The words themselves nudge you that way. The drumbeat in the first sentence— three men, three fences, three hours— catches your attention by establishing a rhythm, so when the next sentence repeats the pattern with one man, one fence, <em>__</em> hours, it’s hard to resist filling in the blank with “one.” The parallel construction suggests an answer that’s linguistically right but mathematically wrong.</p>
</blockquote>

<p>The correct answer is three hours. It is obvious if you imagine each person painting their own fence for three hours. Remove two people and two fences and you are left with one person, still painting their one fence for three hours, as before.</p>

<p>What struck me about this problem is that it is an incredibly simple, concrete, and visual example of how our brains try to match patterns, but more importantly the side effect that occurs when a pattern is matched. Neuroscience studies suggest that dopamine (a neurotransmitter associated with pleasure) is released when we solve a problem, thus giving us a biological explanation for that wonderful feeling we get when we have solved a problem.</p>

<p>This made me wonder, does our brain perhaps release dopamine when we solve the faux pattern matching problem and <em>tricks</em> us into thinking we solved the actual logic problem? Thus we quickly blurt out the wrong answer.  After all, we have spent a lifetime feeling the dopamine rush when we believe we have the answer to a problem. Strogatz’s observation about this particular word problem having two solutions (a pattern solution, and a logic solution) is very interesting, and is likely very related to a number of <a href="http://en.wikipedia.org/wiki/List_of_biases_in_judgment_and_decision_making">Cognitive Biases</a>. It is perhaps valuable to think about this explicitly when considering information:</p>

<ul>
  <li>What is the pattern problem being suggested?</li>
  <li>What is the logic problem being suggested?</li>
</ul>

<p>And make sure you have the answer the right question when you feel that first burst of dopamine show up.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/opinion/creativity/2013/01/17/creativity-booster-get-a-dog.html">Creativity Booster: Get a dog.</a></h1>
    
    
      <p class="meta">
        









<time datetime="2013-01-17T12:47:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>It probably sounds specious, but I have found having a dog around has made me both more productive and more creative. The evidence for this claim is the number of daily messages I post to our team message board that start with the phrase “While I was out walking the dog I had this idea….”</p>

<p>Before getting a dog I would get sucked into a problem and become obsessed with solving it, the kind of linear obsession that leaves no room for creative leaps. What is needed is to allow the problem to marinate in my subconscious, to facilitate the unexpected synaptic connections that occur when you finally let your mind relax. The problem is, obsession with solving the problem makes this type of relaxed mind difficult and leaps of creativity less frequent. I am sure with practice one could recognize the symptoms and use some type of mediation exercise, but for me the answer is walking the dog. The pattern repeats regularly … I hit a nasty bug or design conundrum, get stuck, and then take the dog out for 15-20 minutes, and the answer suddenly presents itself.</p>

<p>For me, dog walking seems to engage the kind of subconscious pattern matching that provides the keys to unlock many problems. <a href="http://en.wikipedia.org/wiki/Graham_Wallas">Wallas</a> would have called this the <a href="http://en.wikipedia.org/wiki/Creativity#Incubation">incubation</a> phase of creativity. I think of it as a cousin to Mihály Csíkszentmihályi’s concept of the <a href="http://en.wikipedia.org/wiki/Flow_(psychology)">flow</a> mental state. This seems to be validated by Nardi’s <a href="http://www.youtube.com/watch?v=MGfhQTbcqmA">work</a> on the neuroscience of personality. Specifically, the brain imaging results where he describes the delta state in terms of Csíkszentmihályi’s flow, but adds that “also on occasion when we are copacetic, open to whatever comes next.” This is a perfect description of my mental state on a walk with the dog. I feel close to that feeling of flow, but not quite the same – an approximation. But it seems to do the trick. As a side note, Nardi’s brain imaging results of people watching TV shows up as black; similar to a deep non-dreaming sleep. So TV is not so good for creativity … just saying.</p>

<p>I don’t find that walking alone or with another person works as well. I wonder if it is the non-conversational interactions with the dog, just enough interaction to get me to stop focussing on the issue, but not so much that my mind is focussed on keeping up a conversation with someone else. Whatever the reason, it works; almost always presenting a promising new direction, if not an outright answer.</p>

<p>This is my muse, Archer, the retired racing greyhound.</p>

<p><img src="http://media.tumblr.com/cfdcc46c180984c7ab7e3d43cb14a116/tumblr_inline_mgs53cHq981qz562v.jpg" alt="" /></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/rubymotion/2013/01/17/rubymotion-ios-apps.html">RubyMotion iOS Apps</a></h1>
    
    
      <p class="meta">
        









<time datetime="2013-01-17T11:28:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I wanted to make a quick note that I have been using <a href="http://www.rubymotion.com/">RubyMotion</a> the past few months. I don’t mind building natively in Objective-C but since I have been coding both the app and the server side I found switching between Objective-C and Ruby a bit frustrating. I really find Objective-C to be too verbose a syntax for my taste. I also prefer to code in emacs vs. the Xcode UI. Call me old fashioned, but I find I can work much faster when I can operate on the code directly, versus through an intermediary UI.</p>

<p>The second reason for switching to RubyMotion is the libraries that are being created, they make iOS development feel so comfortable to a Ruby developer. Three key examples are <a href="https://github.com/rubymotion/BubbleWrap">BubbleWrap</a>, <a href="https://github.com/rubymotion/sugarcube">SugarcCube</a> and <a href="https://github.com/rubymotion/teacup">Teacup</a>.</p>

<p>The third reason is testing and debugging, I like that RubyMotion comes with an RSpec clone, this means I have the same testing framework on both app and server. I also love the interactive console, there is nothing like tweaking your app live from a console (REPL). I find I can debug a lot of the code from the console, but RubyMotion also supports GDB for the more serious debugging needs. I hadn’t used GDB in a few years but it came back to me pretty quickly once I started using it.</p>

<p>I also like the DSL approach of Teacup in styling RubyMotion iOS apps. I like that I can create style files much like I do with CSS and have my app UI built with the style information, makes changing style feel more natural to me as a web developer.</p>

<p>I have no doubt that there are many Objective-C developers who are extremely efficient in building apps, but it is always a challenge to become expert on multiple platforms. To become an expert iOS developer you need to become expert in the Cocoa libraries; the nice thing about RubyMotion is it allows you to learn the libraries within a familiar syntax if you are a ruby developer. It also allows you to create Ruby wrappers and generators that make developing for Cocoa feel more natural to a Ruby developer. Finally, since RubyMotion creates compiled native iOS apps, their is very little performance hit.</p>

<p>I have a backlog of notes that I will post when I get a chance; including my experiences with development,  debugging, meta-programming, deploying via TestFlight, etc. I just wanted to give RubyMotion some praise from this Ruby developer, it has made developing iOS apps very similar to deploying ruby apps.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/ruby/servers/development/2013/01/17/lean-api-on-heroku.html">Lean API on Heroku</a></h1>
    
    
      <p class="meta">
        









<time datetime="2013-01-17T08:46:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>We have recently been working on an iOS app that requires a backend service. In this case I was looking for something leaner, simpler, and faster than Rails since it was only an API for a mobile app, no web front-end. I wanted it to be very lean and scalable so we could make it through early user testing without spending a lot on servers. Ok, ideally without spending anything on servers; basically how much could I squeeze out of one Heroku worker.</p>

<p>After some investigation of the typical light weight ruby frameworks (Sinatra, Merb, etc) I stumbled upon <a href="https://github.com/intridea/grape">Grape</a>, a ruby API micro-framework. Grape uses a very simple DSL for defining APIs for your Ruby objects. Grape runs on <a href="https://github.com/postrank-labs/goliath">Goliath</a>, which is a non-blocking Ruby web server framework that uses Ruby fibers to simplify the handling of asynchronous requests. Goliath runs on the popular <a href="https://github.com/eventmachine/eventmachine">EventMachine</a> reactor. EventMachine is an event-driven Ruby library that works much like Node.js.</p>

<p>The <a href="https://github.com/intridea/grape">Grape</a> github page provides a great deal of information on getting started, and David Jones has a great <a href="https://github.com/djones/grape-goliath-example">example</a> project on GitHub demonstrating how to deploy a grape API on Heroku.</p>

<p>The DSL is really simple and I was able to wrap some ruby objects in a day and deploy it on Heroku. Here is an snippet of what the DSL looks like.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">grape_example.rb</span><a class="code-highlight-caption-link" href="https://gist.github.com/4555788">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nb">require</span> <span class="s1">'goliath'</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nb">require</span> <span class="s1">'em-synchrony'</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nb">require</span> <span class="s1">'em-synchrony/em-mongo'</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nb">require</span> <span class="s1">'grape'</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nb">require</span> <span class="s1">'./app/models/mission.rb'</span> 
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nb">require</span> <span class="s1">'./app/models/player.rb'</span> 
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">module</span> <span class="nn">MyAppName</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="k">class</span> <span class="nc">API_v1</span> <span class="o">&lt;</span> <span class="no">Grape</span><span class="o">::</span><span class="no">API</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="n">prefix</span> <span class="s1">'api'</span>   
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="n">version</span> <span class="s1">'v1'</span><span class="p">,</span> <span class="ss">:using</span> <span class="o">=&gt;</span> <span class="ss">:header</span><span class="p">,</span> <span class="ss">:vendor</span> <span class="o">=&gt;</span> <span class="s1">'company_id'</span> <span class="k">do</span> 
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="nb">format</span> <span class="ss">:json</span>
</div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="15" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="n">resource</span> <span class="s1">'missions'</span> <span class="k">do</span> 
</div></div><div data-line="16" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="17" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="c1"># All mission API endpoints go here...</span>
</div></div><div data-line="18" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="c1"># ...</span>
</div></div><div data-line="19" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="20" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="n">desc</span> <span class="s2">"Get a mission record using its id as key"</span><span class="p">,</span> <span class="p">&#x7b;</span>
</div></div><div data-line="21" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="ss">:params</span> <span class="o">=&gt;</span> <span class="p">&#x7b;</span>
</div></div><div data-line="22" class="code-highlight-row numbered"><div class="code-highlight-line">           <span class="s2">"id"</span> <span class="o">=&gt;</span> <span class="p">&#x7b;</span> <span class="ss">:id</span> <span class="o">=&gt;</span> <span class="s2">"Mission id."</span><span class="p">,</span> <span class="ss">:required</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="p">&#x7d;</span>
</div></div><div data-line="23" class="code-highlight-row numbered"><div class="code-highlight-line">          <span class="p">&#x7d;</span>
</div></div><div data-line="24" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="p">&#x7d;</span>
</div></div><div data-line="25" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="26" class="code-highlight-row numbered"><div class="code-highlight-line">      	<span class="n">get</span> <span class="s2">"/:id"</span> <span class="k">do</span>  
</div></div><div data-line="27" class="code-highlight-row numbered"><div class="code-highlight-line">        	<span class="n">error!</span> <span class="s1">'Unauthorized'</span><span class="p">,</span> <span class="mi">401</span> <span class="k">unless</span> <span class="n">env</span><span class="p">[</span><span class="s1">'HTTP_SECRETK'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'a secret key'</span>
</div></div><div data-line="28" class="code-highlight-row numbered"><div class="code-highlight-line">        	<span class="n">missions_json</span> <span class="o">=</span> <span class="n">env</span><span class="p">.</span><span class="nf">missions_coll</span><span class="p">.</span><span class="nf">find</span><span class="p">(&#x7b;</span><span class="s1">'_id'</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">]&#x7d;)</span>
</div></div><div data-line="29" class="code-highlight-row numbered"><div class="code-highlight-line">        	<span class="n">error!</span> <span class="s1">'Mission not found'</span><span class="p">,</span> <span class="mi">404</span> <span class="k">unless</span> <span class="n">missions_json</span> <span class="o">!=</span> <span class="p">[]</span>
</div></div><div data-line="30" class="code-highlight-row numbered"><div class="code-highlight-line">        	<span class="n">mission</span> <span class="o">=</span> <span class="n">missions_json</span><span class="p">.</span><span class="nf">map</span> <span class="p">&#x7b;</span><span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="no">Mission</span><span class="p">.</span><span class="nf">from_json</span><span class="p">(</span><span class="n">i</span><span class="p">)&#x7d;.</span><span class="nf">first</span> 
</div></div><div data-line="31" class="code-highlight-row numbered"><div class="code-highlight-line">          <span class="c1"># map returns an array of 1 item, so get first as the mission object</span>
</div></div><div data-line="32" class="code-highlight-row numbered"><div class="code-highlight-line">          <span class="c1"># do something with the mission object here</span>
</div></div><div data-line="33" class="code-highlight-row numbered"><div class="code-highlight-line">          <span class="c1"># then return object to caller as json</span>
</div></div><div data-line="34" class="code-highlight-row numbered"><div class="code-highlight-line">        	<span class="n">mission</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">to_json</span>
</div></div><div data-line="35" class="code-highlight-row numbered"><div class="code-highlight-line">      	<span class="k">end</span>    
</div></div><div data-line="36" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="37" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="c1">#...       </span>
</div></div><div data-line="38" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="39" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="n">resource</span> <span class="s1">'players'</span> <span class="k">do</span> 
</div></div><div data-line="40" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="41" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="c1"># All player API endpoints go here...</span>
</div></div><div data-line="42" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="c1"># ...</span>
</div></div><div data-line="43" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="44" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="n">desc</span> <span class="s2">"Get a player record using its id as key"</span><span class="p">,</span> <span class="p">&#x7b;</span>
</div></div><div data-line="45" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="ss">:params</span> <span class="o">=&gt;</span> <span class="p">&#x7b;</span>
</div></div><div data-line="46" class="code-highlight-row numbered"><div class="code-highlight-line">           <span class="s2">"id"</span> <span class="o">=&gt;</span> <span class="p">&#x7b;</span> <span class="ss">:id</span> <span class="o">=&gt;</span> <span class="s2">"Player id."</span><span class="p">,</span> <span class="ss">:required</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="p">&#x7d;</span>
</div></div><div data-line="47" class="code-highlight-row numbered"><div class="code-highlight-line">          <span class="p">&#x7d;</span>
</div></div><div data-line="48" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="p">&#x7d;</span>
</div></div><div data-line="49" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="50" class="code-highlight-row numbered"><div class="code-highlight-line">      	<span class="n">get</span> <span class="s2">"/:id"</span> <span class="k">do</span>  
</div></div><div data-line="51" class="code-highlight-row numbered"><div class="code-highlight-line">          <span class="n">error!</span> <span class="s1">'Unauthorized'</span><span class="p">,</span> <span class="mi">401</span> <span class="k">unless</span> <span class="n">env</span><span class="p">[</span><span class="s1">'HTTP_SECRETK'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'a secret key'</span> 
</div></div><div data-line="52" class="code-highlight-row numbered"><div class="code-highlight-line">          <span class="n">players_json</span> <span class="o">=</span> <span class="n">env</span><span class="p">.</span><span class="nf">players_coll</span><span class="p">.</span><span class="nf">find</span><span class="p">(&#x7b;</span><span class="s1">'_id'</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">]&#x7d;)</span>   
</div></div><div data-line="53" class="code-highlight-row numbered"><div class="code-highlight-line">          <span class="n">error!</span> <span class="s1">'Player not found'</span><span class="p">,</span> <span class="mi">404</span> <span class="k">unless</span> <span class="n">players_json</span> <span class="o">!=</span> <span class="p">[]</span>
</div></div><div data-line="54" class="code-highlight-row numbered"><div class="code-highlight-line">          <span class="n">players</span> <span class="o">=</span> <span class="n">players_json</span><span class="p">.</span><span class="nf">map</span> <span class="p">&#x7b;</span><span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="no">Player</span><span class="p">.</span><span class="nf">from_json</span><span class="p">(</span><span class="n">i</span><span class="p">)&#x7d;</span> 
</div></div><div data-line="55" class="code-highlight-row numbered"><div class="code-highlight-line">          <span class="n">players</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">to_json</span> 
</div></div><div data-line="56" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">end</span>    
</div></div><div data-line="57" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="58" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="c1">#...</span>
</div></div><div data-line="59" class="code-highlight-row numbered"><div class="code-highlight-line">   <span class="k">end</span>
</div></div><div data-line="60" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">end</span>                    </div></div></pre></div></figure>

<p>As you can see the Grape framework supports API versioning, and the DSL provides a simple way to define API endpoints by defining resources and then specifying the HTTP requests (get, post, put, delete) for that resource. Any Rails developer should feel comfortable with the paths, params, and routes syntax in Grape.</p>

<p>In this code snippet I show part of the API definition for two resources (missions &amp; players). This will mean the path for accessing these are <em>/missions</em> and <em>/players</em>. Because I specified <em>prefix ‘api’</em> at the top of the file, the actual path becomes <em>/api/missions</em> and <em>/api/players</em>. So for example the <em>get “/:id”</em> would correspond to a get request of /api/players/7E781305-777F-4044-9770-C7995585F540 where the UUID is a player id and would be available in the params[:id] variable.</p>

<p>I should also note that even though these are simple <em>get</em> requests Grape will expect a header to be set for the secret key(secretk), and also require an Accept header with the version, vendor info, and content type (json). The easiest way to test your API will be to use an app like <a href="http://goo.gl/daZ5Q">Postman</a> that makes it easy to formulating requests, setting headers, from your Chrome browser. Postman also allows you to save requests, and re-run them.</p>

<p>I happen to be using Mongo for this, but Grape supports most major DBs. I am only showing two get methods, my full definition supports CRUD for these objects, as well as a few common queries of the db. The error checking of the request is fairly straightforward. I am checking for an API key, but this would be replaced with an API key lookup function to validate the requestor. It is easy to respond with specific errors as you can see.</p>

<p>The terse <em>error!, unless</em> syntax makes the error handling code very readable. The request handling for these two examples are simple: I query a mongo collection for an id, then map that response onto objects, and then convert the objects to json. This looks funny since it is basically json-&gt;object-&gt;json since mongo returns json, but there is more that happens in the object mapping; the json from the db and the json from the object are not the same.</p>

<p>By requiring <em>mission.rb</em> and <em>player.rb</em> at the top of the file, I pull in my Mission and Player classes so they can be used in the map operation.   Try to ignore the lame <em>.first</em> operation, this was a bit of laziness in dealing with what is an array of one item resulting from the map operation. As with all Ruby, the output of the last operation is what is returned in the body of the response.</p>

<p>The DSL is very clean and makes API maintenance relatively easy.</p>

<p>A few other handy links:</p>

<ul>
  <li><a href="https://github.com/postrank-labs/goliath">Grape Project</a></li>
  <li><a href="https://groups.google.com/forum/?fromgroups#!forum/ruby-grape">Grape Forum</a></li>
  <li><a href="https://github.com/flyerhzm/newrelic-grape">NewRelic-Grape Gem Info</a> - NewRelic instrumentation for the Grape API DSL.</li>
  <li><a href="https://github.com/djones/grape-goliath-example">Heroku example</a></li>
  <li><a href="http://www.confreaks.com/videos/475-rubyconf2010-the-grapes-of-rapid">Grape Intro Video</a></li>
</ul>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/ruby/state-machines/development/2013/01/15/simple-state-machine-example.html">Simple state machine example</a></h1>
    
    
      <p class="meta">
        









<time datetime="2013-01-15T12:24:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I have been investigating using the ruby <a href="https://github.com/pluginaweek/state_machine">state_machine</a> gem for a project. State machines can be very handy in simplifying code where objects move through various states. The <a href="https://github.com/pluginaweek/state_machine">state_machine</a> gem embeds state machine behavior into any class that uses it. My first test was to create a simple todo list example.  The todo list will include a main list that contains items and sublists.  This allows a way to organize items easily into sublists.</p>

<p>A simple way to do this is to declare two classes <em>List</em> and <em>Item</em> and allow an object of class <em>List</em> to contain a list of <em>Lists</em> and a list of <em>Items</em>. This approach allows a flat list with many items, or a hierarchical list with top-level items, but also sub-lists that contain their own items.</p>

<p>In addition to lists and items, I want is to track whether I have completed all of the items in a list. In the case of a hierarchical list this means all items of sub-lists as well. Thus in addition to lists and items, we need to track whether items and lists are in progress or completed.</p>

<p>The next step is deciding on the states of the two object types. For my example, I decided:
* a list will have an initial state of <em>available</em>, and will transition to state <em>started</em> when the first item on the list is completed. When all items and sublists are <em>completed</em> the list will move to the state <em>completed</em>.
* an item will have an initial state of <em>available</em> and will transition to <em>completed</em> when the item is finished.</p>

<p>Finally I want to inform the user when:
* an item is completed
* a list is completed
* the project is completed (all items and sublists are completed)</p>

<p>Here is a quick example of the code to meet these requirements:</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">list_example.rb</span><a class="code-highlight-caption-link" href="https://gist.github.com/4549146">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nb">require</span> <span class="s1">'rubygems'</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nb">require</span> <span class="s1">'state_machine'</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">class</span> <span class="nc">Item</span>    
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="kp">attr_accessor</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:description</span> 
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="n">state_machine</span> <span class="ss">:item_state</span><span class="p">,</span> <span class="ss">:initial</span> <span class="o">=&gt;</span> <span class="ss">:available</span> <span class="k">do</span>  
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="n">after_transition</span> <span class="ss">:available</span><span class="o">=&gt;</span> <span class="ss">:completed</span><span class="p">,</span> <span class="ss">:do</span> <span class="o">=&gt;</span> <span class="ss">:item_completed</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="n">event</span> <span class="ss">:finish</span> <span class="k">do</span>
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="n">transition</span> <span class="p">[</span><span class="ss">:available</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="ss">:completed</span>
</div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">end</span> 
</div></div><div data-line="15" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="16" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="n">state</span> <span class="ss">:completed</span> <span class="k">do</span> 
</div></div><div data-line="17" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">end</span>
</div></div><div data-line="18" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="19" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="k">end</span>
</div></div><div data-line="20" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="21" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">item_name</span><span class="p">,</span> <span class="n">item_description</span><span class="p">,</span> <span class="n">parent</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">)</span>
</div></div><div data-line="22" class="code-highlight-row numbered"><div class="code-highlight-line">          <span class="vi">@name</span> <span class="o">=</span> <span class="n">item_name</span> 
</div></div><div data-line="23" class="code-highlight-row numbered"><div class="code-highlight-line">          <span class="vi">@description</span> <span class="o">=</span> <span class="n">item_description</span>  
</div></div><div data-line="24" class="code-highlight-row numbered"><div class="code-highlight-line">          <span class="vi">@parent_list</span> <span class="o">=</span> <span class="n">parent</span>
</div></div><div data-line="25" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="26" class="code-highlight-row numbered"><div class="code-highlight-line">          <span class="k">super</span><span class="p">()</span> <span class="c1"># NOTE: This *must* be called, otherwise states won't get initialized</span>
</div></div><div data-line="27" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="k">end</span>  
</div></div><div data-line="28" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="29" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="k">def</span> <span class="nf">item_completed</span>
</div></div><div data-line="30" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="nb">puts</span> <span class="s2">"finished item </span><span class="si">#&#x7b;</span><span class="nb">self</span><span class="p">.</span><span class="nf">name</span><span class="si">&#x7d;</span><span class="s2">"</span>
</div></div><div data-line="31" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">if</span> <span class="vi">@parent_list</span>
</div></div><div data-line="32" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="vi">@parent_list</span><span class="p">.</span><span class="nf">child_item_completed</span> 
</div></div><div data-line="33" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">end</span>
</div></div><div data-line="34" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="k">end</span>
</div></div><div data-line="35" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="36" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">end</span>
</div></div><div data-line="37" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="38" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">class</span> <span class="nc">List</span>    
</div></div><div data-line="39" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="kp">attr_accessor</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:description</span><span class="p">,</span> <span class="ss">:lists</span><span class="p">,</span> <span class="ss">:items</span> 
</div></div><div data-line="40" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="41" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="n">state_machine</span> <span class="ss">:list_state</span><span class="p">,</span> <span class="ss">:initial</span> <span class="o">=&gt;</span> <span class="ss">:available</span> <span class="k">do</span>  
</div></div><div data-line="42" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="43" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="n">after_transition</span> <span class="ss">:started</span><span class="o">=&gt;</span> <span class="ss">:completed</span><span class="p">,</span> <span class="ss">:do</span> <span class="o">=&gt;</span> <span class="ss">:list_completed</span>
</div></div><div data-line="44" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="45" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="n">event</span> <span class="ss">:start</span> <span class="k">do</span>
</div></div><div data-line="46" class="code-highlight-row numbered"><div class="code-highlight-line">              <span class="n">transition</span> <span class="p">[</span><span class="ss">:available</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="ss">:started</span>
</div></div><div data-line="47" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">end</span>
</div></div><div data-line="48" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="49" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="n">event</span> <span class="ss">:finish</span> <span class="k">do</span>
</div></div><div data-line="50" class="code-highlight-row numbered"><div class="code-highlight-line">              <span class="n">transition</span> <span class="p">[</span><span class="ss">:started</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="ss">:completed</span>
</div></div><div data-line="51" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">end</span> 
</div></div><div data-line="52" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="53" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="n">state</span> <span class="ss">:started</span> <span class="k">do</span> 
</div></div><div data-line="54" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="c1"># take any actions related to moving to started state.</span>
</div></div><div data-line="55" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">end</span> 
</div></div><div data-line="56" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="57" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="n">state</span> <span class="ss">:completed</span> <span class="k">do</span> 
</div></div><div data-line="58" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="c1"># take any actions related to moving to completed state.</span>
</div></div><div data-line="59" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">end</span>
</div></div><div data-line="60" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="61" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="k">end</span>
</div></div><div data-line="62" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="63" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">list_name</span><span class="p">,</span> <span class="n">list_description</span><span class="p">,</span> <span class="n">parent</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">)</span>  
</div></div><div data-line="64" class="code-highlight-row numbered"><div class="code-highlight-line">          <span class="vi">@name</span> <span class="o">=</span> <span class="n">list_name</span> 
</div></div><div data-line="65" class="code-highlight-row numbered"><div class="code-highlight-line">          <span class="vi">@description</span> <span class="o">=</span> <span class="n">list_description</span> 
</div></div><div data-line="66" class="code-highlight-row numbered"><div class="code-highlight-line">          <span class="vi">@lists</span> <span class="o">=</span> <span class="p">[]</span> 
</div></div><div data-line="67" class="code-highlight-row numbered"><div class="code-highlight-line">          <span class="vi">@items</span> <span class="o">=</span> <span class="p">[]</span>
</div></div><div data-line="68" class="code-highlight-row numbered"><div class="code-highlight-line">          <span class="vi">@parent</span> <span class="o">=</span> <span class="n">parent</span>
</div></div><div data-line="69" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="70" class="code-highlight-row numbered"><div class="code-highlight-line">          <span class="k">super</span><span class="p">()</span> <span class="c1"># NOTE: This *must* be called, otherwise states won't get initialized</span>
</div></div><div data-line="71" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="k">end</span>  
</div></div><div data-line="72" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="73" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="k">def</span> <span class="nf">add_list</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span> 
</div></div><div data-line="74" class="code-highlight-row numbered"><div class="code-highlight-line">             <span class="vi">@lists</span> <span class="o">&lt;&lt;</span> <span class="no">List</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="nb">self</span><span class="p">)</span>
</div></div><div data-line="75" class="code-highlight-row numbered"><div class="code-highlight-line">             <span class="vi">@lists</span><span class="p">.</span><span class="nf">last</span>
</div></div><div data-line="76" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="k">end</span>
</div></div><div data-line="77" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="78" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="k">def</span> <span class="nf">add_item</span> <span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
</div></div><div data-line="79" class="code-highlight-row numbered"><div class="code-highlight-line">             <span class="vi">@items</span> <span class="o">&lt;&lt;</span> <span class="no">Item</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="nb">self</span><span class="p">)</span>
</div></div><div data-line="80" class="code-highlight-row numbered"><div class="code-highlight-line">             <span class="vi">@items</span><span class="p">.</span><span class="nf">last</span>
</div></div><div data-line="81" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="k">end</span>
</div></div><div data-line="82" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="83" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="c1"># Called by child item when item is completed. Allows check for </span>
</div></div><div data-line="84" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="c1"># all items completed. </span>
</div></div><div data-line="85" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="k">def</span> <span class="nf">child_item_completed</span>
</div></div><div data-line="86" class="code-highlight-row numbered"><div class="code-highlight-line">          <span class="c1"># once the first item is completed consider this list started</span>
</div></div><div data-line="87" class="code-highlight-row numbered"><div class="code-highlight-line">          <span class="k">if</span> <span class="nb">self</span><span class="p">.</span><span class="nf">list_state</span> <span class="o">==</span> <span class="s2">"available"</span>
</div></div><div data-line="88" class="code-highlight-row numbered"><div class="code-highlight-line">             <span class="nb">self</span><span class="p">.</span><span class="nf">fire_events</span><span class="p">(</span><span class="ss">:start</span><span class="p">)</span>
</div></div><div data-line="89" class="code-highlight-row numbered"><div class="code-highlight-line">          <span class="k">end</span>
</div></div><div data-line="90" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="91" class="code-highlight-row numbered"><div class="code-highlight-line">          <span class="c1"># if all items are completed move this list to completed state. </span>
</div></div><div data-line="92" class="code-highlight-row numbered"><div class="code-highlight-line">          <span class="k">if</span> <span class="nb">self</span><span class="p">.</span><span class="nf">items</span><span class="p">.</span><span class="nf">select</span><span class="p">&#x7b;</span><span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="n">i</span><span class="p">.</span><span class="nf">item_state</span> <span class="o">!=</span> <span class="s2">"completed"</span><span class="p">&#x7d;.</span><span class="nf">empty?</span>
</div></div><div data-line="93" class="code-highlight-row numbered"><div class="code-highlight-line">             <span class="nb">self</span><span class="p">.</span><span class="nf">fire_events</span><span class="p">(</span><span class="ss">:finish</span><span class="p">)</span> 
</div></div><div data-line="94" class="code-highlight-row numbered"><div class="code-highlight-line">          <span class="k">end</span>           
</div></div><div data-line="95" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="k">end</span>
</div></div><div data-line="96" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="97" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="98" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="k">def</span> <span class="nf">child_list_completed</span>
</div></div><div data-line="99" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="c1"># if this is a sublist let parent know this list is completed.</span>
</div></div><div data-line="100" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="c1"># else this is top level list and everything is completed.</span>
</div></div><div data-line="101" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="k">if</span> <span class="nb">self</span><span class="p">.</span><span class="nf">items</span><span class="p">.</span><span class="nf">select</span><span class="p">&#x7b;</span><span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="n">i</span><span class="p">.</span><span class="nf">item_state</span> <span class="o">!=</span> <span class="s2">"completed"</span><span class="p">&#x7d;.</span><span class="nf">empty?</span>
</div></div><div data-line="102" class="code-highlight-row numbered"><div class="code-highlight-line">                <span class="k">if</span> <span class="nb">self</span><span class="p">.</span><span class="nf">lists</span><span class="p">.</span><span class="nf">select</span><span class="p">&#x7b;</span><span class="o">|</span><span class="n">l</span><span class="o">|</span> <span class="n">l</span><span class="p">.</span><span class="nf">list_state</span> <span class="o">!=</span> <span class="s2">"completed"</span><span class="p">&#x7d;.</span><span class="nf">empty?</span>
</div></div><div data-line="103" class="code-highlight-row numbered"><div class="code-highlight-line">                     <span class="nb">self</span><span class="p">.</span><span class="nf">fire_events</span><span class="p">(</span><span class="ss">:finish</span><span class="p">)</span> 
</div></div><div data-line="104" class="code-highlight-row numbered"><div class="code-highlight-line">                <span class="k">end</span>
</div></div><div data-line="105" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="k">end</span>
</div></div><div data-line="106" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="k">end</span>
</div></div><div data-line="107" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="108" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="k">def</span> <span class="nf">list_completed</span> 
</div></div><div data-line="109" class="code-highlight-row numbered"><div class="code-highlight-line">          <span class="k">if</span> <span class="vi">@parent</span> 
</div></div><div data-line="110" class="code-highlight-row numbered"><div class="code-highlight-line">              <span class="nb">puts</span> <span class="s2">"congrats on completing list </span><span class="si">#&#x7b;</span><span class="nb">self</span><span class="p">.</span><span class="nf">name</span><span class="si">&#x7d;</span><span class="s2">"</span>  
</div></div><div data-line="111" class="code-highlight-row numbered"><div class="code-highlight-line">              <span class="vi">@parent</span><span class="p">.</span><span class="nf">child_list_completed</span> 
</div></div><div data-line="112" class="code-highlight-row numbered"><div class="code-highlight-line">          <span class="k">else</span> 
</div></div><div data-line="113" class="code-highlight-row numbered"><div class="code-highlight-line">             <span class="nb">puts</span> <span class="s2">"congrats on completing project </span><span class="si">#&#x7b;</span><span class="nb">self</span><span class="p">.</span><span class="nf">name</span><span class="si">&#x7d;</span><span class="s2">"</span> 
</div></div><div data-line="114" class="code-highlight-row numbered"><div class="code-highlight-line">          <span class="k">end</span>
</div></div><div data-line="115" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="k">end</span>
</div></div><div data-line="116" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="117" class="code-highlight-row numbered"><div class="code-highlight-line"> <span class="k">end</span></div></div></pre></div></figure>

<p>As you can see there is a rich environment for embedding behavior, including adding it in the <em>state</em> definitions, adding it using the <em>before_transition</em> method, and adding it using the <em>after_transition</em> method. You can also define methods inside the state definition so you can extend the functionality of a state.</p>

<p>Now if you load this example in IRB you can play with the lists and items like so:</p>

<div class="highlighter-rouge"><pre class="highlight"><code> load "list_example.rb"
 list = List.new("Groceries", "Get some groceries")
 wf = list.add_list("Whole Foods", "Get some groceries from Whole Foods")
 milk = list.add_item("Milk", "2% Milk")
 strawberries = wf.add_item("Strawberries", "Ripe organic Strawberries"))
 oranges = wf.add_item("Oranges", "Ripe mandarine oranges")

 strawberries.finish 
 =&amp;gt; finished item Strawberries

 oranges.finish  
 =&amp;gt; finished item Oranges
 =&amp;gt; congrats on completing list Whole Foods

 milk.finish
 =&amp;gt; finished item Milk
 =&amp;gt; congrats on completing project Groceries
</code></pre>
</div>

<p>This was a really simple example, but shows how easy it is to create classes that embed state machines. For more check out the <a href="https://github.com/pluginaweek/state_machine">state_machine</a> gem.</p>

<h3 id="state-diagrams">State Diagrams</h3>

<p>The library also allows you to generate graphs of the states and transitions in each class. For example:</p>

<p>create a Rakefile.rb</p>

<div class="highlighter-rouge"><pre class="highlight"><code> require 'tasks/state_machine'
 require './list_example.rb
</code></pre>
</div>

<p>Then in terminal execute:</p>

<div class="highlighter-rouge"><pre class="highlight"><code> rake state_machine:draw CLASS=List 
</code></pre>
</div>

<p>For the <em>List</em> class shown above this will generate a png file named <em>List_list_state.png</em> that looks like the image below.</p>

<p><img src="http://media.tumblr.com/d78e332b4656b62dec36c2a2d2408a82/tumblr_inline_mgqav0Q8uW1qz562v.png" alt="" /></p>

<p>The <em>List</em> class is very simple so the diagram is also simple. In the case of my project there are many states and more complicated transitions between states so the diagram can be very handy to visualize what is happening when  debugging a strange transition,</p>

<h3 id="wrapup">Wrapup</h3>

<p>This todo list example is very simple but it allows exploring the basic features of the <a href="https://github.com/pluginaweek/state_machine">state_machine</a> gem, and demonstrates how simple it is to add state machine functionality to classes.  If a class you are designing has variables that keep state, and you are triggering behaviors when those variables change, then a state machine will likely be a more clean approach to organizing behavior in your class.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/opinion/development/2013/01/14/refactoring-making-master-programmers.html">Refactoring: making master programmers</a></h1>
    
    
      <p class="meta">
        









<time datetime="2013-01-14T16:34:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>There is often a tension between product management and engineering when it comes to time spent adding new features vs. time spent in code refactoring.  One could even explain this in terms of top line vs bottom line descriptions. Features mean sales, codebase is an asset, and poor code quality is a liability that affects cost and thus profit. Sloppy, risky, or fragile code is even called “technical debt” in many circles. This tension between features and code quality has always been a tightrope walk for any successful software or Internet company. Starve features and you kill sales, ignore expanding bloat and you will never win a sprint, let alone the marathon of staying relevant.</p>

<p>But there is a lot more to refactoring than code quality. In this post I wanted to mention one that is often overlooked: <em>“refactoring makes good coders into master coders.”</em>  The best lessons come from revisiting your mistakes and improving them, but without refactoring the revisiting is limited to quick fixes to limit the impact of a bad architecture, design, or implementation. Yes we can learn from our mistakes by trying different approaches on future projects, but the problems are ever changing, and thus the learnings are not as clear. I have always found I learned so much more as a designer and a developer by revisiting a problem with a new level of experience to draw from.</p>

<p>Design has been more fortunate regarding the opportunity for refactoring; good design organizations understand how much can be learned by refactoring a design and thus fight hard to allow for it. Development has often not been as successful in making the case. I wonder if the cost analysis could be changed if executives understood that refactoring actually significantly improved two of the most important assets at a software company: the code base and the engineering talent. Then it becomes a more interesting decision versus a simple weighing of new features vs improved quality.</p>

<p><img src="http://media.tumblr.com/7095223771e3c38939367f18458726e1/tumblr_inline_mgmwbwyolq1qz562v.jpg" alt="image" />Bull</p>

<p>I got to thinking about this looking at Picasso’s Bull series.  This is an excellent example of a master working through a problem to develop the most elegantly simplified expression of the subject. To become a master, one must work through a problem incrementally and always looking for elegant ways to improve, to simplify the end expression of the solution. Even for a competent coder, it is not always apparent what is elegant without seeing the real life consequences of chosen approaches. Whether the approach makes the code fragile, bloated, or unfriendly, it is only through the experience of trying to grow a code base that these issues can be truly understood. Under the right conditions refactoring provides a sort of express lane  to becoming a master developer. This is very difficult if you are never allowed to truly revisit a subject after completing the first expression of the solution. I like the “Bull” example because it is how I think of elegant design and development, just enough to represent the solution and no more, anything else is bloat that will be nothing but cost later. Through refactoring, a developer can develop insights, skills, and techniques more quickly by addressing a well understood problem from a more experienced perspective.  Practice make perfect. If not the code, maybe the coder.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/hacks/tips/2013/01/13/alfred-plus-pinboard-plus-chrome.html">Alfred + Pinboard + Chrome</a></h1>
    
    
      <p class="meta">
        









<time datetime="2013-01-13T12:29:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>If you happen to use <a href="http://www.alfredapp.com/">Alfred</a>, <a href="http://pinboard.in">Pinboard</a>, and Chrome, here is a nice extension to save the current browser page to Pinboard using Alfred. Much faster than any chrome extension, and fingers never leave the keyboard.</p>

<p><a href="http://www.timbueno.com/2012/06/27/pinboard-plus-alfred">Tim Bueno’s Pinboard Extension</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/hacks/tips/2013/01/08/toggle-bluetooth.html">Toggle Bluetooth</a></h1>
    
    
      <p class="meta">
        









<time datetime="2013-01-08T12:10:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In my home office I have a Bluetooth keyboard and trackpad. When I use my MacBook Air elsewhere in the house I constantly see connect and disconnect messages for these devices. Frequently toggling BT on/off can be a pain; the menu bar method for toggling BT requires scanning the menu bar for the BT glyph, clicking on it, finding the correct menu item and clicking on it. All that scanning, tracking, and clicking can be disruptive to a good mental flow; I wanted a quick keyboard shortcut to toggle bluetoooth on/off. I use <a href="http://www.alfredapp.com/">Alfred</a> and after a quick search I found <a href="http://seapy.com/1779">this</a> extension that does just that. I use “bt” as the shortcut code. I have found this to be very handy, I now toggle out of habit, so no thinking required;</p>

<ul>
  <li><a href="http://www.alfredapp.com/">Alfred App</a></li>
  <li><a href="http://seapy.com/1779">Alfred Toggle Bluetooth Extension</a></li>
</ul>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/tips/development/2013/01/08/syntax-highlighting-in-os-x-quick-look.html">Syntax Highlighting in OS X quick look</a></h1>
    
    
      <p class="meta">
        









<time datetime="2013-01-08T11:15:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Quick Look is a handy OS X feature where you can get a quick look at a file by selecting it and pressing the space bar. This is handy when looking through snippet files on disk.  <a href="http://goo.gl/KLW5t">This plugin</a> adds syntax highlighting in Quick Look supporting many common programming languages, and even supports R code.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/tips/2013/01/05/getting-a-quick-definition.html">Getting a quick definition</a></h1>
    
    
      <p class="meta">
        









<time datetime="2013-01-05T11:10:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I am a logophile, and regularly looking up the meanings of words I encounter on the web or in pdf documents. More recent OS X versions include a great feature that allows you to get a quick definition in almost any app (browser, editor, etc). Highlight a word and press <em>ctrl-command-d</em> to get the definition of the word. It is easy to configure to include Wikipedia definitions so you can also look up people and concepts.</p>

<p>To customize which dictionaries are used (including wikipedia entries) open spotlight (command-space), type dictionary and press return to open the dictionary app. Open the preferences menu and tick the checkbox for the sources you wish to use. Once you make pressing <em>ctrl-command-d</em> a habit you will find using it is very natural, and requires little thought to remember it.</p>

<p>Make sure you have wikipedia configured and then try it on these:</p>

<ul>
  <li>crepuscule</li>
  <li>quiescent</li>
  <li>Malta</li>
  <li>Thomas Bayes</li>
  <li>Markov chain</li>
</ul>

<p>The pop-up definition is interactive so click on a definition to see the full definition entry then use the back arrow to get back to the list of definitions. You can also click on the source title to open the dictionary app with that entry.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/books/2013/01/01/how-to-measure-anything.html">How to measure anything</a></h1>
    
    
      <p class="meta">
        









<time datetime="2013-01-01T11:04:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Over the past year I have had the opportunity to advise a number of people I have worked with in the past who are starting companies. In the past few years my role had been that of a director of both design and R&amp;D teams and so I enjoy continuing that type of role in providing direction to these exciting new startup ventures.</p>

<p>One thing  many of these early phase projects lack is clarity and proper measurement of the problem and opportunity; having only a vague sense of their relative probability of success given their chosen direction versus alternative approaches.</p>

<p>Lately a lot of new startups tend to point to some fuzzy “user experience” as their advantage, and why they will succeed. As a design director I know that this is B.S. and even design and user experience contributions can be measured to a reasonable degree of confidence.</p>

<p>More times than I care to say, I have pointed teams to read and practice the techniques in <em>“How to Measure Anything: Finding the Value of Intangibles in Business”</em> by Douglas Hubbard.</p>

<p>The first response is always, “Read a book, are you serious” — yes I am serious, this is a good book and for many people it provides some very important tools for success around estimation and prediction. If you learn and use this on your project it will become automatic for you, and require little thought. It just takes practice.</p>

<p>Here are just a few key excerpts to motivate you to read it:</p>

<p><em>There are three reasons why people think things can’t be measured, all are misconceptions about different aspects of measurement: Concept, Object, and Method.</em></p>

<ol>
  <li>Concept of Measurement. The definition of measurement itself is widely misunderstood. If one understands what measurement means, a lot more things become possible.</li>
  <li>Object of measurement. The thing being measured is not well defined. Sloppy and ambiguous language gets in the way of measurement.</li>
  <li>Methods of measurement. Many procedures of empirical observation are not well known. If people were familiar with some of the basic methods, it would become apparent that many things thought to be immeasurable are not only measurable but may already have been measured.</li>
</ol>

<p>Hubbard does a good job of making it clear that these three misconceptions are easily overcome, and you can learn to measure anything quickly. More importantly perhaps, you will end up with a better defined question or problem through the process of identifying measures.</p>

<p>He uses a definition of measurement based on uncertainty  that is very powerful, echoing Shannon’s information theory of entropy:</p>

<blockquote>
  <p>Measurement is a quantitatively expressed reduction of uncertainty based on one or more observations.</p>
</blockquote>

<p>By framing measurement as “uncertainty reduction,” Hubbard has solved the problem for many people who get stuck thinking of measurement as an impossibly exact science. For as Hubbard points out, even inexact measurement is valuable if it reduces uncertainty by some non-trivial amount. This is especially true when investment in the project is high.</p>

<p>He spends several chapters on techniques for determining what to measure and how, and then get’s into what I found to be a great exercise for teams.  It involves calibration of estimation for team members. By evaluating how calibrated people are at estimation (usually not!) we can get the team to understand they they need to improve, and more importantly with the right tools they can learn to be quite proficient at estimation. Having this skill will help them in many ways in their day-to-day work.</p>

<p>Hubbard  discusses the terrible misunderstanding and misuse of risk management in business and R&amp;D projects. <em>You know, those useless Low/Med/High values people put on their slides!</em> He instead prescribes the use of basic confidence intervals and shows the reader how to use them.</p>

<p><strong>A simple example is his test of confidence.</strong></p>

<p>For a given question you provide a range you believe has a 90% CI. For example you say with 90% confidence the module will take you 2-3 days to code, unit test, and submit to system test. Or the wireframe will take you 3-6 hours to update, get reviewed, and hand to engineering.</p>

<p>Then ask yourself this: Suppose I offered you a chance to win $1000 in one of two ways:</p>

<ol>
  <li>You win $1,000 if you your estimation turns out to be correct. If not, you win nothing.</li>
  <li>You spin a dial divided into two unequal “pie slices,” one comprising 90% of the dial and the other just 10%. If the dial lands on the large slice, you win $1,000. If it lands on the small slice, you win nothing (i.e., there is a 90% chance you win $1,000).</li>
</ol>

<p>About 80% of people choose option 2, but why would this be if their estimate is of 90% CI or higher. In reality they probably are more like 50%-80% confident. For those who choose option 1, it could also mean they are over 90% confidence but being conservative in estimating, this can be equally undesirable.</p>

<p>This is the <strong>Equivalent Bet Test</strong>. You should try to set up a mental test like this when assessing confidence and if you pick the wheel then keep lowering the win percentage on the wheel (80%, 70%, 60%, …) until you don’t pick the wheel, that will tell you your real confidence in the answer. Research shows turning it into a bet (real or pretend) increases the quality of the estimates.</p>

<p>People who are very good at assessing their uncertainty (i.e. they are right 80% of the time they say they are 80% confident, etc.) are called calibrated. <em>It is good to be calibrated, projects and life become more predictable.</em></p>

<p>This was just a short teaser of a simple technique, but there are more techniques. I highly recommend Hubbard’s book for anyone involved in complex  endeavors whether on their own or in teams. You will find problems are more clearly articulated once you have  figured out how to measure it; having good calibration in estimation will also significantly reduce your project risk and improve your decision making significantly.</p>

<p>There was a recent question on Quora: <a href="http://www.quora.com/Engineering-Management/Why-are-software-development-task-estimations-regularly-off-by-a-factor-of-2-3">Why are software development task estimations regularly off by a factor of 2-3?</a> That I believe is true because of teams not doing proper analysis, but also it is a multiplier effect of bad estimation across a team. Because of interdependencies of teams these estimation errors can cause huge estimation errors when rolled together.
Get the book: <a href="http://www.amazon.com/How-Measure-Anything-Intangibles-ebook/dp/B003GWX8YO/">How to Measure Anything: Finding the Value of Intangibles in Business</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/hacks/design/2013/01/01/user-stories-and-activity-diagrams.html">User Stories and Activity Diagrams</a></h1>
    
    
      <p class="meta">
        









<time datetime="2013-01-01T10:10:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I have been using Omnigraffle to create activity diagrams associated with user stories. Some people may find this overkill but I find doing these diagrams makes transitions clear that might otherwise be missed until later when they lead to costly re-architecting of the screens and flows.</p>

<p>I use Omnigraffle for UI wireframes, so it seemed natural to use it for activity diagrams, which is what I have been doing.  The issue is keeping the diagrams up to date.  Today, while playing with the <a href="http://www.complang.org/ragel/">Ragel</a> state machine compiler I discovered Ragel’s awesome states/transitions diagramming feature. I learned the feature uses <a href="http://www.graphviz.org/">Graphviz</a> to create the diagrams from the parser grammar.  This led me to <a href="https://github.com/glejeune/Ruby-Graphviz/">Ruby Graphviz</a>, a Ruby library for interacting with Graphviz. It got me thinking that maybe there was a simple DSL that could be used to describe UI activities and screens and then automatically generate diagrams from the description. This would make keeping descriptions and diagrams in sync very easy.</p>

<p>My first step is always to get a piece of the most basic idea working, then add another piece, etc until a basic prototype is complete. Given this approach the first step was to use ruby-graphviz to create a basic diagram similar to one of our activity diagrams (a very basic one). So here was a quick pass experiment for using ruby-graphvis to create a diagram. The next step would be to define a basic DSL and then write a parser and state-machine and incorporate the graph creation into the state machine as it parses the DSL activity description.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">simple_graphviz_example.rb</span><a class="code-highlight-caption-link" href="https://gist.github.com/4431708">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nb">require</span> <span class="s1">'graphviz'</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1"># Create a new graph</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span> <span class="o">=</span> <span class="no">GraphViz</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span> <span class="ss">:G</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:digraph</span> <span class="p">)</span> 
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">us_num</span> <span class="o">=</span> <span class="mi">47</span>  <span class="c1">#placeholder, will get from file name in final version.  </span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1"># set global node options</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span><span class="p">.</span><span class="nf">node</span><span class="p">[</span><span class="ss">:color</span><span class="p">]</span>    <span class="o">=</span> <span class="s2">"#333333"</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span><span class="p">.</span><span class="nf">node</span><span class="p">[</span><span class="ss">:style</span><span class="p">]</span>    <span class="o">=</span> <span class="s2">"filled"</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span><span class="p">.</span><span class="nf">node</span><span class="p">[</span><span class="ss">:shape</span><span class="p">]</span>    <span class="o">=</span> <span class="s2">"box"</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span><span class="p">.</span><span class="nf">node</span><span class="p">[</span><span class="ss">:penwidth</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"1"</span>
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span><span class="p">.</span><span class="nf">node</span><span class="p">[</span><span class="ss">:fontname</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Trebuchet MS"</span>
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span><span class="p">.</span><span class="nf">node</span><span class="p">[</span><span class="ss">:fontsize</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"8"</span>
</div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span><span class="p">.</span><span class="nf">node</span><span class="p">[</span><span class="ss">:fillcolor</span><span class="p">]</span><span class="o">=</span> <span class="s2">"#294b76"</span>
</div></div><div data-line="15" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span><span class="p">.</span><span class="nf">node</span><span class="p">[</span><span class="ss">:fontcolor</span><span class="p">]</span><span class="o">=</span> <span class="s2">"white"</span>
</div></div><div data-line="16" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span><span class="p">.</span><span class="nf">node</span><span class="p">[</span><span class="ss">:margin</span><span class="p">]</span>   <span class="o">=</span> <span class="s2">"0.0"</span>
</div></div><div data-line="17" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="18" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1"># set global edge options</span>
</div></div><div data-line="19" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span><span class="p">.</span><span class="nf">edge</span><span class="p">[</span><span class="ss">:color</span><span class="p">]</span>    <span class="o">=</span> <span class="s2">"#666666"</span>
</div></div><div data-line="20" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span><span class="p">.</span><span class="nf">edge</span><span class="p">[</span><span class="ss">:weight</span><span class="p">]</span>   <span class="o">=</span> <span class="s2">"1"</span>
</div></div><div data-line="21" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span><span class="p">.</span><span class="nf">edge</span><span class="p">[</span><span class="ss">:fontsize</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"6"</span>
</div></div><div data-line="22" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span><span class="p">.</span><span class="nf">edge</span><span class="p">[</span><span class="ss">:fontcolor</span><span class="p">]</span><span class="o">=</span> <span class="s2">"#444444"</span>
</div></div><div data-line="23" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span><span class="p">.</span><span class="nf">edge</span><span class="p">[</span><span class="ss">:fontname</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Verdana"</span>
</div></div><div data-line="24" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span><span class="p">.</span><span class="nf">edge</span><span class="p">[</span><span class="ss">:dir</span><span class="p">]</span>      <span class="o">=</span> <span class="s2">"forward"</span> 
</div></div><div data-line="25" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span><span class="p">.</span><span class="nf">edge</span><span class="p">[</span><span class="ss">:arrowhead</span><span class="p">]</span><span class="o">=</span><span class="s2">"open"</span>
</div></div><div data-line="26" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span><span class="p">.</span><span class="nf">edge</span><span class="p">[</span><span class="ss">:arrowsize</span><span class="p">]</span><span class="o">=</span> <span class="s2">"0.5"</span>
</div></div><div data-line="27" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="28" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">my_nodes</span><span class="o">=</span><span class="p">&#x7b;</span><span class="s2">"WF1"</span><span class="o">=&gt;</span><span class="s2">"New Account Screen"</span><span class="p">,</span> <span class="s2">"WF2"</span> <span class="o">=&gt;</span><span class="s2">"Account Recover Screen"</span><span class="p">,</span> <span class="s2">"WF3"</span> <span class="o">=&gt;</span> <span class="s2">"Welcome Screen"</span><span class="p">&#x7d;</span>
</div></div><div data-line="29" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">my_decisions</span><span class="o">=</span><span class="p">&#x7b;</span><span class="s2">"D1"</span><span class="o">=&gt;</span><span class="s2">""</span><span class="p">,</span> <span class="s2">"D2"</span> <span class="o">=&gt;</span><span class="s2">""</span><span class="p">,</span> <span class="s2">"D3"</span> <span class="o">=&gt;</span> <span class="s2">""</span><span class="p">,</span> <span class="s2">"D4"</span> <span class="o">=&gt;</span> <span class="s2">""</span><span class="p">&#x7d;</span>
</div></div><div data-line="30" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="31" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span><span class="p">.</span><span class="nf">add_nodes</span><span class="p">(</span><span class="s2">"Start"</span><span class="p">,&#x7b;</span><span class="ss">:label</span> <span class="o">=&gt;</span> <span class="s2">""</span><span class="p">,</span> <span class="ss">:shape</span> <span class="o">=&gt;</span> <span class="s2">"circle"</span><span class="p">&#x7d;)</span> 
</div></div><div data-line="32" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="33" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">my_nodes</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>   
</div></div><div data-line="34" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="c1"># When adding a node the node name becomes the label so can access later.</span>
</div></div><div data-line="35" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="n">g</span><span class="p">.</span><span class="nf">add_nodes</span><span class="p">(</span><span class="n">key</span><span class="p">,&#x7b;</span><span class="ss">:label</span> <span class="o">=&gt;</span> <span class="n">value</span><span class="p">&#x7d;)</span>
</div></div><div data-line="36" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">end</span> 
</div></div><div data-line="37" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="38" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">my_decisions</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>   
</div></div><div data-line="39" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="c1"># When adding a node the node name becomes the label so can access later.</span>
</div></div><div data-line="40" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="n">g</span><span class="p">.</span><span class="nf">add_nodes</span><span class="p">(</span><span class="n">key</span><span class="p">,&#x7b;</span><span class="ss">:label</span> <span class="o">=&gt;</span> <span class="n">value</span><span class="p">,</span> <span class="ss">:shape</span> <span class="o">=&gt;</span> <span class="s2">"diamond"</span><span class="p">&#x7d;)</span>
</div></div><div data-line="41" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">end</span>         
</div></div><div data-line="42" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="43" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span><span class="p">.</span><span class="nf">add_nodes</span><span class="p">(</span><span class="s2">"End"</span><span class="p">,&#x7b;</span><span class="ss">:label</span> <span class="o">=&gt;</span> <span class="s2">""</span><span class="p">,</span> <span class="ss">:shape</span> <span class="o">=&gt;</span> <span class="s2">"circle"</span><span class="p">&#x7d;)</span> 
</div></div><div data-line="44" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">#hello = g.add_nodes( "Hello" )</span>
</div></div><div data-line="45" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">#world = g.add_nodes( "World" )</span>
</div></div><div data-line="46" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nb">puts</span> <span class="n">g</span><span class="p">.</span><span class="nf">inspect</span>
</div></div><div data-line="47" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="48" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1"># Create an edge between the two nodes  </span>
</div></div><div data-line="49" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span><span class="p">.</span><span class="nf">add_edges</span><span class="p">(</span> <span class="n">g</span><span class="o">.</span><span class="no">Start</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="no">D1</span><span class="p">)</span>  
</div></div><div data-line="50" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span><span class="p">.</span><span class="nf">add_edges</span><span class="p">(</span> <span class="n">g</span><span class="o">.</span><span class="no">D1</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="no">WF1</span><span class="p">,</span> <span class="p">&#x7b;</span><span class="ss">:label</span> <span class="o">=&gt;</span> <span class="s2">"[create account]"</span><span class="p">&#x7d;)</span> 
</div></div><div data-line="51" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span><span class="p">.</span><span class="nf">add_edges</span><span class="p">(</span> <span class="n">g</span><span class="o">.</span><span class="no">D1</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="no">WF2</span><span class="p">,</span> <span class="p">&#x7b;</span><span class="ss">:label</span> <span class="o">=&gt;</span> <span class="s2">"[attach account]"</span><span class="p">&#x7d;)</span> 
</div></div><div data-line="52" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span><span class="p">.</span><span class="nf">add_edges</span><span class="p">(</span> <span class="n">g</span><span class="o">.</span><span class="no">WF1</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="no">D2</span><span class="p">)</span> 
</div></div><div data-line="53" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span><span class="p">.</span><span class="nf">add_edges</span><span class="p">(</span> <span class="n">g</span><span class="o">.</span><span class="no">D2</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="no">D3</span><span class="p">,</span> <span class="p">&#x7b;</span><span class="ss">:label</span> <span class="o">=&gt;</span> <span class="s2">"[failure]"</span><span class="p">&#x7d;)</span>   
</div></div><div data-line="54" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span><span class="p">.</span><span class="nf">add_edges</span><span class="p">(</span> <span class="n">g</span><span class="o">.</span><span class="no">D2</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="no">WF3</span><span class="p">,</span> <span class="p">&#x7b;</span><span class="ss">:label</span> <span class="o">=&gt;</span> <span class="s2">"[account created]"</span><span class="p">&#x7d;)</span> 
</div></div><div data-line="55" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span><span class="p">.</span><span class="nf">add_edges</span><span class="p">(</span> <span class="n">g</span><span class="o">.</span><span class="no">D3</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="no">WF2</span><span class="p">,</span> <span class="p">&#x7b;</span><span class="ss">:label</span> <span class="o">=&gt;</span> <span class="s2">"[account exists]"</span><span class="p">&#x7d;)</span> 
</div></div><div data-line="56" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span><span class="p">.</span><span class="nf">add_edges</span><span class="p">(</span> <span class="n">g</span><span class="o">.</span><span class="no">WF2</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="no">D4</span><span class="p">)</span> 
</div></div><div data-line="57" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span><span class="p">.</span><span class="nf">add_edges</span><span class="p">(</span> <span class="n">g</span><span class="o">.</span><span class="no">D4</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="no">WF2</span><span class="p">,</span> <span class="p">&#x7b;</span><span class="ss">:label</span> <span class="o">=&gt;</span> <span class="s2">"[failure]"</span><span class="p">&#x7d;)</span>
</div></div><div data-line="58" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span><span class="p">.</span><span class="nf">add_edges</span><span class="p">(</span> <span class="n">g</span><span class="o">.</span><span class="no">D4</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="no">End</span><span class="p">,</span> <span class="p">&#x7b;</span><span class="ss">:label</span> <span class="o">=&gt;</span> <span class="s2">"[recovered]"</span><span class="p">&#x7d;)</span> 
</div></div><div data-line="59" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span><span class="p">.</span><span class="nf">add_edges</span><span class="p">(</span> <span class="n">g</span><span class="o">.</span><span class="no">WF3</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="no">End</span><span class="p">)</span>  
</div></div><div data-line="60" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1"># Generate output image</span>
</div></div><div data-line="61" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">g</span><span class="p">.</span><span class="nf">output</span><span class="p">(</span> <span class="ss">:png</span> <span class="o">=&gt;</span> <span class="s2">"US</span><span class="si">#&#x7b;</span><span class="n">us_num</span><span class="si">&#x7d;</span><span class="s2">.png"</span> <span class="p">)</span></div></div></pre></div></figure>

<p>This above very simple example creates the diagram below.</p>

<p><img src="http://media.tumblr.com/61f780009a654f9724bcd4a9c703d9b4/tumblr_inline_mfz8syDgFP1qz562v.png" alt="" /></p>

<p>This needs some cleanup of the aesthetics but the possibility is interesting. The next steps will be to come up with a very simple dsl, as simple as possible, maybe something that is markdown compliant so it fits inside our wiki pages cleanly. It would need to cover start and end states as well as intermediate state nodes. It would need to also handle decision points (diamonds) as well as transitions (edges) and notes. The simplest form would be to allow listing all nodes and all decisions, and then listing the connections between them. Labels would also be needed on all of these. IDs would probably help for wiring up the connections.</p>

<p>Then it is a matter of running a parser on the wiki pages, looking for the syntax associated with the activity descriptions and generating a diagram using some ruby code. This might be a nice experiment to familiarize myself with Ragel to better understand its strengths and capabilities.</p>

<p>I hope to get to spend some free time on this over the coming weeks, as it seems like a fun side project.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/hacks/productivity/2012/12/30/remapping-my-caps-lock-key.html">Remapping My Caps Lock Key</a></h1>
    
    
      <p class="meta">
        









<time datetime="2012-12-30T16:24:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I’ve had my caps lock key mapped to the control key for the last few months as I have migrated back to Emacs from TextMate. It was a slight improvement over the placement of the control key but not a huge improvement. I came across this article: <a href="http://brettterpstra.com/a-useful-caps-lock-key/">A Useful CAPS-Lock Key</a> from Brett Terpstra and decided to give his mapping a try. This mapping requires free third party software, but I was particularly intrigued not by the escape key mapping, which is very handy, but by the “Hyper-key” (ctrl-shift-cmd-opt) being mapped to holding down the shift key. This opens a lot of potential system wide shortcut key-bindings that are a lot easier than using the uncomfortable ctrl-shift-cmd-opt.</p>

<p>So far it is very useful, I like the hyper-t for opening iTerm2 in visor mode, very handy. I will check back in in a month on this topic and share any other key bindings I come up with.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/parsers/2012/12/30/treetop-and-parsing-expression-grammars-pegs.html">Treetop and Parsing Expression Grammars (PEGs)</a></h1>
    
    
      <p class="meta">
        









<time datetime="2012-12-30T04:54:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Over the holiday I had some time to investigate parsing expression grammers. I had done work in Lex and Yacc many years back when I was responsible for some kernel functionality and related system management kernel commands for a proprietary commercial operating system. I don’t remember fondly my time working with Yacc. But then I read about <a href="http://en.wikipedia.org/wiki/Parsing_expression_grammar">PEGs</a> and the <a href="http://treetop.rubyforge.org/">Treetop</a> Ruby library. It allows the use of simple grammer rules based in regular expressions and creates a parser ruby class from the grammer that can then be used in a ruby program. It also allows ruby blocks to be embedded directly into the grammer rules.</p>

<p>For our startup we have a core feature that includes some user generated instructions that are meant to create a mobile experience for others to participate in, sort of a simple <a href="http://en.wikipedia.org/wiki/Finite-state_machine">FSM</a> driven experience. We could present the authoring environment in  a form-based interface, but this seemed a bit too restrictive. We may still go with forms, but I wanted to try an intermediate format using user readable text files, so we could write up test cases fast and easy, and compile them into the FSM class. I was also inspired by the simplicity of the <a href="http://daringfireball.net/projects/markdown/">markdown</a> syntax and the way it is used in <a href="http://www.foldingtext.com/">FoldingText</a>. It may not pan out but I really had fun working on it.</p>

<p>I will post some code in the future, but thought I would post a link to the <a href="http://www.trsolutions.biz/blog/2010/03/10/treetop-introductory-tutorial-1-of-10/">tutorial</a> I found very helpful in getting my experiment up and running quickly. It is a well written tutorial that starts with the basics of getting a simple parser working, and then explores just enough complexity to get you to a place where a moderately complex grammer can be written. I think this is a great tool for any Ruby developer’s tool belt; and for certain classes of problems related to parsing information it is a very eloquent approach.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/productivity/2012/12/26/foldingtext-and-productivity.html">FoldingText and productivity</a></h1>
    
    
      <p class="meta">
        









<time datetime="2012-12-26T19:19:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I have been using the <a href="http://www.foldingtext.com/">FoldingText</a> app for  a couple of weeks. It is a very interesting app targeting writers, something I am not, but I was intrigued by the  interactivity of this minimalist app. Specifically the ability to add interactive todo lists and timers and have them execute in a text document. Please take a look at the <a href="http://www.foldingtext.com/#watchmovie">FoldingText Video</a> to get a feel for it, I don’t want to describe ideas that a video shows so clearly.</p>

<p>I have been using it for my daily plan the past 2 weeks. I usually start each day with a mix of items I want to accomplish. These items usually include a mix of coding items for a sprint, some user stories for the backlog, and some wireframes for a future sprint, etc.  The mix keeps the day feeling balanced. I add a mix of these to the day’s plan, and then organize them into <a href="http://en.wikipedia.org/wiki/Pomodoro_Technique">pomodoro</a> time slices.</p>

<p>The app’s simplicity allows some really interesting customization that isn’t present in an app like Vitamin-R, which is a good pomodoro app, but like most apps is not very flexible. For example, I have found that keeping the daily plan, now and later notes, and the time slices all in a single document is very powerful. Further I can add notes indented under time slices to describe what I did during each slice. Since everything is in a single text document (markdown) and lives in my nvALT notes app, I can easily search and find my daily notes that include what I accomplished each day, etc. This is good for reviewing how well certain activities mix together, looking at my velocity over time, etc.</p>

<p>All of that is useful but the reason for my making this post is that I find the interaction model to be very interesting, basically a text document with very simple embedded mini-apps that are triggered by simple human-readable phrases that add functionality while the document is open and in use. With all output living in the text document. It gives hints of a feeing of empowerment that early spreadsheet apps like Lotus123 delivered. I can imagine all sorts of useful embedded mini-apps, the key will be maintaining the simplicity. Many apps used for productivity today are incredibly prescriptive, FoldingText feels like you are really in control and able to customize the document as a very simple app. Of course FoldingText itself is still more of an app than a platform, but I can imagine it as a platform with many developers adding these mini-apps. Todo lists and timers seem like a powerful start, I can’t wait to see what comes next.</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/hacks/productivity/2012/12/17/wiki-plus-searchable-notes.html">Wiki + searchable notes.</a></h1>
    
    
      <p class="meta">
        









<time datetime="2012-12-17T13:25:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>For our startup I have been using github wiki to keep the product specs, design docs, user stories, etc organized and up-to-date. The nice thing about github is you can clone the wiki and work on it locally and push changes up to the server. See this <a href="https://github.com/wicketstuff/core/wiki/Editing-Wiki-Locally" title="writeup" target="_blank">writeup</a> for more info. This is handy because you can then work on the wiki using markdown syntax in a regular text editor versus a web page editor.</p>

<p>The ease of this made me wonder if there was a way to do my normal note taking, code journalling, etc in markdown vs Evernote. I did some looking around and found <a href="http://brettterpstra.com/project/nvalt/" title="nvAlt" target="_blank">nvALT</a>, which is a markdown based notebook that can save notes as flat .md files.</p>

<p>So as an experiment I cloned my personal notes wiki from github.  After configuring nvALT to use the cloned wiki directory as its directory I could immediately see and search all of my wiki files as nvALT note files. Also I could add new files and they would now become linkable as wiki files. So basically nvALT acts as a note taking system, but notes can be also linked together via a mmd link notation that is supported by the github wiki. You can install the <a href="https://github.com/github/gollum" title="Gollum">gollum</a> gem and interact with the wiki locally to test the wiki pages.</p>

<p>So I can now create, edit, search notes in markdown, but also link them, as well as view them as a wiki.</p>

<p>I will post again after a few weeks trying out the solution with more info on how it is working.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/productivity/2012/12/17/fast-photosync-from-iphone.html">Fast PhotoSync from iPhone</a></h1>
    
    
      <p class="meta">
        









<time datetime="2012-12-17T05:14:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Doing iOS design and development I find myself capturing images on the iPhone all the time to make notes on. These usually end up being added to my notes or to our project wiki (see <a href="http://fooqri.tumblr.com/post/38160399193/screen-capture-goodness" title="Screen Capture Goodness">Screen capture goodness</a> and  <a href="http://fooqri.tumblr.com/post/38158334752/wiki-searchable-notes" title="Wiki + Searchable Notes">Wiki + Searchable Notes</a> for more on that).</p>

<p>To get the images from the phone to my Mac I was using Apple’s Photo Stream feature but it took too long and sometime images just didn’t show up on the Mac. So I went looking for a better solution and found the <a href="http://www.photosync-app.com/" title="PhotoSync">PhotoSynch </a>app in the app store. You install it on the iphone via the ios app store ($1.99), and on the Mac via the Mac app store (Free).</p>

<p>It can then be configured to synch all the images in your camera roll with the Mac over wifi. It has a quick transfer feature that allows it to transfer all images since the last sync to the Mac.</p>

<p>You start the transfer on the phone, and when it completes a Finder window will appear on the Mac so you can see the images. At this point I use script to move certain images into the right folders. The process is quick, simple, and works every time.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/hacks/productivity/2012/01/17/screen-capture-goodness-dot-dot-dot.html">Screen capture goodness...</a></h1>
    
    
      <p class="meta">
        









<time datetime="2012-01-17T14:17:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>###tl;wr
Take the shell script from below and create a TextExpander snippet to save any image in your OS X clipboard to disk with a unique uuid.png name, and automatically create a markdown image link that is pasted in place in your editor.</p>

<p>###verbose
When making notes on wireframes, screen designs, activity diagrams, etc, I have a particular workflow where I do a screen capture and want to link the result in my markdown notes or from our project wiki. The power of markdown text files is their portability, the challenge can be losing the rich cut and paste of apps like Evernote.</p>

<p>In a previous post <a href="http://fooqri.tumblr.com/post/38158334752/wiki-searchable-notes" title="Wiki + Searchable Notes">Wiki + searchable notes</a>. I mentioned that I was now using the github clone feature for the wiki, allowing me to work on the wiki locally and then push changes to the server with git push. Another benefit of this approach, it makes it very easy to add images to the wiki. </p>

<p>The problem was it took too many steps to go from capturing the screen, saving it, and finally linking to it in the wiki/notes file. So I created a TextExpander snippet to do all of this in 2 steps (OSX only)</p>

<ol>
  <li>screen capture (ctrl-cmd-shift-4)</li>
  <li>type “wpng” into the editor where I want the image to be placed.</li>
</ol>

<p>First you need <a href="http://smilesoftware.com/TextExpander/index.html" title="TextExpander">TextExpander</a> and also you need to install <a href="https://github.com/jcsalterego/pngpaste" title="pngpaste">pngpaste</a> a small bit of code that handles saving a clipboard image to a png file.</p>

<p>Then you just need this snippet (I used “wpng” as the snippet abbreviation):</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">ImageToMMD.bash</span><a class="code-highlight-caption-link" href="https://gist.github.com/4321473">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c">#!/usr/bin/env bash</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">uuid_str</span><span class="o">=</span><span class="k">$(</span>/usr/local/bin/uuid<span class="k">)</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">dir</span><span class="o">=</span><span class="s2">"/Users/my-account/my-wiki/images/"</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">target</span><span class="o">=</span><span class="s2">"</span><span class="nv">$dir$uuid_str</span><span class="s2">.png"</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">var</span><span class="o">=</span><span class="k">$(</span>/usr/local/bin/pngpaste <span class="nv">$target</span> 2&gt;&amp;1<span class="k">)</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$var</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"No PNG data found on the clipboard!"</span> <span class="o">]</span>;
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">then
<div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="nb">echo</span> <span class="s2">"No-PNG"</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">else
<div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="nb">echo</span> <span class="s2">"[![</span><span class="nv">$uuid_str</span><span class="s2">.png](images/</span><span class="nv">$uuid_str</span><span class="s2">.png)](images/</span><span class="nv">$uuid_str</span><span class="s2">.png)"</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">fi</span></div></div>

I chose to just use a UUID for the file name to keep it simple and unique for each file.

I added this as a snippet in TextExpander and now instead of 10+ steps across 3 apps my workflow for getting a screen capture into a wiki page is this:

1. screen capture (ctrl-cmd-shift-4)
1. type "wpng" into the editor where I want the image to be placed. 

The result: typing "wpng" causes the last clipboard item to be saved as a png in the wiki images directory and the "wpng" text I just typed is replaced with the markup for the image that was just saved. Quick and simple.
</span></div></div></span></div></div></pre></div></figure>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="4">&larr; Older</a>
    
    <a href="/blog/archives/"> Archives </a>
    
    <a class="next" href="2">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section id="titles">
  <a href="http://rwx.io" title=""><img id="logo" src="http://rwx.io/images/profile.jpg" /></a>
  <h1 id="site_title"><a href="http://rwx.io" title=""></a></h1>
  <h3 id="site_subtitle">Design, development, productivity -- notes and explorations.</h3>
</section>

<section id="menu">
  <ul>
    <li><i class="fa fa-home fa-lg"></i><a href="http://rwx.io"> Home </a></li>
    <li><i class="fa fa-calendar fa-lg"></i><a href="http://rwx.io/archives/"> Archives </a></li>
    <li><i class="fa fa-user fa-lg"></i><a href="http://rwx.io/about/"> About </a></li>
    <li><i class="fa fa-rss fa-lg"></i><a href="http://rwx.io/feed/"> Feed </a></li>
  </ul>
</section>

<div id="search">
  <form action="/search" method="get">
    <input type="text" id="search-query" name="q" placeholder="Search" autocomplete="off">
  </form>
</div>

<section id="search-results" style="display: none;">
  <h1 id="search-results-heading">Search Results</h1>
  <div class="entries">
  </div>
</section>


<script id="search-results-template" type="text/mustache">
  <ul>
  {{#entries}}
      <li class="post">
        <a href="{{url}}">{{title}}</a>
      </li>
    </article>
  {{/entries}}
  </ul>
</script>


<script type="text/javascript">
  $(function() {
    $('#search-query').lunrSearch({
      indexUrl: '/js/index.json',   // Url for the .json file containing search index data
      results : '#search-results',  // selector for containing search results element
      entries : '.entries',         // selector for search entries containing element (contained within results above)
      template: '#search-results-template'  // selector for Mustache.js template
    });
  });
</script>

<section id="social">
  

  

  

  

  

  
</section>


<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2016/03/11/Org-Export-Configurations.html">Org Export Configurations</a>
      </li>
    
      <li class="post">
        <a href="/2016/03/10/Deft-and-Emacs-for-Notes.html">Deft + Org for Notes</a>
      </li>
    
      <li class="post">
        <a href="/2016/03/09/org-with-babel-node-updated.html">Org Mode ES2015+ Code Blocks (updated)</a>
      </li>
    
      <li class="post">
        <a href="/2016/01/27/ancs-example-on-blend-nano.html">ANCS Example on BLE Nano</a>
      </li>
    
      <li class="post">
        <a href="/2016/01/23/ancs-message-display.html">ANCS Message Display</a>
      </li>
    
      <li class="post">
        <a href="/2015/10/06/org-with-babel-node.html">Org Mode ES2015+ Code Blocks</a>
      </li>
    
      <li class="post">
        <a href="/2015/09/09/esp8266-initial-notes.html">ESP8266 Initial Notes</a>
      </li>
    
      <li class="post">
        <a href="/2015/08/18/self-updating-edison-app.html">Self Updating Edison Apps</a>
      </li>
    
      <li class="post">
        <a href="/2015/08/17/workbench.html">Workbench Replaces My Desk</a>
      </li>
    
      <li class="post">
        <a href="/2015/08/17/i2c-mpu-6050.html">I2C MPU-6050</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Popular Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2016/03/11/Org-Export-Configurations.html">Org Export Configurations</a>
      </li>
    
      <li class="post">
        <a href="/emacs/productivity/2013/03/04/nvalt-and-emacs.html">nvALT and Emacs</a>
      </li>
    
      <li class="post">
        <a href="/hacks/productivity/2012/01/17/screen-capture-goodness-dot-dot-dot.html">Screen capture goodness...</a>
      </li>
    
      <li class="post">
        <a href="/rubymotion/restkit/2013/03/07/getting-rklogconfigurebyname-working-in-rubymotion.html">Getting RKLogConfigureByName working in RubyMotion</a>
      </li>
    
      <li class="post">
        <a href="/hacks/productivity/2012/12/17/wiki-plus-searchable-notes.html">Wiki + searchable notes.</a>
      </li>
    
      <li class="post">
        <a href="/development/rubymotion/ios/2013/06/01/coredata-dot-sqldebug-for-rubymotion.html">CoreData.SQLDebug for RubyMotion</a>
      </li>
    
      <li class="post">
        <a href="/parsers/2012/12/30/treetop-and-parsing-expression-grammars-pegs.html">Treetop and Parsing Expression Grammars (PEGs)</a>
      </li>
    
      <li class="post">
        <a href="/poggr/google-docs/polymer/2014/10/15/spreadsheet-driven-web-apps.html">Spreadsheet Driven Web Apps</a>
      </li>
    
      <li class="post">
        <a href="/hacks/design/2013/01/01/user-stories-and-activity-diagrams.html">User Stories and Activity Diagrams</a>
      </li>
    
      <li class="post">
        <a href="/poggr/literate-coffee-script/2014/10/15/fun-with-literate-coffeescript.html">Fun with Literate CoffeeScript</a>
      </li>
    
  </ul>
</section>






  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 -  -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  











</body>
</html>
