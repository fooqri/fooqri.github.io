
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>ANCS Message Display - </title>
  <meta name="author" content="Patrick Goddi">

  
  <meta name="description" content="Overview Ever want to see that last iPhone message without checking your phone. It is actually fairly easy to create a secondary message display &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://fooqri.github.io/blog/2016/01/23/ancs-message-display/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
   <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="" type="application/atom+xml">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Lato:400,100,100italic,300,300italic,400italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Lora:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Source+Code+Pro:200,300,400,500,600,700,900' rel='stylesheet' type='text/css'>




  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-41376488-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  <style>html{background: linear-gradient(180deg, rgba(62, 54, 52,
  0.8) 0%, rgba(89, 79, 76, 0.8)),  url("/images/background.png") repeat;}</style>
</head>

<body   >
  <header role="banner"><hgroup>
</hgroup>

</header>
  <!-- <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:fooqri.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav> -->
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">ANCS Message Display</h1>
    
    
      <p class="meta">
        








  


<time datetime="2016-01-23T11:12:00-08:00" pubdate data-updated="true">Jan 23<span>rd</span>, 2016</time>
        
      </p>
    
  </header>


<div class="entry-content"><h2>Overview</h2>

<p>Ever want to see that last iPhone message without checking your phone. It is actually fairly easy to create a secondary message display using an Arduino, BLE, and an LCD display to conect to the <em>Apple Notification Center Service</em> on your iPhone.
<img src="https://s3.amazonaws.com/rwx-blog/IMG_6097.JPG"></p>

<p>For this project I used the <a href="http://redbearlab.com/blendmicro/" target="_blank">Blend Micro</a> from  RedBearLab, combined with an <a href="https://www.adafruit.com/product/358" target="_blank">AdaFruit ST7735R TFT LCD display</a>  The <em>Blend Micro</em> combines an Atmel ATmega32U4 micro-controller with a Nordic nRF8001 BLE chip. Simply hook up the LCD using SPI and you are in business. For this project I added a <a href="https://www.adafruit.com/products/160">piezo buzzer</a> for sound effects and a button to wake up the display if it has timed out.</p>

<p><img src="//s3.amazonaws.com/rwx-blog/IMG_6098.JPG"></p>

<p>The basic idea is to have the iPhone pass along alerts to the device using BLE/ANCS and to have the device play a tone and display the alert information. There is a timeout to power down the backlight on the display after a minute, and a button that can be pressed to turn the display&rsquo;s backlight on, so the last message can be viewed after the one minute timeout.  This power savings mode could allow the device to be powered by a battery.</p>

<p>I created a demo project on <a herf="https://codebender.cc/sketch:222511" target="_blank">codebender</a> to make it easy to replicate. You will need to import a few libraries into your personal libraries on codebender to get the project to work. It would be easy to enhance the project to save the last several messages and use a <a href="https://www.adafruit.com/product/444">2-Axis Analog Thumb Joystick</a> to control a simple interface that scans through messages.</p>

<p>Unfortunately the <em>Blend Micro</em> does not have an on-board LIPO charging circuit, so if you want to enable a combined USB/Battery solution a charging circuit would have to be added. RedBear warns that connecting a battery to VIN and USB simultaneously could damage the board.</p>

<p>I printed up a simple enclosure on the 3D printer and here is the enclosed LCD panel.</p>

<p><img src="https://s3.amazonaws.com/rwx-blog/IMG_6111.JPG"></p>

<h2>Pinouts</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  VIN & GND -&gt; to LIPO battery (DO NOT use USB power when battery connected)
</span><span class='line'>  PIN 2     -&gt; ST7735R LITE
</span><span class='line'>  PIN 8     -&gt; ST7735R D/C
</span><span class='line'>  PIN 9     -&gt; ST7735R Reset
</span><span class='line'>  PIN 10    -&gt; ST7735R TFT_CS
</span><span class='line'>  PIN 11    -&gt; ST7735R MOSI
</span><span class='line'>  PIN 13    -&gt; ST7735R SCK
</span><span class='line'>  PIN V33   -&gt; ST7735R VCC
</span><span class='line'>  PIN GND   -&gt; ST7735R GND
</span><span class='line'>
</span><span class='line'>  Button -&gt; PIN 5, GND
</span><span class='line'>  Buzzer -&gt; PIN 3, GND
</span></code></pre></td></tr></table></div></figure>


<h2>Detailed Instructions</h2>

<p>Follow the instructions for using <a href="http://redbearlab.com/quick-start-codebender" target="_blank">Blend Micro on codebender</a>. You should be able to get the LED Blink example working before continuing.</p>

<h3>Add key libraries</h3>

<p>To compile the code in the project above you will need to add several libraries to your personal libraries on codebender. Go to  <a href="https://codebender.cc" target="_blank">codebender.cc</a> and you will see the <em>*Upload Libraries</em> button on the upper right side of the page. There are four libraries you need to add.</p>

<ul>
<li><a href="https://github.com/NordicSemiconductor/ble-sdk-arduino" target="_blank">Nordic Bluetooth low energy SDK for Arduino beta version 0.9.0</a></li>
<li><a href="https://github.com/RedBearLab/nRF8001/" target="_blank">RedBearLab nRF8001 Library version 20140701</a></li>
<li><a href="https://github.com/RedBearLab/nRF8001/" target="_blank">RedBearLab Blend Add-On version 20140701</a></li>
<li><a href="https://github.com/robotastic/ANCS-Library" target="_blank">Robotastic/ANCS-Library</a></li>
</ul>


<p>Just download each of these as a zip file from github, and upload them to your <em>codebender personal library</em>. I created a fork of the <em>ANCS-Library</em> to thin it down a bit as memory was tight on the <em>Blend Micro</em> for another version of the project I am working on. It is on a branch called <strong>code-diet</strong> available on github  <a href="//github.com/fooqri/ANCS-Library/archive/code-diet.zip">ANCS-Library on a code-diet zip</a></p>

<p>Finally, clone my <a herf="https://codebender.cc/sketch:222511" target="_blank">codebender ANCS_Display_ST7735 project</a> and verify the code compiles with the libraries you uploaded, and run the project on Arduino.</p>

<p>Open the iPhone  <em>Settings</em> app and select <em>Bluetooth</em>. If everything is working correctly you should see <strong>ANCS_RUSK</strong> listed under <em>MyDevices</em>. Select it and choose pair.
<img src="https://s3.amazonaws.com/rwx-blog/IMG_6095.PNG">
<img src="https://s3.amazonaws.com/rwx-blog/IMG_6094.PNG"></p>

<p>Once paired you should hear a tone on the device, and the display will change from <strong>Status: Not Connected</strong> to <strong>Status: Connected</strong>.  If you receive any alerts on your iPhone you should now hear a tone on the device and the screen should display a message.</p>

<p>You can update the code to support custom tones and messages for different alert types, or add other interesting features.</p>

<h2>Additional Notes</h2>

<ul>
<li>The <a href="http://redbearlab.com/blenano/">Blend Nano</a> from ReadBearLab is a tiny alternative to the Blend Micro but it is based on the ARM Cortex-M0 SoC and uses the newer Nordic nRF51822 BLE chipset. The <em>ANCS-Library</em> is only compatible with the Nordic nRF8001 BLE chipset, so some work would be needed to port the library to the new platform.</li>
<li>Adafruit has just announced a few similar Arduino+BLE boards. The <a href="https://www.adafruit.com/products/2829">Feather 32u4 Bluefruit LE</a> using the ATmega32u4, and the <a href="https://www.adafruit.com/products/2995">Feather M0 Bluefruit LE</a> using the ATSAMD21G18 ARM Cortex. Both these boards provide a built in 100mA lipoly charger, so either would be a better choice for a mobile device. Both these boards use the  nRF51822 BLE chipset so like the Blend Nano would require porting the <em>ANCS-Library</em> before the code above could be used.</li>
<li>I have a <a href="https://www.adafruit.com/products/1393">SHARP Memory Display Breakout</a> from adafruit, which is a really nice eInk type display, but was unable to get it working with this demo on first try. This <a href="https://codebender.cc/sketch:220214">codebender sketch</a> was my first attempt. It seems that there is a conflict between the <em>Adafruit_SharpMem</em> library and the <em>ANCS Library</em>, because instantiating the Adafruit_SharpMem display object causes calls to notif.setup() to hang. I may look at it a bit more if I get a chance, but this was to be a quick experiment. There were some memory size issues initially, but I believe the hang may be an SPI issue, but I haven&rsquo;t yet had time to investigate further.</li>
<li>I also started to play with a headless version that instead uses neoPixels. I will post when I finish it. I like the idea of a fun neoPixel and sound only display connected with an iOS app that allows the user to customize what notifications the display responds to and how it responds. This would allow cheap simple peripheral displays to be created that respond to different notifications in different ways.</li>
<li>The <a href="http://makezine.com/2015/12/09/meet-esp32-new-big-brother-to-iot-board-esp8266/">ESP32</a> should make for an interesting platform for these types of displays because they could allow BLE for notifications, and use WiFi for connection to the home network. This could allow control a wide range of WiFi enabled home devices based on iOS app notifications. That sounds fun.</li>
</ul>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Patrick Goddi</span></span>

      








  


<time datetime="2016-01-23T11:12:00-08:00" pubdate data-updated="true">Jan 23<span>rd</span>, 2016</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://fooqri.github.io/blog/2016/01/23/ancs-message-display/" data-via="" data-counturl="http://fooqri.github.io/blog/2016/01/23/ancs-message-display/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/10/06/org-with-babel-node/" title="Previous Post: Org Mode ES2015+ Code Blocks">&laquo; Org Mode ES2015+ Code Blocks</a>
      
      
        <a class="basic-alignment right" href="/blog/2016/01/27/ancs-example-on-blend-nano/" title="Next Post: ANCS Example on BLE Nano">ANCS Example on BLE Nano &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section id="titles">
  <a href="http://fooqri.github.io" title=""><img id="logo" src="http://fooqri.github.io/images/profile.jpg" /></a>
  <h1 id="site_title"><a href="http://fooqri.github.io" title=""></a></h1>
  <h3 id="site_subtitle">Design, development, productivity -- notes and explorations.</h3>
</section>

<section id="menu">
  <ul>
    <li><i class="fa fa-home fa-lg"></i><a href="http://fooqri.github.io"> Home </a></li>
    <li><i class="fa fa-calendar fa-lg"></i><a href="http://fooqri.github.io/blog/archives/"> Archives </a></li>
    <li><i class="fa fa-user fa-lg"></i><a href="http://fooqri.github.io/about/"> About </a></li>
    <li><i class="fa fa-rss fa-lg"></i><a href="http://fooqri.github.io/atom.xml"> Feed </a></li> 
    <li><i class="fa fa-twitter fa-lg"></i><a href="https://twitter.com/fooqri"> twitter </a></li>
    <li><i class="fa fa-linkedin fa-lg"></i><a href="http://www.linkedin.com/in/goddi/"> LinkedIn </a></li> </ul>
  </ul>
</section>

<section id="social">
  

  

  

  

  

  
</section>


<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/01/27/ancs-example-on-blend-nano/">ANCS Example on BLE Nano</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/01/23/ancs-message-display/">ANCS Message Display</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/10/06/org-with-babel-node/">Org Mode ES2015+ Code Blocks</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/09/esp8266-initial-notes/">ESP8266 Initial Notes</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/18/self-updating-edison-app/">Self Updating Edison Apps</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Popular Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/01/17/screen-capture-goodness-dot-dot-dot/">Screen capture goodness...</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/17/fast-photosync-from-iphone/">Fast PhotoSync from iPhone</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/17/wiki-plus-searchable-notes/">Wiki + searchable notes.</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/26/foldingtext-and-productivity/">FoldingText and productivity</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/30/treetop-and-parsing-expression-grammars-pegs/">Treetop and Parsing Expression Grammars (PEGs)</a>
      </li>
    
  </ul>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Patrick Goddi -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'goddio';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://fooqri.github.io/blog/2016/01/23/ancs-message-display/';
        var disqus_url = 'http://fooqri.github.io/blog/2016/01/23/ancs-message-display/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
